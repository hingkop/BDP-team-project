/*
 * ACIS Widgets
 * Version 1.0.56
 * Requires jQuery, JQueryUI and Date
 * 
 * Keith Eggleston
 *  Northeast Regional Climate Center
 */
!function(e){e.widget("acis.stationSrch",{options:{autoShow:!0,srchFunction:null,srchMoreFunction:null},_create:function(){var t,a=e("<div></div>"),n=e("<fieldset></fieldset>"),i=e("<span></span>"),o=e("<label></label>"),s=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),l=this.element,r=this.options.srchFunction,c=a.clone().appendTo(l),d=a.clone().addClass("ui-widget-content ui-corner-all ui-state-default ui-helper-clearfix acis-srchBox").appendTo(c),p=n.clone().addClass("ui-helper-hidden").attr("id","srchResults").appendTo(c),u=s.clone().appendTo(p),h=a.clone().addClass("acis-goSrch").prop("title","Click to begin search").appendTo(d),f=e("<input />",{type:"text",id:"stnSrchString",class:"ui-state-default",maxlength:35,value:"enter city,state or zip"}).prependTo(d);this.areaContainer=c,this.srchGo=h,i.clone().text("Search").addClass("ui-helper-hidden").appendTo(h),o.clone().text("Station:").prependTo(p),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||c.addClass("ui-helper-hidden"),f.bind({click:function(){this.select()},keyup:function(e){13===e.keyCode&&r()}}),h.bind({click:r}),u.bind({change:function(){t=e(this).val().split(" "),defaults.sId=t[0],defaults.idType=t[1]}})},shower:function(){this.areaContainer.show(),e("#stnSrchString").focus().select()},hider:function(){this.areaContainer.hide(),e("#restoreMap").length&&e("#restoreMap").hide()},getter:function(){return!!e("#srchResults select").val()&&e("#srchResults select").val()},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.find("input").unbind(),this.element.find("select").unbind(),this.srchGo.unbind(),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("input").unbind(),this.element.find("select").unbind(),this.srchGo.unbind()},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.element.find("input").bind({click:function(){this.select()},keyup:function(e){13===e.keyCode&&this.options.srchFunction()}}),this.srchGo.bind({click:this.options.srchFunction}),this.element.find("select").bind({change:function(){var t=e(this).val().split(" ");defaults.sId=t[0],defaults.idType=t[1]}})}}),e.widget("acis.stationId",{options:{autoShow:!0,defSid:"304174"},guessType:function(t,a){function n(e){return/^[A-Za-z]+$/.test(e)}t.length>=3&&(3===t.length&&n(t.charAt(1))?a.val(3):4===t.length&&n(t.charAt(0))?a.val(5):5===t.length&&n(t.substring(0,4))&&e.isNumeric(t.substring(4,5))?a.val(7):5===t.length&&e.isNumeric(t)?a.val(1):6===t.length&&e.isNumeric(t)?a.val(2):6!==t.length&&8!==t.length||"thr"!==t.substring(t.length-3,t.length).toLowerCase()?7===t.length&&e.isNumeric(t)?a.val(16):8===t.length?a.val(10):11===t.length?a.val(6):a.val("any"):a.val(9),defaults.idType=a.val())},_create:function(){var t=e("<div></div>"),a=e("<fieldset></fieldset>"),n=e("<label></label>"),i=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),o=this.element,s=this.guessType,l=t.clone().addClass("acis-idContainer").appendTo(o),r=a.clone().appendTo(l),c=a.clone().appendTo(l),d=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default",value:this.options.defSid,maxlength:11}).prependTo(r),p=i.clone().appendTo(c);this.areaContainer=l,n.clone().text("ID:").prependTo(r),n.clone().text("Type:").prependTo(c),e.each({any:"Any",2:"Coop",1:"WBAN",5:"ICAO",6:"GHCN",7:"NWS LI",4:"WMO",3:"FAA",9:"ThreadEx",10:"CoCoRaHS",16:"AWDN",26:"NEWA",8:"RCC"},function(t,a){e('<option value="'+t+'">'+a+"</option>").appendTo(p)}),s(d.val(),p),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||l.addClass("ui-helper-hidden"),d.bind({"change blur":function(){defaults.sId=e(this).val()},keyup:function(){s(e(this).val(),p)}})},shower:function(){this.areaContainer.show(),this.areaContainer.find("input").focus().select()},hider:function(){this.areaContainer.hide()},getter:function(){var e=this.areaContainer.find("select").val(),t=this.areaContainer.find("input").val();return"16"===e?t=t.toLowerCase():(t=t.toUpperCase(),"any"===e&&(e="")),defaults.sId=t,defaults.idType=e,defaults.sId+(""!==defaults.idType?" "+defaults.idType:"")},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.find("input").unbind(),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("input").unbind()},enable:function(){var t=this.guessType;e.Widget.prototype.enable.call(this,arguments),this.element.find("input").bind({"change blur":function(){defaults.sId=e(this).val()},keyup:function(){t(e(this).val(),this.areaContainer.find("select"))}})}}),e.widget("acis.stationList",{options:{autoShow:!0,defCwa:"NRCC",stationFile:"station_dict.txt",cwaFile:"cwa_dict.txt"},listUpdater:function(){var t,a;e("#listStn").parents().eq(1).loadSpinner({message:"Loading menu ..."}),defaults.cwa=e("#listCwa").val()||this.options.defCwa,e.get(this.options.stationFile,function(n){a=JSON.parse(n),t=a[defaults.cwa],e("#listStn option").remove(),t&&0!==t.length?e(t).each(function(t,a){e('<option value="'+a[0]+" "+a[2]+'">'+a[1]+"</option>").appendTo("#listStn")}):e('<option value="">List unavailable for '+defaults.cwa+"</option>").appendTo("#listStn"),e("#listStn").hide().show()}),e("#listStn").parents().eq(1).loadSpinner("fadeOut")},_create:function(){var t=e("<div></div>"),a=e("<fieldset></fieldset>"),n=e("<label></label>"),i=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),o=e("<option></option>"),s=this.element,l=this.options.defCwa,r=t.clone().addClass("acis-listContainer").appendTo(s),c=a.clone().appendTo(r),d=i.clone().attr("id","listCwa").appendTo(r);this.areaContainer=r,i.clone().attr("id","listStn").appendTo(c),n.clone().attr("for","listStn").text("Station:").prependTo(c),this.element.addClass("ui-widget ui-helper-reset"),this.options.cwaFile.length>0&&e.get(this.options.cwaFile,function(t){0===t.length?o.clone().text("List unavailable").appendTo(d):(o.clone().val(l).text("Change CWA").appendTo(d),e.each(JSON.parse(t),function(e,t){o.clone().val(e).text(e+" - "+t).appendTo(d)}),e.proxy(this.listUpdater,this),d.trigger("change"))}).fail(function(){o.clone().text("List unavailable").appendTo(d)}),this.options.autoShow||r.addClass("ui-helper-hidden"),d.bind({focus:function(){e(this).css("width","80%").unbind("focus")},change:e.proxy(this.listUpdater,this)})},shower:function(){this.areaContainer.show(),e("#listCwa").val()!==defaults.cwa&&e("#listCwa").val(defaults.cwa).trigger("change")},hider:function(){this.areaContainer.hide()},getter:function(){var t;return!!e("#listStn").val()&&(t=e("#listStn").val().split(" "),defaults.sId=t[0],defaults.idType={coop:2,wban:1,icao:5,ghcn:6,shef:7,wmo:4,faa:3,thrdx:9,cocorahs:10,awdn:16,newa:26,any:"any"}[t[1]],defaults.sId+" "+defaults.idType)},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.find("select").unbind(),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("select").unbind()},enable:function(){e.Widget.prototype.enable.call(this,arguments),e("#listCwa").bind({change:function(){e.proxy(this.listUpdater,this)}})}}),e.widget("acis.bboxSelection",{options:{autoShow:!0,maxArea:300,mapInteraction:!1,makeActive:-1},showBbox:function(){var t,a,n=this.getter();e(".acis-bboxContainer").find("button").hide(),n&&(setupMaps(this.showBbox),showMap(),t=new google.maps.LatLng(n[1],n[0]),a=new google.maps.LatLng(n[3],n[2]),setTimeout(function(){addBbox(t,a)},500),this._trigger("boxdrawn"))},update:function(){var t;e.each([".bbox_w",".bbox_s",".bbox_e",".bbox_n"],function(a,n){t=parseFloat(e(n).val()),defaults.bbox[a]=e.isNumeric(t)?t:e(n).val(),e(n).val(defaults.bbox[a])})},_create:function(){var t=e("<div></div>"),a=e("<fieldset></fieldset>",{title:"Negative values for West longitudes and South latitudes"}),n=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default"}),i=e("<button></button>",{class:"acis-smallButton"}),o=e("<label></label>"),s=this,l=this.element,r=this.options.mapInteraction,c=t.clone().addClass("acis-bboxContainer").appendTo(l),d=a.clone().appendTo(c),p=a.clone().appendTo(c),u=a.clone().appendTo(c),h=a.clone().appendTo(c),f=i.clone().addClass("showBox").prop("title","Show this box on the map").text("Show Box").appendTo(c);o.clone().text("West:").appendTo(d),n.clone().addClass("bbox_w").appendTo(d),o.clone().text("South:").appendTo(p),n.clone().addClass("bbox_s").appendTo(p),o.clone().text("East:").appendTo(u),n.clone().addClass("bbox_e").appendTo(u),o.clone().text("North:").appendTo(h),n.clone().addClass("bbox_n").appendTo(h),e([["West","bbox_w"],["South","bbox_s"],["East","bbox_e"],["North","bbox_n"]]).each(function(t,a){var n=defaults.bbox&&null!==defaults.bbox[t]?defaults.bbox[t]:a[0];e.isNumeric(n)?n=n.toFixed(2):r&&f.hide(),e("."+a[1]).val(n)}),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||c.addClass("ui-helper-hidden"),r||f.addClass("ui-helper-hidden"),f.button().on("click",function(){s.showBbox()}),r&&c.find("input").on({change:function(){s.update()},keyup:function(t){13===t.keyCode?f.trigger("click"):(f.show(),e("#map_area button").hide())}})},getter:function(){var t=this.options.makeActive,a=[];return e.each([".bbox_w",".bbox_s",".bbox_e",".bbox_n"],function(n,i){if(!e.isNumeric(parseFloat(e(i).val())))return e(document).reportError({errorText:"bad latlon",makeActive:t,focusElement:i}),!1;a.push(parseFloat(e(i).val()))}),4===a.length&&(Math.abs(a[0]-a[2])*Math.abs(a[3]-a[1])>this.options.maxArea?(e(document).reportError({errorText:"big area",makeActive:t}),!1):(defaults.bbox=a,a))},_setOption:function(t,a){var n=this,i=0;"mapInteraction"===t&&(a?(e.each([".bbox_w",".bbox_s",".bbox_e",".bbox_n"],function(t,a){if(!e.isNumeric(parseFloat(e(a).val())))return!1;i+=1}),4===i&&e(".showBox").show(),setupMaps(),showMap(),e(".acis-bboxContainer").find("input").on({change:function(){n.update()},keyup:function(t){13===t.keyCode?e(".showBox").trigger("click"):(e(".showBox").show(),e("#map_area button").hide())}})):(hideMap(),e(".acis-bboxContainer").find("input").unbind())),e.Widget.prototype._setOption.apply(this,arguments)},shower:function(){var t=0;e(".acis-bboxContainer").show(),e.each([".bbox_w",".bbox_s",".bbox_e",".bbox_n"],function(a,n){if(!e.isNumeric(parseFloat(e(n).val())))return!1;t+=1}),this.options.mapInteraction&&(4===t?e(".showBox").show():e(".showBox").hide(),setupMaps(setupMaps),showMap(),setTimeout(function(){map&&4===t&&e(".showBox").trigger("click")},1e3))},hider:function(){e(".acis-bboxContainer").hide()},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),e(".acis-bboxContainer").find("button").off(),e(".acis-bboxContainer").find("input").off(),e(".acis-bboxContainer").children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),e(".acis-bboxContainer").find("button").off(),e(".acis-bboxContainer").find("input").off()},enable:function(){var t=this;e.Widget.prototype.enable.call(this,arguments),e(".acis-bboxContainer").find("button").on("click",function(){t.showBbox()}),this.options.mapInteraction&&e(".acis-bboxContainer").find("input").on({change:function(){t.update()},keyup:function(t){13===t.keyCode?e(".showBox").trigger("click"):(e(".showBox").show(),e("#map_area button").hide())}})}}),e.widget("acis.areaSelection",{options:{autoShow:!0,statesFile:"states_dict.txt",defState:"CT",mapInteraction:!1,buttonInfo:[["all","State"],["cwa","CWA"],["climdiv","Division"],["basin","Basin"],["county","County"]],labels:{county:{label:"County"},climdiv:{label:"Climate Division"},cwa:{label:"NWS CWA"},basin:{label:"Hydro Basin"},all:{label:null}},polySelectStyle:{fillColor:"#0000ff",fillOpacity:.7},polyUnselectStyle:{fillColor:"#ff0000",fillOpacity:.2},polyHoverStyle:{fillColor:"#00ff00"},maxWait:1e4},updateSubstateMap:function(t,a){var n,i=function(t,a){var n=e.acis.areaSelection.prototype.poly_ids[t]||0,i=overlaysArray[n];i.setOptions(a),google.maps.event.clearListeners(i,"mouseout"),google.maps.event.addListener(i,"mouseout",function(){e("#map_msg").empty(),i.setOptions(a)})};a||(a=e("input[name=acis-state_select_type]:checked").attr("id")),t?e("#substate").val(t):t=e("#substate").val(),n=defaults[a],defaults[a]=t,i(n,e.acis.areaSelection.prototype.options.polyUnselectStyle),i(t,e.acis.areaSelection.prototype.options.polySelectStyle)},setupSubstateMap:function(){var t,a,n,i,o,s,l,r,c=e("input[name=acis-state_select_type]:checked").attr("id"),d=e.acis.areaSelection.prototype.updateSubstateMap,p=[999,999,-999,-999];return!1!==setupMaps(this.setupSubstateMap)&&(showMap(),e("#map_msg").empty().loadSpinner({message:"Loading map ..."}),e.acis.areaSelection.prototype.crnt_meta?(e.acis.areaSelection.prototype.poly_ids={},e.each(e.acis.areaSelection.prototype.crnt_meta,function(i,l){o=l.id,s=l.bbox,p[0]=p[0]<s[0]?p[0]:s[0],p[1]=p[1]<s[1]?p[1]:s[1],p[2]=p[2]>s[2]?p[2]:s[2],p[3]=p[3]>s[3]?p[3]:s[3],t=[],e.each(l.geojson.coordinates,function(){n=[],e.each(this[0],function(e,t){n.push(new google.maps.LatLng(t[1],t[0]))}),t.push(n)}),(a=new google.maps.Polygon(e.extend({paths:t,strokeColor:"#0000ff",strokeOpacity:1,strokeWeight:2},e.acis.areaSelection.prototype.options.polyUnselectStyle))).setMap(map),overlaysArray.push(a),e.acis.areaSelection.prototype.poly_ids[o]=i,google.maps.event.addListener(a,"mouseover",function(){e("#map_msg").text(l.name),this.setOptions(e.acis.areaSelection.prototype.options.polyHoverStyle)}),google.maps.event.addListener(a,"mouseout",function(){e("#map_msg").empty(),this.setOptions(e.acis.areaSelection.prototype.options.polyUnselectStyle)}),google.maps.event.addListener(a,"click",function(){e("#map_msg").text("Selected: "+l.name),d(l.id,c)})}),d(null,null),e("#map_msg").loadSpinner("fadeOut"),l=new google.maps.LatLng(p[1],p[0]),r=new google.maps.LatLng(p[3],p[2]),i=new google.maps.LatLngBounds(l,r),void setTimeout(function(){map.fitBounds(i)},500)):e.acis.areaSelection.prototype.crntWait<=e.acis.areaSelection.prototype.options.maxWait?(setTimeout(e.acis.areaSelection.prototype.setupSubstateMap,500),e.acis.areaSelection.prototype.crntWait+=500,void e("#map_msg").loadSpinner("fadeOut").loadSpinner({message:"Waiting for menu to load ..."})):(e("#map_msg").loadSpinner("fadeOut").text("Timeout loading map; try selecting an area type again"),!1))},setupStateMap:function(){var t,a,n,i,o,s,l,r,c,d={meta:"bbox,geojson",state:defaults.state},p="https://data.rcc-acis.org/General/state",u=function(r){o=[],e.each(r.meta[0].geojson.coordinates,function(){s=[],e.each(this[0],function(e,t){s.push(new google.maps.LatLng(t[1],t[0]))}),o.push(s)}),(l=new google.maps.Polygon({paths:o,strokeColor:"#0000ff",strokeOpacity:.75,strokeWeight:1,fillOpacity:0})).setMap(map),overlaysArray.push(l),t=r.meta[0].bbox,a=new google.maps.LatLng(t[1],t[0]),n=new google.maps.LatLng(t[3],t[2]),i=new google.maps.LatLngBounds(a,n),setTimeout(function(){map.fitBounds(i)},500)};if(!1===setupMaps(this.setupStateMap))return!1;showMap(),e("#map_msg").loadSpinner({message:"Loading map ..."}),window.XDomainRequest?((r=new XDomainRequest).open("GET",p+"?params="+JSON.stringify(d)),r.onload=function(){c=JSON.parse(r.responseText),u(c),e("#map_msg").loadSpinner("fadeOut")},r.onerror=function(){e("#map_msg").loadSpinner("fadeOut")},r.onprogress=function(){},r.ontimeout=function(){},setTimeout(function(){r.send()},0)):e.ajax(p,{type:"GET",data:d,dataType:"json",timeout:1e4,success:u,complete:function(){e("#map_msg").loadSpinner("fadeOut")}})},setupSubstateMenu:function(t){var a,n,i=e.acis.areaSelection.prototype.options.mapInteraction,o=this,s=e("<option></option>"),l=e(".acis-state_selections fieldset:last"),r=l.find("select"),c=l.find("label"),d=this.options.labels,p=e("input[name=acis-state_select_type]:checked").attr("id"),u=d[p],h={state:e("#state").val()||defaults.state,meta:"id,name,bbox,geojson"},f="https://data.rcc-acis.org/General/"+p,m=function(a){a&&0===a.meta.length?(e(c).text("Information unavailable"),e(r).hide(),i&&hideMap()):(e.acis.areaSelection.prototype.crnt_meta=a.meta,e(c).text(u.label+":"),e(r).empty().show(),e.each(a.meta,function(e,t){s.clone().val(t.id).text(t.name).appendTo(r)}),defaults[p]||(defaults[p]=a.meta[0].id),e(r).val(defaults[p]),i&&!t&&o.setupSubstateMap())};if("all"===p)return e(l).hide(),void(i&&!t&&o.setupStateMap());e(l).show().loadSpinner({message:"Loading menu ..."}),e(r).empty(),e.acis.areaSelection.prototype.crntWait=0,window.XDomainRequest?((a=new XDomainRequest).open("GET",f+"?params="+JSON.stringify(h)),a.onload=function(){n=JSON.parse(a.responseText),m(n),e(l).loadSpinner("fadeOut")},a.onerror=function(){e(c).text("Error obtaining menu"),e(r).hide(),e(l).loadSpinner("fadeOut")},a.onprogress=function(){},a.ontimeout=function(){},setTimeout(function(){a.send()},0)):e.ajax(f,{type:"GET",data:h,dataType:"json",success:m,error:function(t,a,n){e(c).text("Error obtaining menu - "+n),e(r).hide()},complete:function(){e(l).loadSpinner("fadeOut")}})},_create:function(){var t=e("<div></div>"),a=e("<fieldset></fieldset>"),n=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),i=e("<option></option>"),o=e("<label></label>"),s=this,l=this.options.defState,r=this.options.mapInteraction,c=this.element,d=t.clone().addClass("acis-stateContainer").buttonBar({barName:"acis-state_select_type",barOrient:"vertical",buttonInfo:this.options.buttonInfo,buttonDefault:defaults.state_select_type||"cwa"}).appendTo(c).loadSpinner({message:"Loading states ..."}),p=t.clone().addClass("acis-state_selections").appendTo(d),u=n.clone().attr("id","state").appendTo(p),h=a.clone().attr("id","sub_state_area").addClass("ui-helper-hidden").appendTo(p);e.acis.areaSelection.prototype.options.mapInteraction=this.options.mapInteraction,n.clone().attr("id","substate").appendTo(h),o.clone().attr("for","substate").prependTo(h),e.get(this.options.statesFile,function(t){0===t.length?i.clone().val(l).text("State menu unavailable").appendTo(u):(e.each(JSON.parse(t),function(e,t){i.clone().val(e).text(t).appendTo(u)}),u.val(l).one("change",function(){s.setupSubstateMenu(!0),e(this).bind("change",function(){defaults.state=e(this).val(),defaults.climdiv=null,defaults.cwa=null,defaults.county=null,defaults.basin=null,s.setupSubstateMenu()})}).trigger("change")),i.clone().val(l).text("State menu unavailable").appendTo(u)}).always(function(){d.loadSpinner("fadeOut")}),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||d.addClass("ui-helper-hidden"),e("#acis-state_select_type input").on("click",function(){defaults.state_select_type=e(this).attr("id"),s.setupSubstateMenu()}),h.find("select").on("change",function(){r&&(map?s.updateSubstateMap(e(this).val(),null):s.setupSubstateMap())})},_setOption:function(t,a){"mapInteraction"===t&&(a?"all"!==e("input[name=acis-state_select_type]:checked").attr("id")?this.setupSubstateMap():this.setupStateMap():hideMap(),e.acis.areaSelection.prototype.options.mapInteraction=a),e.Widget.prototype._setOption.apply(this,arguments)},shower:function(){e(".acis-stateContainer").show(),this.options.mapInteraction&&("all"!==e("input[name=acis-state_select_type]:checked").attr("id")?this.setupSubstateMap():this.setupStateMap())},hider:function(){e(".acis-stateContainer").hide()},getter:function(){var t=e("input[name=acis-state_select_type]:checked").attr("id");return"all"===t?["state",e("#state").val()]:t.length>0&&e("#substate").length>0?[t,e("#substate").val()]:["cwa",defaults.cwa||"NRCC"]},getStateType:function(){return e("input[name=acis-state_select_type]:checked").attr("id")||"cwa"},getStateName:function(){return e(".acis-state_selections select:first").find(":selected").text()},getStateAbbr:function(){return e(".acis-state_selections select").filter(":first").val()},getSubstateName:function(){var t="",a=e(".acis-state_selections select:last").find(":selected").text();switch(this.getStateType()){case"all":t=this.getStateName();break;case"county":t=a+", "+this.getStateAbbr();break;case"climdiv":t=this.getStateAbbr()+" "+a+" "+this.options.labels.climdiv.label;break;case"cwa":t=(a||defaults.cwa)+" "+this.options.labels.cwa.label;break;case"basin":t=a+" "+this.options.labels.basin.label}return t},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),e(".acis-stateContainer").find("select").unbind(),e(".acis-stateContainer").children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),e(".acis-stateContainer").find("select").unbind(),e(".acis-stateContainer").buttonBar("disable")},enable:function(){var t=this.setupSubstateMenu;e.Widget.prototype.enable.call(this,arguments),e(".acis-stateContainer").buttonBar("enable"),e(".acis-stateContainer").find("select:first").bind("change",function(){defaults.state=e(this).val(),defaults.climdiv=null,defaults.cwa=null,defaults.county=null,defaults.basin=null,t()}),t()}}),e.widget("acis.stateSelection",{options:{autoShow:!0,statesFile:"states_grid.txt",defState:"MO",mapInteraction:!1},setuptStateMap:function(){var t,a,n,i,o,s,l,r,c,d={meta:"bbox,geojson",state:defaults.state},p="https://data.rcc-acis.org/General/state",u=function(r){o=[],e.each(r.meta[0].geojson.coordinates,function(){s=[],e.each(this[0],function(e,t){s.push(new google.maps.LatLng(t[1],t[0]))}),o.push(s)}),(l=new google.maps.Polygon({paths:o,strokeColor:"#0000ff",strokeOpacity:.75,strokeWeight:1,fillOpacity:0})).setMap(map),overlaysArray.push(l),t=r.meta[0].bbox,a=new google.maps.LatLng(t[1],t[0]),n=new google.maps.LatLng(t[3],t[2]),i=new google.maps.LatLngBounds(a,n),setTimeout(function(){map.fitBounds(i)},500)};if(!1===setupMaps(this.setuptStateMap))return!1;showMap(),e("#map_msg").loadSpinner({message:"Loading map ..."}),window.XDomainRequest?((r=new XDomainRequest).open("GET",p+"?params="+JSON.stringify(d)),r.onload=function(){c=JSON.parse(r.responseText),u(c),e("#map_msg").loadSpinner("fadeOut")},r.onerror=function(){e("#map_msg").loadSpinner("fadeOut")},r.onprogress=function(){},r.ontimeout=function(){},setTimeout(function(){r.send()},0)):e.ajax(p,{type:"GET",data:d,dataType:"json",timeout:1e4,success:u,complete:function(){e("#map_msg").loadSpinner("fadeOut")}})},_create:function(){var t=e("<div></div>"),a=e("<fieldset></fieldset>"),n=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),i=e("<option></option>"),o=e("<label></label>"),s=this,l=this.options.defState,r=this.options.mapInteraction,c=this.element,d=t.clone().addClass("acis-tstateContainer").appendTo(c).loadSpinner({message:"Loading states ..."}),p=a.clone().appendTo(d),u=n.clone().attr("id","tstate").appendTo(p);o.clone().attr("for","tstate").text("State:").prependTo(p),e.acis.stateSelection.prototype.options.mapInteraction=this.options.mapInteraction,e.get(this.options.statesFile,function(t){0===t.length?i.clone().val(l).text("State menu unavailable").appendTo(u):(e.each(JSON.parse(t),function(e,t){i.clone().val(e).text(t).appendTo(u)}),u.val(l).bind("change",function(){defaults.state=e(this).val(),r&&s.setuptStateMap()}))}).fail(function(){i.clone().val(l).text("State menu unavailable").appendTo(u)}).always(function(){d.loadSpinner("fadeOut")}),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||d.addClass("ui-helper-hidden")},_setOption:function(t,a){"mapInteraction"===t&&(a?this.setuptStateMap():hideMap(),e.acis.areaSelection.prototype.options.mapInteraction=a),e.Widget.prototype._setOption.apply(this,arguments)},shower:function(){e(".acis-tstateContainer").show(),e("#tstate").val(defaults.state),this.options.mapInteraction&&this.setuptStateMap()},hider:function(){e(".acis-tstateContainer").hide()},getter:function(){return["state",e("#tstate").val()]},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset")},disable:function(){e.Widget.prototype.disable.call(this,arguments)},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.setuptStateMap()}}),e.widget("acis.singleDateSelection",{options:{sdFormat:"ymd",sdLabel:"Date:",autoShow:!0,tooltipShow:!0},dfinfo:{ymd:{titleFormat:"yyyy-mm-dd",className:"acis-ymdRange",initDate:Date.today().toString("yyyy-MM-dd"),dpOptions:{dateFormat:"yy-mm-dd"}},md:{titleFormat:"mm-dd",className:"acis-mdRange",initDate:Date.today().toString("MM-dd"),dpOptions:{dateFormat:"mm-dd",changeYear:!1}},ym:{titleFormat:"yyyy-mm",className:"acis-ymRange",initDate:Date.parse("lastmonth").toString("yyyy-MM"),dpOptions:{dateFormat:"yy-mm",showButtonPanel:!0,onChangeMonthYear:function(t,a){e(this).datepicker("setDate",new Date(t,a-1))},beforeShow:function(){var t,a,n,i=e(this).val();i.length>0&&(a=(t=i.split("-"))[0],n=t[1]-1,e(this).datepicker("option","defaultDate",new Date(a,n)),e(this).datepicker("setDate",new Date(a,n)))}}},"yy-mm-dd":"ymd","yyyy-mm-dd":"ymd","yy-mm":"ym","yyyy-mm":"ym","mm-dd":"md"},_create:function(){for(var t=e("<fieldset></fieldset>"),a=e("<label></label>"),n=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default"}),i=this.element,o=this.options.sdFormat.toLowerCase(),s=this.options.sdLabel,l=this.dfinfo,r=t.clone().appendTo(i),c=n.clone().attr({id:"tDatepicker"}).appendTo(r);"string"==typeof l[o];)o=l[o];a.clone().attr("for","tDatepicker").html(s).prependTo(r),c.attr("title","Date has the format "+l[o].titleFormat).addClass(l[o].className).val(l[o].initDate).datepicker(l[o].dpOptions),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||r.addClass("ui-helper-hidden"),this.options.tooltipShow&&e("#tDatepicker").tooltip({tooltipClass:"acis-tooltip",position:{my:"left center",at:"right+22 center"}})},getter:function(){for(var t,a,n=this.options.sdFormat.toLowerCase();"string"==typeof this.dfinfo[n];)n=this.dfinfo[n];a=this.dfinfo[n].dpOptions.dateFormat;try{return t="yy-mm"===a?e.datepicker.parseDate("yy-mm-dd",e("#tDatepicker").val()+"-01"):"mm-dd"===a?e.datepicker.parseDate("yy-mm-dd","2000-"+e("#tDatepicker").val()):e.datepicker.parseDate(a,e("#tDatepicker").val()),e.datepicker.formatDate(a,t)}catch(t){return e(document).reportError({errorText:t}),!1}},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.find("input").datepicker().datepicker("destroy"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("input").datepicker().datepicker("disable")},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.element.find("input").datepicker().datepicker("enable")}}),e.widget("acis.dateRangeSelection",{options:{caliconSrc:"/images/calicon.gif",changeFunction:null,makeActive:-1,autoShow:!0},_create:function(){var t,a={dateFormat:"yy-mm-dd",closeOnSelect:!0,rangeStartTitle:"Start date (click a day to set)",rangeEndTitle:"End date (click a day to set)",onClose:function(){setTimeout(function(){"1111-01-01"===e("#sDatepicker").val()&&e("#sDatepicker").val("por"),"9999-12-31"===e("#eDatepicker").val()&&e("#eDatepicker").val("por")},200)},posX:232,posY:140,presetRanges:[{text:"Last 7 Days",dateStart:"today-6days",dateEnd:"Today"},{text:"Last 30 Days",dateStart:"Today-29days",dateEnd:"Today"},{text:"Last 90 Days",dateStart:"Today-89days",dateEnd:"Today"},{text:"Month to Date",dateStart:function(){return Date.today().moveToFirstDayOfMonth()},dateEnd:"Today"},{text:"Previous Month",dateStart:function(){return Date.parse("lastmonth").moveToFirstDayOfMonth()},dateEnd:function(){return Date.parse("lastmonth").moveToLastDayOfMonth()}},{text:"Year to Date",dateStart:function(){return Date.today().moveToMonth(11,-1).moveToLastDayOfMonth().addDays(1)},dateEnd:"Today"},{text:"Oct 1 to Date",dateStart:function(){return Date.today().moveToMonth(8,-1).moveToLastDayOfMonth().addDays(1)},dateEnd:"Today"},{text:"Period of Record",dateStart:"1111-01-01",dateEnd:"9999-12-31"}],presets:{dateRange:"Select Dates"}},n=e("<div></div>"),i=e("<fieldset></fieldset>"),o=e("<label></label>"),s=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-ymdRange"}),l=e("<img></img>",{class:"ui-datepicker-trigger",id:"dp_calicon",alt:"...",title:"Click for shortcuts"}),r=e("<br />"),c=this.element,d=n.clone().appendTo(c);l.attr("src",this.options.caliconSrc).appendTo(c),t=i.clone().appendTo(d),o.clone().text("Start date:").appendTo(t),s.clone().attr("id","sDatepicker").val(Date.today().toString("yyyy-MM-01")).appendTo(t),r.clone().appendTo(d),t=i.clone().appendTo(d),o.clone().text("End date:").appendTo(t),s.clone().attr("id","eDatepicker").val(Date.today().toString("yyyy-MM-dd")).appendTo(t),c.addClass("date_range ui-widget ui-helper-reset ui-helper-clearfix").find("input").attr("title","Dates have the format yyyy-mm-dd"),this.options.changeFunction&&(a.onChange=this.options.changeFunction),e(".acis-ymdRange").daterangepicker(a),this.options.autoShow||c.addClass("ui-helper-hidden")},getter:function(){var t,a,n=this.options.makeActive,i=function(t,a){var i=e(t).val().toLowerCase();try{return"por"===i?a:e.datepicker.parseDate("yy-mm-dd",i)}catch(t){return e(document).reportError({errorText:t+": "+i,makeActive:n}),!1}},o=Date.parse("1111-01-01"),s=Date.parse("9999-12-31"),l=i("#sDatepicker",o),r=i("#eDatepicker",s);return!(!l||!r)&&(l.isAfter(r)?(e(document).reportError({errorText:"Start date is after end date",makeActive:n}),!1):(l.equals(o)?(t="por",e("#sDatepicker").val("por")):t=l.toString("yyyy-MM-dd"),r.equals(s)?(a="por",e("#eDatepicker").val("por")):a=r.toString("yyyy-MM-dd"),{sDate:t,eDate:a}))},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.find("input").datepicker().datepicker("destroy"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("input").datepicker().datepicker("disable")},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.element.find("input").datepicker().datepicker("enable")}}),e.widget("acis.elementSelection",{options:{elements:[],defElement:"maxt",reduces:[],operators:[],mode:"full",makeActive:-1},changeElem:function(){var t,a=this.options.reduces[0][0];switch(this.myElem.val()){case"maxt":t="max";break;case"mint":t="min";break;case"avgt":t="mean";break;case"pcpn":case"snow":t="sum";break;case"snwd":t="max";break;default:t="sum"}e.each(this.options.reduces,function(e,n){if(t===n[0])return a=t,!1}),this.myReduce.val(a).trigger("change")},changeReduce:function(){var e=this;"cnt"===this.myReduce.val()||"pct"===this.myReduce.val()?(this.myOper.val("mint"===e.myElem.val()?"le":"ge"),this.threshSelect.show("slide",200),setTimeout(function(){e.myThresh.focus().select()},200)):"none"!==this.threshSelect.css("display")&&this.threshSelect.hide("slide",100)},_create:function(){var t,a=this,n=this.element,i=e("<fieldset></fieldset>"),o=e("<label></label>"),s=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),l=e("<option></option>"),r=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default"}),c=e("<p></p>"),d=i.clone().addClass("acis-fsElem").appendTo(n);n.addClass("ui-widget ui-helper-reset ui-helper-clearfix"),this.myElem=s.clone().appendTo(d),o.clone().text("Variable").prependTo(d),0===this.options.elements.length&&(this.options.elements=[["maxt","Max temp"],["mint","Min temp"],["avgt","Avg temp"],["pcpn","Precipitation"],["snow","Snowfall"],["snwd","Snow depth"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]]),e(this.options.elements).each(function(e,t){l.clone().val(t[0]).text(t[1]).appendTo(a.myElem)}),this.myElem.val(this.options.defElement),"elementOnly"!==this.options.mode?(t=i.clone().addClass("acis-fsReduce").appendTo(n),this.myReduce=s.clone().appendTo(t),o.clone().text("Summary").prependTo(t),0===this.options.reduces.length&&(this.options.reduces=[["sum","Sum"],["mean","Mean"],["max","Maximum"],["min","Minimum"],["cnt","Number of days"],["pct","Percent of days"]]),e(this.options.reduces).each(function(e,t){l.clone().val(t[0]).text(t[1]).appendTo(a.myReduce)}),a.changeElem(),this.threshSelect=i.clone().addClass("acis-fsThresh").appendTo(n),o.clone().text("Threshold:").prependTo(this.threshSelect),this.myOper=s.clone().appendTo(this.threshSelect),0===this.options.operators.length&&(this.options.operators=[["lt","<"],["le","<="],["eq","="],["ge",">="],["gt",">"],["ne","&ne;"]]),e(this.options.operators).each(function(e,t){l.clone().val(t[0]).html(t[1]).appendTo(a.myOper)}),this.myOper.val("mint"===a.myElem.val()?"le":"ge"),this.myThresh=r.clone().appendTo(this.threshSelect),this.myOper.on("change",function(){a.myThresh.focus().select()}),"numberDaysOnly"===this.options.mode?(c.clone().addClass("acis-uaLabel").text("Criteria:").prependTo(n),d.css("margin-top","0").find("label").css("display","none"),t.css("display","none").find("select").val("cnt"),this.threshSelect.css({float:"left",padding:"0",margin:"0"}).find("label").css("display","none"),this.threshSelect.find("select").css({"margin-top":"3px"}),this.myElem.on("change",function(){a.myOper.val("mint"===a.myElem.val()?"le":"ge")})):(this.threshSelect.addClass("ui-helper-hidden"),this.myElem.on("change",function(){a.changeElem()}),this.myReduce.on("change",function(){a.changeReduce()}))):(d.css("width","100%").find("label").css("margin-left","0").text("Variable:"),d.find("select").css("width","auto"))},getter:function(t){var a=this.options.makeActive,n={interval:t||"dly",duration:1,name:this.myElem.val()};if(this.myReduce&&(e.extend(n,{reduce:{reduce:this.myReduce.val()}}),"cnt"===n.reduce.reduce||"pct"===n.reduce.reduce)){if(""===this.myThresh.val())return e(document).reportError({errorText:"Enter a threshold value",makeActive:a,focusElement:this.myThresh}),!1;n.reduce.reduce+="_"+this.myOper.val()+"_"+this.myThresh.val()}return n},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),"elementOnly"!==this.options.mode&&(this.myOper.off("change"),this.myElem.off("change"),"full"===this.options.mode&&this.myReduce.off("change")),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),"elementOnly"!==this.options.mode&&(this.myOper.off("change"),this.myElem.off("change"),"full"===this.options.mode&&this.myReduce.off("change"))},enable:function(){var t=this;e.Widget.prototype.enable.call(this,arguments),"elementOnly"!==this.options.mode&&(this.myOper.on("change",function(){t.myThresh.focus().select()}),"numberDaysOnly"===this.options.mode?this.myElem.on("change",function(){t.myOper.val("mint"===t.myElem.val()?"le":"ge")}):(this.myElem.on("change",function(){t.changeElem()}),this.myReduce.on("change",function(){t.changeReduce()})))}}),e.widget("acis.seasonSelection",{options:{oneYear:!1,tooltipShow:!0,addSeason:null,addSeasonIndex:6,makeActive:-1,highlightCSS:{color:"blue","font-weight":"normal"},nohighlightCSS:{color:"black","font-weight":"normal"}},highlightSeason:function(){var t,a,n,i,o,s=this,l=e("<fieldset></fieldset>"),r=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-tother",title:"Enter 2-digit month and day in the form mm-dd",value:"mm-dd"}),c=e("input[name=seasonChoices]:checked").val();e(this.seasons).each(function(d,p){n=s.element.find("label:contains("+p[1]+") span"),p[0]===c?"tother"===c?(0===n.parent().parent().find("input.acis-tother").length&&(o=l.clone().appendTo(n.parent().parent()),r.clone().appendTo(o),o.append("<span>to</span>"),r.clone().appendTo(o),o.find("input.acis-tother").on("click",function(){e(this).focus().select()}),s.options.tooltipShow&&o.find("input").tooltip({tooltipClass:"acis-tooltip",position:{my:"left center",at:"right+5 center",of:e(".acis-tother:input:last"),collision:"none"}})),n.parent().parent().find("input.acis-tother:first").focus().select()):0!==p[2].length&&(s.options.oneYear?(a=s.theYear.val(),t="winter"===p[0]||"water"===p[0]?parseFloat(a)-1:a,i=" ("+p[2]+" "+t+"-"+p[3]+" "+a+")"):i=" ("+p[2]+"-"+p[3]+")",n.text(i).css(s.options.highlightCSS)):0!==p[2].length&&(i=" ("+p[2]+"-"+p[3]+")",n.text(i).css(s.options.nohighlightCSS))})},_create:function(){var t,a=this,n=this.element,i=[["annual","Annual","Jan","Dec"],["spring","Spring","Mar","May"],["summer","Summer","Jun","Aug"],["fall","Fall","Sep","Nov"],["winter","Winter","Dec","Feb"],["water","Water Year","Oct","Sep"],["tmonth","Month: <select></select>","",""],["tother","Other:","",""]],o=e("<fieldset></fieldset>"),s=e("<label></label>"),l=e("<option></option>"),r=e("<p></p>"),c=e("<br />"),d=e("<input />",{type:"radio",class:"ui-widget-content ui-corner-all ui-state-default"}),p=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-tyear"});this.options.addSeason&&i.splice(this.options.addSeasonIndex,0,this.options.addSeason),this.seasons=i,this.options.oneYear&&(t=o.clone().appendTo(n),s.clone().text("Year:").appendTo(t),this.theYear=p.clone().attr("maxlength",4).val(Date.today().toString("yyyy")).appendTo(t)),r.clone().text("Period of interest:").addClass("acis-uaLabel").appendTo(n),e(this.seasons).each(function(e,a){t=o.clone().addClass("acis-fsSeason").appendTo(n),d.clone().attr("name","seasonChoices").val(a[0]).appendTo(t),s.clone().html(a[1]+"<span></span>").appendTo(t),c.clone().appendTo(n)}),this.tmonth=this.element.find("label select").addClass("ui-widget-content ui-corner-all ui-state-default").on("change",function(){e(this).parents("fieldset").find("input").prop("checked",!0).trigger("change")}),e(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]).each(function(e,t){l.clone().text(t).val((e<9?"0":"")+(e+1)).appendTo(a.tmonth)}),this.element.find("input[value='annual']").prop("checked",!0),this.highlightSeason(),this.element.addClass("ui-widget ui-helper-reset"),e("input[name=seasonChoices]").on("change",function(){a.highlightSeason()}),this.options.oneYear&&this.theYear.on("change keyup",function(){"tother"!==e("input[name=seasonChoices]:checked").val()&&4===e(this).val().length&&a.highlightSeason()})},getter:function(t){var a,n,i,o,s,l=this.options.makeActive,r=function(t,a){var n,i=e(t).val(),o=i.split("-");if(2!==o.length||!e.isNumeric(o[0])||!e.isNumeric(o[1]))return e(document).reportError({errorText:"bad mmdd",makeActive:l}),!1;try{return n=e.datepicker.parseDate("yy-m-d",a+"-"+i),e.datepicker.formatDate("yy-mm-dd",n)}catch(t){return e(document).reportError({errorText:t,makeActive:l}),!1}};switch(this.options.oneYear?(n=this.theYear.val(),i=this.theYear.val()):t?("por"===(n=t[0])&&(n="1850"),"por"===(i=t[1])&&(i=(new Date).toString("yyyy"))):i=n=Date.today().toString("yyyy"),e("input[name=seasonChoices]:checked").val()||"annual"){case"annual":"por"!==n&&(o=n+"-01-01"),"por"!==i&&(s=i+"-12-31");break;case"spring":"por"!==n&&(o=n+"-03-01"),"por"!==i&&(s=i+"-05-31");break;case"summer":"por"!==n&&(o=n+"-06-01"),"por"!==i&&(s=i+"-08-31");break;case"fall":"por"!==n&&(o=n+"-09-01"),"por"!==i&&(s=i+"-11-30");break;case"winter":"por"!==n&&(o=n+"-12-01"),"por"!==i&&(s=i+"-02-28",Date.isLeapYear(Date.parse(s).getFullYear())&&(s=i+"-02-29"));break;case"water":"por"!==n&&(o=n+"-10-01"),"por"!==i&&(s=i+"-09-30");break;case"tall":"por"!==n&&(o=n+"-01-01"),"por"!==i&&(s=i+"-12-31");break;case"tmonth":"por"!==n&&(o=n+"-"+this.tmonth.val()+"-01"),"por"!==i&&(s=Date.parse(i+"-"+this.tmonth.val()+"-01").moveToLastDayOfMonth().toString("yyyy-MM-dd"));break;case"tother":if("por"!==n&&!(o=r(this.element.find("label:contains('Other')").parent().find("fieldset").find("input:first"),n)))return!1;if("por"!==i&&!(s=r(this.element.find("label:contains('Other')").parent().find("fieldset").find("input:last"),i)))return!1}return this.options.oneYear&&"por"!==n&&"por"!==i&&(a=Date.parse(o)).getMonth()>Date.parse(s).getMonth()&&(o=a.addYears(-1).toString("yyyy-MM-dd")),[o,s]},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),e("input[name=seasonChoices]").off("change"),this.element.find("label select").off("change"),this.options.oneYear&&this.theYear.off("change keyup"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),e("input[name=seasonChoices]").off("change"),this.element.find("label select").off("change"),this.options.oneYear&&this.theYear.off("change keyup")},enable:function(){var t=this;e.Widget.prototype.enable.call(this,arguments),e("input[name=seasonChoices]").on("change",function(){t.highlightSeason()}),this.element.find("label select").on("change",function(){e(this).parents("fieldset").find("input").prop("checked",!0).trigger("change")}),this.options.oneYear&&this.theYear.on("change keyup",function(){"tother"!==e("input[name=seasonChoices]:checked").val()&&4===e(this).val().length&&t.highlightSeason()})}}),e.widget("acis.yearRangeSelection",{options:{defaultStart:"1850",defaultEnd:Date.today().getFullYear(),inputLabel:"Year range:",porMsg:!0},_create:function(){var t,a=this.element,n=e("<div></div>",{class:"ui-helper-hidden choiceExplain"}),i=e("<span></span>"),o=e("<fieldset></fieldset>"),s=e("<label></label>"),l=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-tyear"}),r=o.clone().appendTo(a);e.fn.showOnce=function(a){e(this).on("focus",function(){t.show().text(a),e(this).on("blur keypress",function(){t.hide(),e(this).off("blur keypress focus")})})},s.clone().text(this.options.inputLabel).appendTo(r),l.clone().val(this.options.defaultStart).appendTo(r),i.clone().text("-").appendTo(r),l.clone().val(this.options.defaultEnd).appendTo(r),t=n.clone().appendTo(a),this.element.addClass("ui-widget ui-helper-reset"),r.find("input").on("click",function(){e(this).focus().select()}),this.options.porMsg?(r.find("input:first").showOnce("Enter starting year or 'por' for start of record."),r.find("input:last").showOnce("Enter ending year or 'por' for end of record.")):(r.find("input:first").showOnce("'por' not allowed for this query."),r.find("input:last").showOnce("'por' not allowed for this query."))},getter:function(){return[this.element.find("fieldset input:first").val().toLowerCase(),this.element.find("fieldset input:last").val().toLowerCase()]},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove(),this.element.find("fieldset input").off("click blur keypress focus")},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("fieldset input").off("click blur keypress focus")},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.element.find("fieldset input").on("click",function(){e(this).focus().select()})}}),e.widget("acis.monthRangeSelection",{options:{defaultStart:"1",defaultEnd:"12",makeActive:-1},_create:function(){var t,a=this.options.makeActive,n=this.element,i=e("<span></span>"),o=e("<fieldset></fieldset>"),s=e("<label></label>"),l=e("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-tmonth"}),r=o.clone().appendTo(n);s.clone().text("Month range:").appendTo(r),l.clone().val(this.options.defaultStart).appendTo(r),i.clone().text("-").appendTo(r),l.clone().val(this.options.defaultEnd).appendTo(r),this.element.addClass("ui-widget ui-helper-reset"),r.find("input").on({click:function(){e(this).focus().select()},change:function(){t=Number(e(this).val()),(isNaN(t)||t<1||t>12)&&e(document).reportError({errorText:"Bad month; must be between 1 and 12",makeActive:a,focusElement:e(this)})}})},getter:function(){var t,a=this.options.makeActive,n=0;return e.each(this.element.find("fieldset input"),function(i,o){t=Number(e(o).val()),(isNaN(t)||t<1||t>12)&&(e(document).reportError({errorText:"Bad month; must be between 1 and 12",makeActive:a,focusElement:e(this)}),n+=1)}),!(n>0)&&[parseInt(this.element.find("fieldset input:first").val(),10),parseInt(this.element.find("fieldset input:last").val(),10)]},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove(),this.element.find("fieldset input").off("click")},disable:function(){e.Widget.prototype.disable.call(this,arguments),this.element.find("fieldset input").off("click")},enable:function(){e.Widget.prototype.enable.call(this,arguments),this.element.find("fieldset input").on("click",function(){e(this).focus().select()})}}),e.widget("acis.multiElementPicker",{options:{elements:[["maxt","Max temp"],["mint","Min temp"],["avgt","Avg temp"],["obst","Obs temp"],["pcpn","Precipitation"],["snow","Snowfall"],["snwd","Snow depth"],["hdd_","HDD base 65"],["cdd_","CDD base 65"],["gdd_","GDD base 50"]],defChecked:["maxt","mint","pcpn","snow","snwd"],defDisabled:["snwdnrm","snwddpt","gdd_nrm","gdd_dpt","obstnrm","obstdpt"]},_create:function(){var t,a=this,n=this.element,i=e("<table></table>"),o=e("<tr></tr>"),s=e("<td></td>"),l=e("<th></th>"),r=e("<input />",{type:"checkbox",class:"ui-widget-content ui-corner-all ui-state-default"});this.inputTable=i.clone().addClass("acis-multiInputTable").appendTo(n),t=o.clone(),e(["Variable","Value","Normal","Depart"]).each(function(e,a){l.clone().text(a).appendTo(t)}),t.appendTo(a.inputTable),e(this.options.elements).each(function(n,i){t=o.clone(),s.clone().text(i[1]).appendTo(t),e([i[0],i[0]+"nrm",i[0]+"dpt"]).each(function(e,a){s.clone().html(r.clone().attr("name",a)).appendTo(t)}),t.appendTo(a.inputTable)}),e(this.options.defChecked).each(function(t,a){e("input[name="+a+"]").prop("checked",!0)}),e(this.options.defDisabled).each(function(t,a){e("input[name="+a+"]").prop("disabled",!0)}),this.element.addClass("ui-widget ui-helper-reset")},getter:function(){var t=[];return e(this.inputTable.find("input:checked")).each(function(e,a){t.push(a.name)}),t},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments)},enable:function(){e.Widget.prototype.enable.call(this,arguments)}}),e.widget("acis.yearPicker",{options:{sYear:"1850",eYear:Date.today().getFullYear().toString(10),listArea:null,position:{my:"left top",at:"right top"},open:null,close:null},buildYrTable:function(){var t,a=function(t){t.options.listArea&&(e(t.options.listArea).empty(),e.each(t.yrsSelected,function(a,n){e(t.options.listArea).append(n+" ")}))},n=this,i="",o=this.filterDialog.find("table"),s="por"===this.options.sYear.toLowerCase()?1850:parseInt(this.options.sYear,10),l="por"===this.options.eYear.toLowerCase()?Date.today().getFullYear():parseInt(this.options.eYear,10);for(this.filterDialog.dialog("open"),o.empty(),t=s;t<=l;t+=1)i+="<td>"+t+"</td>",(t-s)%10!=9&&t!==l||(o.append("<tr>"+i+"</tr>"),i="");o.find("td").each(function(){e.inArray(e(this).text(),n.yrsSelected)>=0&&e(this).toggleClass("acis-highlightYr",!0)}),o.find("td").click(function(){e(this).toggleClass("acis-highlightYr"),e(this).hasClass("acis-highlightYr")?(n.yrsSelected.push(e(this).text()),n.yrsSelected.sort()):(t=e.inArray(e(this).text(),n.yrsSelected),n.yrsSelected.splice(t,1)),a(n)}),a(n)},update:function(){var t=this,a=this.options.sYear.toLowerCase(),n=this.options.eYear.toLowerCase();"por"===a&&(a="1850"),"por"===n&&(n=Date.today().getFullYear().toString(10)),e.each(t.yrsSelected,function(e,i){(i<a||i>n)&&t.yrsSelected.splice(e,1)}),t.buildYrTable()},_create:function(){var t=this;this.filterDialog&&0!==this.filterDialog.length||(this.filterDialog=e("<div></div>").appendTo(document.body).addClass("ui-widget").html('<span>Click years of interest</span><br /><table class="acis-yrTable"></table>').dialog({width:470,title:"Year selector",buttons:[{text:"Clear all",click:function(){t.yrsSelected=[],t.buildYrTable()}},{text:"Done",click:function(){e(this).dialog("close")}}],position:t.options.position,open:t.options.open,close:t.options.close})),t.yrsSelected=[],t.buildYrTable()},getter:function(){var e,t=[];for(e=0;e<this.yrsSelected.length;e+=1)t.push(parseInt(this.yrsSelected[e],10));return t},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.children().remove()}}),e.widget("acis.buttonBar",{options:{autoShow:!0,barOrient:"horizontal",barBox:!1},_create:function(){var t,a,n=e("<div></div>"),i=e("<input />",{type:"radio"}),o=e("<label></label>"),s=this.options.barName,l=this.options.buttonDefault||this.options.buttonInfo[0][0],r=this.element,c=n.clone().attr("id",s).appendTo(r);e(this.options.buttonInfo).each(function(e,n){t=i.clone().attr({name:s,id:n[0]}).appendTo(c),a=o.clone().attr("for",n[0]).text(n[1]).appendTo(c),l===n[0]&&(t.prop("checked",!0),a.addClass("ui-state-active"))}),c.buttonset(),"vertical"!==this.options.barOrient?c.css({"text-align":"center","margin-right":0}):(c.find("label").removeClass("ui-corner-left").removeClass("ui-corner-right"),this.options.barBox?(c.find("label:first").addClass("ui-corner-tl"),c.find("label:last").addClass("ui-corner-bl"),c.addClass("acis-barBoxButtons"),r.height(c.height()),n.clone().addClass("acis-barBoxArea").appendTo(r)):(c.find("label:first").addClass("ui-corner-top"),c.find("label:last").addClass("ui-corner-bottom"))),this.element.addClass("ui-widget ui-helper-reset"),this.options.autoShow||c.hide()},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments),e("#"+this.options.barName).buttonset("disable")},enable:function(){e.Widget.prototype.enable.call(this,arguments),e("#"+this.options.barName).buttonset("enable")}}),e.widget("acis.loadSpinner",{options:{message:"Processing ...",disableElement:"#go"},_create:function(){var t=e("<div></div>",{class:"loading"}),a=e("<span></span>"),n=t.clone().appendTo(this.element);a.clone().text(this.options.message).appendTo(n),e(this.options.disableElement).button("disable")},fadeOut:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.children(".loading").remove(),e(this.options.disableElement).button("enable")},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.children(".loading").remove(),e(this.options.disableElement).button("enable")}}),e.widget("acis.reportError",{options:{errorText:"Unknown error",makeActive:-1,focusElement:null},_create:function(){this.errorDialog||(this.errorDialog=e("<div></div>").appendTo(document.body).addClass("ui-widget").css("padding","0").append('<div class="ui-widget-content ui-state-error ui-corner-all ui-helper-clearfix errorBox"><span class="ui-icon ui-icon-alert"></span><span class="ui-state-error-text"></span></div>').dialog({width:550,modal:!0,minHeight:40}).on("click",function(){e(this).dialog("close")}))},_init:function(){var t=this.options.errorText,a=this.options.makeActive,n=this.options.focusElement;e.each([{reperr:"Unknown station id",accact:1},{reperr:"bad station",msgtxt:"Bad station selection",accact:1},{reperr:"elems",msgtxt:"Bad element selection. Select one or more variables",accact:0},{reperr:"sDate",msgtxt:"Bad starting date selection. Make sure the date is of the form yyyy-mm-dd.",accact:0},{reperr:"eDate",msgtxt:"Bad ending date selection. Make sure the date is of the form yyyy-mm-dd.",accact:0},{reperr:"bad mmdd",msgtxt:"Bad date. Make sure the month and day are digits of the form mm-dd.",accact:0},{reperr:"bad latlon",msgtxt:"Invalid input - latitudes and longitudes must be numbers",accact:1},{reperr:"big area",msgtxt:"Select a smaller area",accact:1},{reperr:"ajaxError",msgtxt:"Error processing request"}],function(e,n){if(t.indexOf(n.reperr)>-1)return n.msgtxt&&(t=n.msgtxt),n.accact&&!a&&(a=n.accact),!1}),this.errorDialog.dialog("open").one("dialogclose",function(){e(this).find("span:last").empty(),a>=0&&e(":ui-accordion").length&&e(":ui-accordion").accordion("option","active")!==a&&e(":ui-accordion").accordion("option","active",a),n&&(e(n).effect("highlight",{color:"red"},2e3),setTimeout(function(){e(n).focus().select()},500))}).find("span:last").text("Error: "+t)}}),e.widget("acis.areaWithinState",{options:{areas:[["state","State"],["cwa","CWA"],["climdiv","Division"],["basin","Basin"],["county","County"]],autoShow:!0,defArea:"county",slabel:"Summarization area"},_create:function(){var t=this,a=this.element,n=this.options.defArea,i=e("<fieldset></fieldset>"),o=e("<label></label>"),s=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),l=e("<option></option>"),r=i.clone().addClass("acis-state-area").attr("id","acis-state-area").attr("title","Gridded data will be summarized over each of these areas within a state/bounding box").appendTo(a);a.addClass("ui-widget ui-helper-reset ui-helper-clearfix").css("margin-top","4px"),this.myArea=s.clone().appendTo(r),o.clone().text(this.options.slabel+":").prependTo(r),e(this.options.areas).each(function(e,a){l.clone().val(a[0]).text(a[1]).appendTo(t.myArea)}),this.myArea.val(n),this.options.autoShow||a.addClass("ui-helper-hidden")},getter:function(){return e("#acis-state-area select").val()},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments)},enable:function(){e.Widget.prototype.enable.call(this,arguments)}}),e.widget("acis.spatialSummarySelection",{options:{smrys:[["mean","Mean"],["max","Maximum"],["min","Minimum"],["pct","Percent of area passing threshold"],["fct","Fraction of area passing threshold"]],autoShow:!0},_create:function(){var t,a=this,n=this.element,i=e("<fieldset></fieldset>"),o=e("<label></label>"),s=e("<select></select>",{class:"ui-widget-content ui-corner-all ui-state-default"}),l=e("<option></option>"),r=i.clone().addClass("acis-fsSpatialSummary").attr("id","acis-spatialSummary").attr("title","Type of summarization to be performed over each of the areas").appendTo(n);if(n.addClass("ui-widget ui-helper-reset ui-helper-clearfix").css("margin-top","4px"),this.mySmry=s.clone().appendTo(r),o.clone().text("Spatial summary:").prependTo(r),e(this.options.smrys).each(function(e,t){l.clone().val(t[0]).text(t[1]).appendTo(a.mySmry)}),e(".acis-fsElem select").length)switch(e(".acis-fsElem select").val()){case"maxt":t="max";break;case"mint":t="min";break;case"avgt":case"pcpn":t="mean";break;case"snow":case"snwd":t="max";break;default:t="mean"}this.mySmry.val(t),this.options.autoShow||n.addClass("ui-helper-hidden")},getter:function(){return e("#acis-spatialSummary select").val()},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.removeClass("ui-widget ui-helper-reset"),this.element.children().remove()},disable:function(){e.Widget.prototype.disable.call(this,arguments)},enable:function(){e.Widget.prototype.enable.call(this,arguments)}})}(jQuery);
/* xmacis2_utils
 * Version 1.0.66
 * 
 * Keith Eggleston
 *  Northeast Regional Climate Center
 */
var highchartColors,stationsSingleButtons,stationsMultiButtons,defaults={},input_params={},map=null,dragZoom=null,markersArray=[],overlaysArray=[],Highcharts=null,areaButtons=null;function numberPad(e,t,a){var n=e.toString();for(a||(a="0");n.length<t;)n=a+n;return n}function endPad(e,t,a){for(;e.length<t;)e+=a;return e}function roundNum(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function roundStr(e,t){return roundNum(parseFloat(e),t).toFixed(t)}function roundFix(e,t){return isNaN(e)||(e=roundNum(e,t).toFixed(t)),e}function getWindowSize(){var e={height:0,width:0};return"number"==typeof window.innerWidth?(e.width=window.innerWidth,e.height=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e.width=document.body.clientWidth,e.height=document.body.clientHeight),e}function sizeBoxes(){if(document.getElementById){var e=getWindowSize();e.height>0&&($("#leftbox").outerHeight(e.height-15),$("#rightbox").outerHeight(e.height-15),$("#rightbox").outerWidth(e.width-$("#leftbox").outerWidth()-17),$("#map_area").outerWidth(Math.min($("#rightbox").innerWidth(),675)),$("#results_mask").outerWidth($("#rightbox").innerWidth()),$("#results_mask").outerHeight($("#rightbox").innerHeight()))}}function sortByDistance(e,t){var a=e.distance,n=t.distance;return a<n?-1:a>n?1:0}function arrSort(e){return function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}}function hilo2d(e){return-1!==e&&(e=1),function(t,a){var n=parseFloat(t[0],10),o=parseFloat(a[0],10);return n>o?-1*e:n<o?e:t[1]>a[1]?-1:t[1]<a[1]?1:0}}function ymdToUTC(e){for(var t=e.split("-");t.length<3;)t.push(1);return Date.UTC(t[0],t[1]-1,t[2],0)}function dateStart(e,t){var a=new Date.parse(e);return new Date(a.addDays(-(t-1))).toString("yyyy-MM-dd")}function dateDiff(e,t){var a=new Date.parse(e),n=new Date.parse(t);return Math.round((n.getTime()-a.getTime())/864e5)}function getDefaults(){defaults.stn_select_type=$.jStorage.get("stn_select_type","list_button"),defaults.sId=$.jStorage.get("sId","KDCA"),defaults.idType=$.jStorage.get("idType","any"),defaults.multiStn_select_type=$.jStorage.get("multiStn_select_type","state_button"),defaults.gridArea_select_type=$.jStorage.get("gridArea_select_type","gstate_button"),defaults.state_select_type=$.jStorage.get("state_select_type","cwa"),defaults.state=$.jStorage.get("state","MD"),defaults.bbox=$.jStorage.get("bbox",["West","South","East","North"]),defaults.county=$.jStorage.get("county",null),defaults.cwa=$.jStorage.get("cwa","LWX"),defaults.basin=$.jStorage.get("basin",null),defaults.climdiv=$.jStorage.get("climdiv",null),defaults.accordion=$.jStorage.get("accordion",1),defaults.tooltips=$.jStorage.get("tooltips",1),defaults.leftboxSize=$.jStorage.get("leftboxSize",null),defaults.resultsareaSize=$.jStorage.get("resultsareaSize",null)}function setDefaults(){$.each(defaults,function(e,t){$.jStorage.set(e,t)})}function column_headers(e,t){var a,n,o,i={maxt:"Max Temperature",mint:"Min Temperature",avgt:"Avg Temperature",obst:"At Obs Temperature",pcpn:"Precipitation",snow:"Snowfall",snwd:"Snow Depth",hdd:"HDD",cdd:"CDD",gdd:"GDD",mly_maxt:"Max Temperature",mly_mint:"Min Temperature",mly_avgt:"Avg Temperature",mly_pcpn:"Precipitation"},r={1:"Normal",departure:"Departure",91:"Normal",departure91:"Departure"},s={sum:"Total",mean:"Mean",max:"Highest",min:"Lowest",cnt:"Number of Days",pct:"Percent of Days",fct:"Fraction of Days",run:"Number of Consecutive Days",nrm:"Normal",dpt:"Departure",first:"",last:""},l={lt:"<",le:"<=",eq:"=",ge:">=",gt:">",ne:"&ne;"};return t||(t=[]),$.each(e,function(e,c){a="",o=c.name?i[c.name]:"",c.reduce?-1===c.reduce.reduce.indexOf("_")?a+=s[c.reduce.reduce]+" "+o+" ":(n=c.reduce.reduce.split("_"),a+=s[n[0]]+" "+o+" "+l[n[1]]+" "+n[2]+" "):!c.smry||void 0!==c.smry.length&&1!==c.smry.length?a+=o+" ":-1===c.smry.reduce.indexOf("_")?a+=s[c.smry.reduce]+" "+o+" ":(n=c.smry.reduce.split("_"),a+=s[n[0]]+" "+o+" "+l[n[1]]+" "+n[2]+" "),c.base&&(a+=" Base "+c.base),c.normal&&(a+=r[c.normal]+" "),c.season_start&&(a+=" "+Date.parse("2010-"+c.season_start).toString("MMM d")+" to "+Date.parse(input_params.sDate).toString("MMM d")),t.push(a)}),t}function trimResults(e){var t,a,n=e.length,o=-1;for(t=0;t<e.length;t+=1){for(a=1;a<e[t].length;a+=1)if("M"!==e[t][a]){n=t;break}if(n===t)break}for(t=e.length-1;t>=0;t-=1){for(a=1;a<e[t].length;a+=1)if("M"!==e[t][a]){o=t;break}if(o===t)break}return n<=o?e.slice(n,o+1):[]}function trimListResults(e,t){var a,n,o=e.length,i=-1;for(a=0;a<e.length;a+=1){for(n=1;n<=t;n+=1)if("M"!==("object"!=typeof e[a][n][0]?e[a][n][0]:e[a][n][0][0])){o=a;break}if(o===a)break}for(a=e.length-1;a>=0;a-=1){for(n=1;n<=t;n+=1)if("M"!==("object"!=typeof e[a][n][0]?e[a][n][0]:e[a][n][0][0])){i=a;break}if(i===a)break}return o<=i?e.slice(o,i+1):[]}function trimListByMcnt(e,t,a){var n,o,i=e.length,r=-1;for(n=0;n<e.length;n+=1){for(o=1;o<=t;o+=1)if(e[n][o][a]<365){i=n;break}if(i===n)break}for(n=e.length-1;n>=0;n-=1){for(o=1;o<=t;o+=1)if(e[n][o][a]<365){r=n;break}if(r===n)break}return i<=r?e.slice(i,r+1):[]}function filterResults(e,t,a){var n,o;for(n=e.length-1;n>=0;n-=1)o=e[n][0].split("-"),-1===$.inArray(parseInt(o[t],10),a)&&e.splice(n,1);return e}function calcLegacyAvgTempList(e,t){var a,n,o,i,r=[];return $.each(e,function(e,s){t?(o="M"!==s[1][0]?roundNum(s[1][0],1):"M",i="M"!==s[2][0]?roundNum(s[2][0],1):"M"):(o="M"!==s[1]?roundNum(s[1],1):"M",i="M"!==s[2]?roundNum(s[2],1):"M"),a="M"!==o&&"M"!==i?roundStr((o+i)/2,1):"M",t?(n=s[1][1]+s[2][1],r.push([s[0],[a,n]])):r.push([s[0],a])}),r}function calcLegacyAvgTempTable(e,t){var a,n,o,i,r,s=[];return $.each(e,function(e,l){a=[],$.each(l[1],function(e){t?(i="M"!==l[1][e][0]?roundNum(l[1][e][0],1):"M",r="M"!==l[2][e][0]?roundNum(l[2][e][0],1):"M"):(i="M"!==l[1][e]?roundNum(l[1][e],1):"M",r="M"!==l[2][e]?roundNum(l[2][e],1):"M"),n="M"!==i&&"M"!==r?roundStr((i+r)/2,1):"M",t?(o=l[1][e][1]+l[2][e][1],a.push([n,o])):a.push(n)}),s.push([l[0],a])}),s}function calcLegacyAvgTempMulti(e,t){var a,n,o,i;return $.each(e,function(e,r){t?(o="M"!==r.data[0][0]?roundNum(r.data[0][0],1):"M",i="M"!==r.data[1][0]?roundNum(r.data[1][0],1):"M"):(o="M"!==r.data[0]?roundNum(r.data[0],1):"M",i="M"!==r.data[1]?roundNum(r.data[1],1):"M"),a="M"!==o&&"M"!==i?roundStr((o+i)/2,1):"M",t?(n=r.data[0][1]+r.data[1][1],r.data=[[a,n]]):r.data=[a]}),e}function loess(e,t){function a(e){var t=1-e*e*e;return t*t*t}var n,o,i,r,s,l,c,d,p,u,m,h,g,f,$,b,v,_,y,x=t.bandwidth||.3,S=e.map(function(e){return e[0]}),k=e.map(function(e){return e[1]}),C=[],w=0,M=Math.floor(x*S.length)-1;for(n=0;n<S.length;n+=1){for(o=S[n],n>0&&M<S.length-1&&S[M+1]-S[n]<S[n]-S[w]&&(w+=1,M+=1),i=S[n]-S[w]>S[M]-S[n]?w:M,r=Math.abs(1/(S[i]-o)),s=0,l=0,c=0,d=0,p=0,u=w;u<=M;)m=S[u],h=k[u],s+=g=a((u<n?o-m:m-o)*r),l+=f=m*g,c+=m*f,d+=h*g,p+=h*f,u+=1;y=(b=d/s)-(_=(v=c/s)===($=l/s)*$?0:(p/s-$*b)/(v-$*$))*$,C[n]=_*o+y}return S.map(function(e,t){return[e,C[t]]})}function findLineByLeastSquares(e){var t,a,n,o=0,i=0,r=0,s=0,l=0,c=0,d=0,p=[];if(e.length>0){for(t=0;t<e.length;t+=1)o+=c=e[t][0],i+=d=e[t][1],s+=c*c,r+=c*d,l+=1;for(n=i/l-(a=(l*r-o*i)/(l*s-o*o))*o/l,t=0;t<e.length;t+=1)d=(c=e[t][0])*a+n,p.push([c,d])}return p}function movingAverage(e,t){var a,n,o=[],i=0,r=0;for(a=0;a<e.length;a+=1)null!==(n=e[a][1])&&(i+=n,r+=1),a>=t.period&&(null!==(n=e[a-t.period][1])&&(i-=n,r-=1),o.push([e[a][0],r>0?i/r:null]));return o}function mask_results(){$("#results_mask").fadeTo(500,.8).position({my:"left top",at:"left+1 top+1",of:"#rightbox",collision:"none"})}function unmask_results(){$("#results_mask").fadeOut(500)}function checkboxBar(e,t){var a,n,o=[["match","No differences"],["different",t+"/Other differences"],["baseMiss",t+" missing/Other present"],["itemMiss",t+" present/Other missing"]],i=$("<div></div>"),r=$("<input />",{type:"checkbox"}),s=$("<label></label>"),l="compareType_selection";0===$("#"+l).length?($('<span class="compare_barTitle">Display days with (click to toggle):</span>').appendTo(e),a=i.clone().attr("id",l).appendTo(e),$(o).each(function(e,t){r.clone().attr({name:l,id:t[0]}).prop("checked",!0).appendTo(a),s.clone().attr("for",t[0]).text(t[1]).addClass("compare_"+t[0]).appendTo(a)}),a.buttonset(),$("#compareType_selection input").on("click",function(){$("label[for="+$(this).attr("id")+"]").toggleClass("compare_disabled_button"),$("#compareTable tbody tr").addClass("ui-helper-hidden"),$.each($("#compareType_selection input:checked"),function(e,t){n="compare_"+t.id.split("_")[0],$("#compareTable td."+n).parent().removeClass("ui-helper-hidden")})}),$(e).append("<br class='clear' />")):$(o).each(function(e,t){$("#"+t[0]).prop("checked",!0),$("label[for="+t[0]+"]").removeClass("compare_disabled_button")})}function loadChartScript(){if(!Highcharts){var e=document.createElement("script");e.type="text/javascript",e.src="https://xmacis.rcc-acis.org/js/highstock_6.0.4.min.js",document.body.appendChild(e)}}function setupChartArea(){$("#results_area").append('<div id="resizer"><div id="chart_area"></div></div>')}function setupChartResizer(){var e=$("#chart_area").highcharts();$("#resizer").resizable({resize:function(){e.setSize(this.offsetWidth-2,this.offsetHeight-10,!1)}})}function disableControls(){return{navigator:{enabled:!1},rangeSelector:{enabled:!1},scrollbar:{enabled:!1}}}function defineGraphOptions(e){var t=e&&e.yaxisCnt?e.yaxisCnt:1,a=highchartColors?highchartColors.darkColor:"darkblue",n=highchartColors?highchartColors.medColor:"#3baae3",o=highchartColors?highchartColors.ltColor:"#aed0ea",i=highchartColors?highchartColors.vltColor:"#e4f1fb",r=highchartColors?highchartColors.shadingColor:"#4572a7",s=[{title:{style:{color:a,fontWeight:"bold"}},lineColor:n,gridLineColor:o,gridLineWidth:1,minorGridLineWidth:1,minorGridLineDashStyle:"dot",minorTickInterval:"auto",minorTickWidth:1,showFirstLabel:!0,showLastLabel:!0,labels:{align:"right",x:-5,y:3,style:{color:a}},opposite:!1},{title:{text:"Temperature (C)",style:{color:a,fontWeight:"bold"}},lineColor:n,gridLineWidth:0,minorGridLineWidth:0,minorTickInterval:"auto",minorTickWidth:1,showFirstLabel:!0,showLastLabel:!0,labels:{align:"left",x:5,y:3,style:{color:a}},opposite:!0,linkedTo:0}];return{chart:{renderTo:"chart_area",zoomType:"x",height:$(41).toPx().replace("px",""),borderWidth:0,borderColor:n,spacingBottom:20,width:$("#results_area").width()-15},colors:["fuchsia","aqua","orange","purple","silver","lime","yellow","maroon","navy","olive","teal"],title:{style:{color:a}},subtitle:{text:"Click and drag to zoom to a shorter time interval",style:{color:n}},credits:{text:"Powered by ACIS",href:"http://www.rcc-acis.org",style:{color:n}},navigation:{buttonOptions:{theme:{states:{hover:{fill:o}}}},menuItemHoverStyle:{background:o,color:a}},navigator:{handles:{backgroundColor:i,borderColor:a},margin:15,outlineColor:a,xAxis:{lineColor:n,gridLineColor:o,labels:{style:{color:a}}},series:{color:r,fillOpacity:.4}},rangeSelector:{buttonSpacing:0,buttonTheme:{fill:i,stroke:n,"stroke-width":1,style:{color:n},states:{hover:{fill:o,style:{color:a}},select:{fill:r,style:{color:"white"}}}},inputStyle:{color:a},labelStyle:{color:a},selected:5},scrollbar:{barBackgroundColor:i,barBorderColor:a,buttonBorderColor:a,buttonArrowColor:a,rifleColor:a,trackBorderColor:a},legend:{enabled:!0,borderColor:n,borderRadius:5,borderWidth:1,margin:10,reversed:!1,itemStyle:{color:a,fontSize:"92%",fontWeight:"normal"}},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"-",day:"%b %e",week:"%b %e",month:"%b %Y"},minRange:6912e5,lineColor:n,gridLineColor:o,gridLineWidth:1,startOnTick:!1,endOnTick:!1,labels:{overflow:!1,style:{color:a}}},yAxis:1===t?s[0]:s,plotOptions:{line:{lineWidth:2,shadow:!1,dataGrouping:{enabled:!1},cursor:"pointer",states:{hover:{enabled:!1}},marker:{enabled:!1,symbol:"diamond",radius:3,states:{hover:{enabled:!1}}}},area:{lineWidth:2,fillOpacity:.1,shadow:!1,dataGrouping:{enabled:!1},cursor:"pointer",marker:{enabled:!1,symbol:"diamond",radius:3,states:{hover:{enabled:!1}}}},arearange:{fillOpacity:.5,shadow:!1,lineWidth:.1,states:{hover:{lineWidthPlus:0}},dataGrouping:{enabled:!1},marker:{enabled:!1}},column:{fillOpacity:.1,shadow:!1,dataGrouping:{enabled:!1},stacking:"normal",pointPadding:0},scatter:{marker:{radius:3}},columnrange:{shadow:!1,lineWidth:1,pointPadding:.1,borderWidth:0,dataGrouping:{enabled:!1}}},series:[]}}function addRangeButtons(e){var t=[];return e>1&&(t.push({type:"year",count:1,text:"1 yr"}),e>=10&&(t.push({type:"year",count:10,text:"10 yrs"}),e>=30&&t.push({type:"year",count:30,text:"30 yrs"}))),t.push({type:"all",text:"All"}),t}function loadDragZoom(){$.getScript("https://xmacis.rcc-acis.org/js/keydragzoom_min.js")}function loadInfobox(e){$.getScript("https://xmacis.rcc-acis.org/js/infobox_packed.js",e)}function mapInit(){var e={zoom:7,center:new google.maps.LatLng(40,-96),mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},streetViewControl:!1,scaleControl:!0,fullscreenControl:!1};map=new google.maps.Map(document.getElementById("map_img"),e),loadDragZoom()}function loadMapScript(e){var t=document.createElement("script");window.initialize=function(){mapInit(),e&&e()},t.type="text/javascript",t.src="https://maps.google.com/maps/api/js?key=AIzaSyBdUm6Zx1hSe6kHpUWa7cGwYQfEmCzXYRI&v=3&libraries=geometry&callback=initialize",document.body.appendChild(t)}function clearMarkers(){markersArray&&($.each(markersArray,function(e,t){t.setMap(null)}),markersArray.length=0)}function clearOverlays(){overlaysArray&&($.each(overlaysArray,function(e,t){t.setMap(null)}),overlaysArray.length=0)}function clearMap(){clearMarkers(),clearOverlays()}function addMarker(e,t){var a,n={triangleIcon:{url:"/images/triangle_12.png",size:new google.maps.Size(13,12),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(6,6)},bppIcon:{url:"/images/blue-pushpin_sm.png",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(9,24)},stationIcon:{url:"/images/blues_small.gif",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(9,24)},cocoIcon:{url:"/images/cocorahs_small.gif",size:new google.maps.Size(16,16),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},snotelIcon:{url:"/images/snotel_small.gif",size:new google.maps.Size(16,16),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},rawsIcon:{url:"/images/raws_small.gif",size:new google.maps.Size(16,16),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},centerIcon:{url:"/images/center.png",size:new google.maps.Size(18,18),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(9,9)}},o={url:"/images/lbs_shadow.png",size:new google.maps.Size(36,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(9,24)},i={position:e,map:map};return n[t]&&(i.icon=n[t],"bppIcon"===t&&(i.shadow=o)),a=new google.maps.Marker(i),markersArray.push(a),a}function showMap(){mask_results(),$("#map_area").is(":visible")||($("#border_mask").show("slide","fast",function(){$("#map_area").show("slide","slow");try{google.maps.event.trigger(map,"resize")}catch(e){loadMapScript()}}).position({my:"left top",at:"right-1 top+1",of:"#leftbox",collision:"none"}),$("#restoreMap").is(":visible")&&$("#restoreMap").hide(),$("#closeMap").is(":visible")||$("#closeMap").show())}function hideMap(){$("#map_area").is(":visible")&&($("#map_area").hide("slide","fast",function(){$("#border_mask").hide("slide","fast")}),$("#closeMap").is(":visible")&&$("#closeMap").hide()),unmask_results()}function enableDragZoom(){var e,t,a,n={key:"shift",boxStyle:{border:"2px solid red",backgroundColor:"transparent",opacity:.9},veilStyle:{backgroundColor:"gray",opacity:.1,cursor:"crosshair"},visualEnabled:!0};try{map.enableKeyDragZoom(n)}catch(e){setTimeout(function(){map.enableKeyDragZoom(n)},1e3)}finally{setTimeout(function(){e=map.getDragZoomObject(),google.maps.event.addListener(e,"activate",function(){$("#map_msg").empty().text("Drag box over area of interest")}),google.maps.event.addListener(e,"dragstart",function(){clearMap(),$("#map_msg").empty()}),google.maps.event.addListener(e,"dragend",function(e){t=e.getNorthEast(),a=e.getSouthWest(),$(".bbox_s").val(a.lat().toFixed(2)),$(".bbox_w").val(a.lng().toFixed(2)),$(".bbox_n").val(t.lat().toFixed(2)),$(".bbox_e").val(t.lng().toFixed(2)),defaults.bbox=[a.lng(),a.lat(),t.lng(),t.lat()],$("#inputs").hasClass("ui-accordion")&&$("#inputs").accordion("option","active")!==$("#inputs .ui-accordion-header").index($("#station_acc"))&&$("#inputs").accordion("option","active",$("#inputs .ui-accordion-header").index($("#station_acc"))),$("#multi_stn_select").is(":visible")?$("#multi_stn_select").bboxSelection("showBbox"):$("#grid_stn_select").is(":visible")&&$("#grid_stn_select").bboxSelection("showBbox")}),$("#map_msg").show().append("Click the Zoom button or hold down shift key and drag box for selection")},1e3),dragZoom=1}}function setupMaps(e){var t=$("#product_select").data("productId");if(!map)return loadMapScript(e),!1;$(".mapButton").hide(),$("#map_msg").empty().show(),clearMap(),t.indexOf("MultiProduct")>=0&&"bbox_button"===defaults.multiStn_select_type||t.indexOf("GridProduct")>=0&&"gbbox_button"===defaults.gridArea_select_type?dragZoom||enableDragZoom():dragZoom&&(map.disableKeyDragZoom(),dragZoom=0)}function addBbox(e,t){var a,n;a=new google.maps.LatLngBounds(e,t),n=new google.maps.Rectangle({map:map,bounds:a,strokeColor:"#ff0000",strokeWeight:2,fillOpacity:0}),overlaysArray.push(n),map.fitBounds(a)}function postSuccess(e,t,a){$(".loading").length&&$(".loading").parent().loadSpinner("fadeOut"),e?e.error&&!a?$(document).reportError({errorText:e.error}):t(e):$(document).reportError({errorText:"No results for request"})}function postError(){$(".loading").parent().loadSpinner("fadeOut"),$(document).reportError({errorText:"Error obtaining data"})}function postResults(e,t,a){var n,o,i="https://data.rcc-acis.org"+e;window.XDomainRequest?((n=new XDomainRequest).open("GET",i+"?params="+JSON.stringify(input_params)),n.onload=function(){postSuccess(JSON.parse(n.responseText),t,a)},n.onerror=postError,n.onprogress=function(){},n.ontimeout=function(){},setTimeout(function(){n.send()},0)):(o={params:JSON.stringify(input_params),output:"json"},$.ajax(i,{type:"POST",data:o,dataType:"json",crossDamain:!0,success:function(e){postSuccess(e,t,a)},error:postError}))}function getElementSelection(e,t){var a;return t||(t="element_area"),!!(a=$("#"+t).elementSelection("getter",e||"dly"))&&(input_params.elems=[a],!0)}function getMultiElementSelection(e,t){var a;return input_params.elems=[],$.each($("div."+(t||"element_list")),function(t,n){if(!(a=$(n).elementSelection("getter",e||"mly")))return!1;input_params.elems.push(a)}),!0}function getOptionsDaily(){var e,t,a=["maxt","mint","avgt","obst","pcpn","snow","snwd","hdd","cdd","gdd"];return $($("#element_area").multiElementPicker("getter")).each(function(n,o){t=o.substring(0,4).replace("_",""),$.inArray(t,a)>=0&&((e={}).name=t,-1!==o.search("nrm")?(e.normal="91",e.prec="pcpn"===t?2:1):-1!==o.search("dpt")&&(e.normal="departure91",e.prec="pcpn"===t?2:1),input_params.elems.push(e))}),0!==input_params.elems.length||($("#results_area").loadSpinner("fadeOut"),$(document).reportError({errorText:"bad elems"}),!1)}function getDatesNormals(e){var t,a,n,o,i=$("#month_area").monthRangeSelection("getter");return!!i&&(n=i[0],o=i[1],"mly"===e?(input_params.sDate="2010-"+numberPad(n,2),input_params.eDate=(n<=o?"2010-":"2011-")+numberPad(o,2)):(input_params.sDate="2010-"+numberPad(n,2)+"-01",a=n<=o?2010:2011,t=new Date(new Date(a,o,1)-1).getDate(),input_params.eDate=a+"-"+numberPad(o,2)+"-"+numberPad(t,2)),!0)}function getDateRangeYY(e){var t,a,n;return e=e||"year_area",a=(t=$("#"+e).yearRangeSelection("getter"))[0],n=t[1],"por"!==a&&"por"!==n&&a>n?($(document).reportError({errorText:"Start date is after end date",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1):(input_params.sDate=a+("por"!==a?"-01-01":""),input_params.eDate=n+("por"!==n?"-12-31":""),!0)}function getDateRangeMM(){var e,t,a=$("#month_area").monthRangeSelection("getter");return!!a&&(e=a[0],t=a[1],"por"!==input_params.sDate&&(input_params.sDate=Date.parse(input_params.sDate).set({month:e-1}).toString("yyyy-MM-dd"),e>t&&(input_params.sDate=Date.parse(input_params.sDate).addYears(-1).toString("yyyy-MM-dd"))),"por"!==input_params.eDate&&(input_params.eDate=Date.parse(input_params.eDate).set({month:t-1}).moveToLastDayOfMonth().toString("yyyy-MM-dd")),!0)}function getSeasons(e){var t,a;return e||(e="days"),$("#year_area").length>0?(t=$("#year_area").yearRangeSelection("getter"),a=$("#season_area").seasonSelection("getter",t)):a=$("#season_area").seasonSelection("getter"),!!a&&("days"===e||"tother"===$("input[name=seasonChoices]:checked").val()?(input_params.sDate=a[0],input_params.eDate=a[1]):"months"===e&&(input_params.sDate=a[0].substr(0,7),input_params.eDate=a[1].substr(0,7)),!0)}function getFilterMonths(){var e,t,a,n=[],o=$("#month_area").monthRangeSelection("getter");if(!o)return!1;if((t=o[0])<=(a=o[1]))for(e=t;e<=a;e+=1)n.push(e);else{for(e=t;e<=12;e+=1)n.push(e);for(e=1;e<=a;e+=1)n.push(e)}return n}function getStationsMultiInput(){var e;switch($("input[name=multiStn_select_type]:checked").attr("id")){case"state_button":return(e=$("#multi_stn_select").areaSelection("getter"))?(input_params[e[0]]=e[1],!0):($(document).reportError({errorText:"Cannot access data by this method for this area",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1);case"bbox_button":return input_params.bbox=$("#multi_stn_select").bboxSelection("getter"),input_params.bbox?!0:($("#results_area").loadSpinner("fadeOut"),!1)}}function getStationsGridInput(){var e;switch($("input[name=gridArea_select_type]:checked").attr("id")){case"gstate_button":return(e=$("#grid_stn_select").stateSelection("getter"))?(input_params[e[0]]=e[1],!0):($(document).reportError({errorText:"Cannot access data by this method for this area",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1);case"gbbox_button":return input_params.bbox=$("#grid_stn_select").bboxSelection("getter"),!!input_params.bbox}}function getStationsSingleInput(){switch($("input[name=stn_select_type]:checked").attr("id")){case"id_button":input_params.sid=$("#single_stn_select").stationId("getter");break;case"srch_button":input_params.sid=$("#single_stn_select").stationSrch("getter");break;case"list_button":input_params.sid=$("#single_stn_select").stationList("getter")}return!!input_params.sid||($(document).reportError({errorText:"bad station",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1)}function getOutputChoice(){var e,t,a,n=$("[name=outopt]");if(!n.length)return!1;if("select"===n.prop("tagName").toLowerCase())e=n.val();else if("radio"===n.prop("type"))e=$("[name=outopt]:checked").val();else if("checkbox"===n.prop("type"))for(e=[],t=0;t<n.length;t+=1)a=n.get(t).id,$("#"+a).prop("checked")&&e.push($("#"+a).val());return e}function getResetAccum(){return $("#accumReset").prop("checked")}function getMaxmissing(){return $("#maxmissOption").prop("checked")&&$("#maxMiss").val().length&&$.each(input_params.elems,function(e,t){$.extend(t,{maxmissing:$("#maxMiss").val()})}),!0}function getRunmissing(){return $("#runmissOption").prop("checked")&&$("#runMiss").val().length&&($.extend(input_params.elems[0].smry,{run_maxmissing:$("#runMiss").val()}),input_params.elems[0].smry.add=["date","rmcnt"]),!0}function getMaxmissingAlmanac(e,t){var a,n;return t||(t=input_params.elems),$("#maxmissOption").prop("checked")&&$.each(["MT","MP","MD","AT","AP","AD"],function(o,i){a=$("#maxMiss"+i).val(),"M"!==(n=$.isNumeric(a)?parseInt(a,10):"M")&&$.each(e[i],function(e,a){$.extend(t[a],{maxmissing:n})})}),!0}function getCompareYr(){return!(!$("#compareYr").prop("checked")||!$("#cmpyr").val().length)&&$("#cmpyr").val()}function getRestrictRange(){var e="01-01",t="12-31",a=function(e,t){var a,n=$(e).val(),o=n.split("-");if(2!==o.length||!$.isNumeric(o[0])||!$.isNumeric(o[1]))return $(document).reportError({errorText:"bad mmdd",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:e}),!1;try{return a=$.datepicker.parseDate("yy-m-d",t+"-"+n),$.datepicker.formatDate("mm-dd",a)}catch(t){return $(document).reportError({errorText:t,makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:e}),!1}};if($("#restrictRange").prop("checked")){if(!(e=a($("#rangeInputs input:first"),2012)))return!1;if(!(t=a($("#rangeInputs input:last"),2012)))return!1}return[e,t]}function getGrfType(){return $("input[name=grf_type]:checked").val()||"line"}function getPrecipTypeChoice(){return $("input[name=precip_type]:checked").val()||"sum"}function getBeginDate(){return input_params.elems[0].season_start=$("#begmmdd").val(),!0}function getGroupResults(){return $("#resGroup").val()}function getRecReduce(){return input_params.elems[0].smry.reduce=$("#hilo").val(),!0}function getRecLength(){return $("#reclen").val()>0?(input_params.elems[0].duration=parseInt($("#reclen").val(),10),input_params.elems[0].interval=$("#lengthUnits").val(),!0):($(document).reportError({errorText:"Error specifying length of period",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:"#reclen"}),!1)}function getNumberRecords(e){var t=parseInt($("#numrecs").val(),10)+(e||0);return!t||t<=e||t>100?($("#numrecs").val(null),$(document).reportError({errorText:"Number of records must be between "+e+" and "+(100-e),makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:"#numrecs"}),!1):(input_params.elems[0].smry.n=t,!0)}function getMapValueSize(){var e=parseInt($("#mapvalsize").val(),10);return!!e&&e+"pt"}function getContourLevels(){var e,t=$("#clevels").val().trim().length>0&&"auto-select"!==$("#clevels").val()?$("#clevels").val().split(","):"";if(t.length>0){for(e=t.length-1;e>=0;e-=1)$.isNumeric(t[e])?t.splice(e,1,parseFloat(t[e])):t.splice(e,1);if(!(t.length>0))return $(document).reportError({errorText:"Contour levels must be blank or numbers separated by commas",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:"#clevels"}),!1;input_params.image.levels=t}return!0}function getRunlen(){return $("#runlen").val()<=0?($(document).reportError({errorText:"Must specify run length",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),focusElement:"#runlen"}),!1):parseInt($("#runlen").val(),10)}function getCondaysContent(e){var t=$("[name=condays_content]:checked").val();if("numrecs"===t){if(!getNumberRecords(e))return!1}else{if("allruns"!==t)return!1;if(!getRunlen())return!1}return t}function getIncludeStart(){return $("#includeStart").prop("checked")}function getNormalType(){return $("input[name=normal_type]:checked").val()||"mly"}function getTempRounding(){return $("input[name=tempRoundType]:checked").val()||"full"}function getGridSelection(){return $("input[name=gridSet]:checked").val()||"1"}function getSeasonCalcs(){return $("#seasonCalcChoices").hasClass("ui-helper-hidden")?"neither":$("input[name=seasonCalcType]:checked").val()||"months"}function getOccur(){return"max"!==$(".acis-fsReduce select").val()&&"min"!==$(".acis-fsReduce select").val()?($("#occur").is(":visible")&&$("#occur").prop("checked",!1),!1):$("#occur").prop("checked")||!1}function getMcnt(){return $("#mcnter").prop("checked")||!1}function getDval(){return $("#dvaler").prop("checked")||!1}function getStationCoors(){return $("#stacrds").prop("checked")||!1}function getStationType(){return $("#statype").prop("checked")||!1}function getStationCnty(){return $("#stacnty").prop("checked")||!1}function getStationClimdiv(){return $("#staclimdiv").prop("checked")||!1}function getObsTimeTable(){return $("#obsTimeTable").prop("checked")||!1}function getFilterYrs(){return $("#yrfilter_box").prop("checked")?$("#yrfilter_list").yearPicker("getter"):[]}function getOtherLines(){var e=[];return $("#hiYr").prop("checked")&&e.push("hiYr"),$("#loYr").prop("checked")&&e.push("loYr"),$("#pickYr").prop("checked")&&e.push("pickYr"),e}function getMovavgLine(){return!!$("#movavgLineOption").prop("checked")&&$("#moveAvgYrs").val()}function getRegressLine(){return $("#regressLineOption").prop("checked")}function getLoessLine(){return $("#loessLineOption").prop("checked")}function getDegDayChoice(){var e=$("#ddtype").val();return{ddtype:e,baseTemp:parseInt($("#baseTemp").val(),10),upperLimit:"mgdd"===e?parseInt($("#hilimit").val(),10):null,lowerLimit:"mgdd"===e?parseInt($("#lolimit").val(),10):null}}function getAreaWithinState(){return $("#grid_area_select").areaWithinState("getter")}function getSpatialSummary(){var e=getAreaWithinState()||"county";return $.extend(input_params.elems[0],{area_reduce:e+"_"+$("#spatialSummary_area").spatialSummarySelection("getter")}),!0}function getPlotLine32(){return!($("#plotLine32").length>0)||$("#plotLine32").prop("checked")}function getDateSelection(){var e,t=$("input[name=date_select_type]:checked").attr("id");if("day_button"===t||"month_button"===t){if(input_params.date=$("#tdate_area").singleDateSelection("getter"),!input_params.date)return!1}else{if(!(e=$("#date_area").dateRangeSelection("getter")))return!1;$.extend(input_params.elems[0],{duration:Math.round(dateDiff(e.sDate,e.eDate))+1}),$.extend(input_params,{sDate:e.eDate,eDate:e.eDate})}return!0}function displayStinfo(e,t){var a,n,o,i=getOutputChoice()||"html",r=["Max Temperature","Min Temperature","Precipitation","Snowfall","Snow Depth"],s="Other",l={any:"Any",2:"Coop",1:"WBAN",5:"ICAO",6:"GHCN",7:"NWS LI",4:"WMO",3:"FAA",9:"ThreadEx",10:"CoCoRaHS",16:"AWDN",26:"NEWA",8:"RCC keyed"},c=function(e,t,a){input_params={id:e,meta:"name"},postResults("/General/"+t,function(e){e.meta.length>0&&e.meta[0].name&&$("#"+a).prepend(e.meta[0].name)})};if($("#stinfo_table").remove(),e.error||!e.meta||!e.meta.length)return $("#"+t).prepend("<p>"+(e.meta?"Station information unavailable":"Error obtaining station information")+"</p>"),!1;o=e.meta[0],$("#"+t).prepend('<table class="basictable" id="stinfo_table"></table>'),$("#stinfo_table").append("<tr><th>Station name: </th><td>"+o.name+"</td></tr> <tr><th>State: </th><td>"+o.state+"</td></tr>"),o.county&&($("#stinfo_table").append('<tr><th>County: </th><td id="cntyline">&nbsp;&nbsp;(FIPS '+o.county+")</td></tr>"),c(o.county,"county","cntyline")),o.climdiv&&($("#stinfo_table").append('<tr><th>Climate Division: </th><td id="cdline">&nbsp;&nbsp;('+o.climdiv+")</td></tr>"),c(o.climdiv,"climdiv","cdline")),$("#stinfo_table").append('<tr><th>Station ids: </th><td id="idl"></td></tr>'),$.each(o.sids,function(e,t){a=t.split(" "),l[a[1]]&&(s=l[a[1]]),n=a[0]+" ("+s+")",0!==e&&(n="<br />"+n),$("#idl").append(n)}),o.ll&&$("#stinfo_table").append('<tr title="Negative values are south latitude"><th>Latitude: </th><td>'+o.ll[1].toFixed(4)+' degrees</td></tr> <tr title="Negative values are west longitude"><th>Longitude: </th><td>'+o.ll[0].toFixed(4)+" degrees</td></tr>"),o.elev&&$("#stinfo_table").append("<tr><th>Elevation: </th><td>"+o.elev+" feet</td></tr>"),o.valid_daterange&&($("#stinfo_table").append('<tr><th>Available date ranges: </th><td><table style="border:0px; border-collapse:collapse;margin:auto;" id="var_table"></table></td></tr>'),$.each(o.valid_daterange,function(e,t){t.length>0&&$("#var_table").append("<tr><td>"+r[e]+" </td><td>"+t[0]+" - "+t[1]+" </td></tr>")})),"datatable"===i&&($("#stinfo_table").prepend('<thead style="display:none;"><tr><th></th><th></th></tr></thead>'),setupDataTable("#stinfo_table",{title:"Station Information"})),$("#stinfo_table").tooltip({tooltipClass:"acis-tooltip"})}function obtainStinfo(e,t,a,n){input_params={sids:e,meta:["name","state","sids","ll","elev","county","valid_daterange","climdiv"],elems:[1,2,4,10,11]},"tempinfo"===t&&0===$("#tempinfo").length&&$("#results_area").append('<div id="tempinfo" class="ui-helper-hidden"></div>'),$("#"+t).empty().loadSpinner(),postResults("/StnMeta",function(e){displayStinfo(e,t),"tempinfo"===t&&(a.close(),a.setContent($("#stinfo_table")[0]),a.open(map,n),$("#tempinfo").remove())})}function determineSearchCenter(){var e,t=map.getCenter();for(e=0;e<markersArray.length;e+=1)if(markersArray[e].icon.url.indexOf("center")>=0){t=markersArray[e].position;break}return t}function showSearchLocation(e,t){var a,n,o;a=new google.maps.LatLng(t[1],t[0]),n=new google.maps.LatLng(t[3],t[2]),o=new google.maps.LatLngBounds(a,n),map.fitBounds(o),addMarker(e,"centerIcon")}function determineSearchLocation(e){var t=e.lat,a=e.lng,n=defaults.offset/69.047,o=defaults.offset/(69.17*Math.cos(.01745*t)),i=[a-o,t-n,a+o,t+n];return map.setCenter(e),setTimeout(function(){showSearchLocation(e,i)},1e3),i}function buildFoundList(e){var t=input_params.bbox,a=new google.maps.LatLng((t[1]+t[3])/2,(t[0]+t[2])/2),n=[],o=new google.maps.InfoWindow;$.each(e,function(e,t){var i,r="bppIcon",s=new google.maps.LatLng(t.ll[1],t.ll[0]),l=google.maps.geometry.spherical.computeDistanceBetween(a,s);$.each(t.sids,function(e,t){var a=t.split(" ");"10"===a[1]?r="cocoIcon":"17"===a[1]||"19"===a[1]?r="snotelIcon":"6"===a[1]&&"USS"===a[0].substr(0,3)?r="snotelIcon":"6"===a[1]&&"USR"===a[0].substr(0,3)&&(r="rawsIcon")}),i=addMarker(s,r),n.push({distance:l,stnId:t.sids[0],stnName:t.name,color:"bppIcon"!==r?"green":"blue"}),google.maps.event.addListener(i,"click",function(){$("#map_msg").text("Selected station: "+t.name),$("#srchResults select").val(t.sids[0]).trigger("change")}),google.maps.event.addListener(i,"dblclick",function(){$("#map_msg").text("Selected station: "+t.name),$("#srchResults select").val(t.sids[0]).trigger("change"),obtainStinfo(t.sids[0],"tempinfo",o,i)}),google.maps.event.addListener(i,"mouseover",function(){$("#map_msg").html(t.name+" <i>(double-click for station info)</i>")}),google.maps.event.addListener(i,"mouseout",function(){$("#map_msg").empty()})}),google.maps.event.addListener(o,"closeclick",function(){map.setCenter(a)}),n.sort(sortByDistance),$.each(n,function(e,t){$('<option style="color:'+t.color+'" value="'+t.stnId+'">'+t.stnName+"</option>").appendTo("#srchResults select")}),$("#srchResults select").trigger("change"),$("#srchResults").show(),$("#srchMore").show()}function displayStations(e){var t,a=$("#product_select").data("productId"),n=new google.maps.InfoWindow;a.indexOf("StnProduct")>=0?e.meta&&e.meta.length>0?buildFoundList(e.meta):e.meta&&e.meta.length<=0&&defaults.offset<120?$("#srchMore").trigger("click"):($("#map_msg").empty().html("<span>No stations found within "+defaults.offset+" miles</span>"),$("#stnSrchString").focus().select()):e.meta&&($("#map_msg").empty().html("<span>Found "+e.meta.length+" stations</span>"),$.each(e.meta,function(e,a){var o,i,r,s;a.ll&&(o=new google.maps.LatLng(a.ll[1],a.ll[0]),r="stationIcon",$.each(a.sids,function(e,t){"10"===(s=t.split(" "))[1]?r="cocoIcon":"17"===s[1]||"19"===s[1]?r="snotelIcon":"6"===s[1]&&"USS"===s[0].substr(0,3)?r="snotelIcon":"6"===s[1]&&"USR"===s[0].substr(0,3)&&(r="rawsIcon")}),i=addMarker(o,r),google.maps.event.addListener(i,"mouseover",function(){$("#map_msg").html(a.name+" <i>(click for station info)</i>")}),google.maps.event.addListener(i,"mouseout",function(){$("#map_msg").empty()}),google.maps.event.addListener(i,"click",function(){t=determineSearchCenter(),obtainStinfo(a.sids[0],"tempinfo",n,i)}))}),google.maps.event.addListener(n,"closeclick",function(){map.setCenter(t)}))}function obtainStations(e){var t=$("#product_select").data("productId"),a=$("#product_select").data("getinput");if(input_params={elems:[]},!a())return $("#map_msg").loadSpinner("fadeOut"),!1;if(input_params.meta=["name","state","ll","sids"],e)input_params.bbox=e,$("#srchResults").hide(),$("#srchMore").hide();else if(!getStationsMultiInput())return $("#map_msg").loadSpinner("fadeOut"),!1;input_params.sDate&&input_params.sDate.search("por")>=0&&(input_params.sDate="1850-1-1"),input_params.eDate&&input_params.eDate.search("por")>=0&&(input_params.eDate=(new Date).toString("yyyy-MM-dd")),postResults("/StnMeta",displayStations),t.indexOf("StnProduct")>=0&&(clearOverlays(),addBbox(new google.maps.LatLng(e[1],e[0]),new google.maps.LatLng(e[3],e[2])))}function stnSrchMore(e){var t;setupMaps(),defaults.offset=defaults.offset+30,t=determineSearchLocation(e),$("#map_msg").empty().show().loadSpinner({message:"Extending search to "+defaults.offset+" miles ..."}),$("#srchResults select").empty(),obtainStations(t)}function postGeocodeError(){$(".loading").parent().loadSpinner("fadeOut"),$(document).reportError({errorText:"Error searching for location"})}function postGeocodeSuccess(e){var t,a,n;"0"!==e.info.statuscode?(t=determineSearchLocation(e.results[0].locations[0].latLng),a=e.results[0].locations[0].adminArea5+", "+e.results[0].locations[0].adminArea3,$("#map_msg").empty().show().loadSpinner({message:"Searching for stations near: "+a}),0===$("#srchMore").length&&$("#map_area").append('<button id="srchMore" class="smallButton mapButton">Expand Search Area</button>'),$("#srchMore").button().hide().off("click").on("click",function(){stnSrchMore(e.results[0].locations[0].latLng)}),obtainStations(t)):(n=e.results[0].locations[0].providedLocation+" not found",$("#srchResults").hide(),hideMap(),$(document).reportError({errorText:n,makeActive:$("#inputs .ui-accordion-header").index($("#station_acc")),focusElement:"#stnSrchString"}))}function postGeocode(e){var t,a="https://www.mapquestapi.com/geocoding/v1/address?location="+e+"&inFormat=kvp&outFormat=json&thumbMaps=false&key=vmdb56NGYcTBa45baRjZtjxrTY8GWHKi";window.XDomainRequest?((t=new XDomainRequest).open("GET",a),t.onload=function(){postGeocodeSuccess(JSON.parse(t.responseText))},t.onerror=postGeocodeError,t.onprogress=function(){},t.ontimeout=function(){},setTimeout(function(){t.send()},0)):$.ajax(a,{type:"POST",crossDamain:!0,success:function(e){postGeocodeSuccess(e)},error:postGeocodeError})}function stnSrch(){var e=$("#stnSrchString").val();if(defaults.offset=25,$("#srchResults select").empty(),!1===setupMaps(stnSrch))return!1;showMap();try{postGeocode(e)}catch(e){$(document).reportError({errorText:e,makeActive:$("#inputs .ui-accordion-header").index($("#station_acc")),focusElement:"#stnSrchString"})}}function boxdrawn(){0===$("#showStations").length?$("<button>Show stations in box</button>").attr("id","showStations").addClass("smallButton mapButton").appendTo("#map_area").button().fadeIn(600).on("click",function(){$(this).hide(),$("#map_msg").empty().show().loadSpinner({message:"Searching for stations ..."}),obtainStations()}):$("#showStations").fadeIn(600)}function createStationsMulti(e){var t=[],a={state:"State/Area",bbox:"Bounding Box"},n=stationsMultiButtons||["state","bbox"];defaults.multiStn_select_type||(defaults.multiStn_select_type=($.inArray("state",n)>=0?"state":n[0])+"_button"),defaults.state||(defaults.state="CT"),defaults.cwa||(defaults.cwa="ALY"),$.each(n,function(e,n){t.push([n+"_button",a[n]])}),$('<div id="multi_stn_select"></div>').appendTo(e).buttonBar({barName:"multiStn_select_type",barOrient:"horizontal",buttonInfo:t,buttonDefault:defaults.multiStn_select_type}).areaSelection({autoShow:"state_button"===defaults.multiStn_select_type,mapInteraction:!0,defState:defaults.state,buttonInfo:areaButtons||[["all","State"],["cwa","CWA"],["climdiv","Division"],["basin","Basin"],["county","County"]],statesFile:"data/states_dict.txt"}).bboxSelection({autoShow:"bbox_button"===defaults.multiStn_select_type,mapInteraction:!0,boxdrawn:boxdrawn,makeActive:$("#inputs .ui-accordion-header").index($("#station_acc")),maxArea:300}),$("#multiStn_select_type").on("change",function(){defaults.multiStn_select_type=$("input[name=multiStn_select_type]:checked").attr("id")}),$("#state_button").on("click",function(){$("#multi_stn_select").bboxSelection("hider").areaSelection("shower")}),$("#bbox_button").on("click",function(){$("#multi_stn_select").bboxSelection("shower").areaSelection("hider")})}function createStationsSingle(e){var t=[],a={id:"ID",list:"List",srch:"Search"},n=stationsSingleButtons||["id","list","srch"];defaults.stn_select_type||(defaults.stn_select_type=($.inArray("list",n)>=0?"list":n[0])+"_button"),defaults.cwa||(defaults.cwa="ALY"),$.each(n,function(e,n){t.push([n+"_button",a[n]])}),$('<div id="single_stn_select"></div>').appendTo(e).buttonBar({barName:"stn_select_type",barOrient:"horizontal",buttonInfo:t,buttonDefault:defaults.stn_select_type}).stationSrch({autoShow:"srch_button"===defaults.stn_select_type,srchFunction:stnSrch}).stationList({autoShow:"list_button"===defaults.stn_select_type,defCwa:defaults.cwa,stationFile:"data/station_dict.txt",cwaFile:$.inArray("list",n)>=0?"data/cwa_dict.txt":""}).stationId({autoShow:"id_button"===defaults.stn_select_type,defSid:defaults.sId}),$("#stn_select_type").on("change",function(){defaults.stn_select_type=$("input[name=stn_select_type]:checked").attr("id")}),$("#id_button").on("click",function(){hideMap(),$("#single_stn_select").stationId("shower").stationList("hider").stationSrch("hider")}),$("#list_button").on("click",function(){hideMap(),$("#single_stn_select").stationList("shower").stationId("hider").stationSrch("hider")}),$("#srch_button").on("click",function(){$("#single_stn_select").stationSrch("shower").stationId("hider").stationList("hider"),$("#single_stn_select").stationSrch("getter")&&showMap()})}function createStationsGrid(e){defaults.gridArea_select_type||(defaults.gridArea_select_type="gstate_button"),defaults.state||(defaults.state="MO"),$('<div id="grid_stn_select"></div>').appendTo(e).buttonBar({barName:"gridArea_select_type",barOrient:"horizontal",buttonInfo:[["gstate_button","State"],["gbbox_button","Bounding Box"]],buttonDefault:defaults.gridArea_select_type}).stateSelection({autoShow:"gstate_button"===defaults.gridArea_select_type,mapInteraction:!0,defState:defaults.state,statesFile:"data/states_grid.txt"}).bboxSelection({autoShow:"gbbox_button"===defaults.gridArea_select_type,mapInteraction:!0,makeActive:$("#inputs .ui-accordion-header").index($("#station_acc")),maxArea:9999}),$("#gridArea_select_type").on("change",function(){defaults.gridArea_select_type=$("input[name=gridArea_select_type]:checked").attr("id")}),$("#gstate_button").on("click",function(){$("#grid_stn_select").bboxSelection("hider").stateSelection("shower")}),$("#gbbox_button").on("click",function(){$("#grid_stn_select").bboxSelection("shower").stateSelection("hider")})}function setupStations(e,t){var a="single"===t?"multi":"single";"Station selection will be done here."===$(e).text()&&$(e).empty(),hideMap(),"grid"!==t?($("#"+a+"_stn_select").hide(),$("#grid_stn_select").hide()):($("#multi_stn_select").hide(),$("#single_stn_select").hide()),"multi"===t&&0===$("#multi_stn_select").length?createStationsMulti(e):"single"===t&&0===$("#single_stn_select").length?createStationsSingle(e):"grid"===t&&0===$("#grid_stn_select").length&&createStationsGrid(e),$("#"+t+"_stn_select").show()}function setupCheckbox(e,t,a,n){var o=$("<fieldset></fieldset>",{dir:"rtl"}),i=$("<input />",{type:"checkbox",id:t}),r=$("<label></label>",{for:t,text:a}),s=o.clone().appendTo(e);r.clone().appendTo(s),i.clone().appendTo(s),n&&s.attr("title",n)}function setupTextbox(e,t,a,n,o){var i=$("<fieldset></fieldset>",{dir:"ltr"}),r=$("<input />",{type:"text",id:t,value:o,class:"ui-widget-content ui-corner-all ui-state-default"}),s=$("<label></label>",{for:t,text:a}),l=i.clone().appendTo(e);s.clone().appendTo(l),r.clone().appendTo(l),n&&l.attr("title",n)}function setupRadio(e,t,a,n,o){var i,r=$("<fieldset></fieldset>",{dir:"ltr",style:"text-align: left"}),s=$("<input />",{type:"radio",name:t}),l=$("<label></label>"),c=$("<span></span>",{style:"font-weight:600"}),d=$("<br />");a&&(c.clone().text(a).appendTo(e),"vertical"===o&&d.clone().appendTo(e)),i=r.clone().appendTo(e),$.each(n,function(e,a){a.id||(a.id=t+"_"+a.value),s.clone().attr("id",a.id).val(a.value).prop("checked",a.checked).appendTo(i),l.clone().attr("for",a.id).html(a.label).appendTo(i),"vertical"===o&&e!==n.length-1&&d.clone().appendTo(i)})}function setupMenu(e,t,a,n,o){var i=$("<fieldset></fieldset>"),r=$("<select></select>",{id:t,class:"ui-widget-content ui-corner-all ui-state-default"}),s=$("<label></label>",{for:t,text:a}),l=$("<option></option>"),c=i.clone().appendTo(e);s.clone().appendTo(c),r.clone().appendTo(c),$.each(o,function(e,a){l.clone().val(a.value).text(a.label).prop("selected",a.selected).appendTo("#"+t)}),n&&c.attr("title",n)}function setupOutputChoice(e,t,a,n){var o,i=[],r={csv:["Table","HTML"],"csv-list":["Table"],html:["CSV"],table:["CSV-List","CSV"]};switch(t||(t=["HTML","Text"]),a||(a="radio"),n||(n=[t[0]]),$(e).append('<div id="out_format_area"></div>'),a){case"radio":$.each(t,function(e,t){o=t.toLowerCase().split(" ").join("_"),i.push({label:t,value:o,checked:t===n[0]})}),setupRadio("#out_format_area","outopt","Output:",i,"horizontal");break;case"checkbox":$("#out_format_area").append('<span style="font-weight:600;">Output:</span>'),$.each(t,function(e,a){setupCheckbox("#out_format_area","outformat_"+(o=a.toLowerCase().split(" ").join("_")),a,""),$("#outformat_"+o).attr("name","outopt").val(o).prop("checked",$.inArray(a,n)>=0),r.hasOwnProperty(o)&&$("#outformat_"+o).on("change",function(){$(this).prop("checked")&&$.each(r[$(this).val()],function(e,a){$.inArray(a,t)>=0&&$("#outformat_"+a.toLowerCase()).prop("checked",!1)})}),o.search("map")>=0&&$("#outformat_"+o).on("change",function(){$("#mapvalsize")&&$("#mapvalsize").parent().parent().toggle()})});break;case"menu":$.each(t,function(e,t){o=t.toLowerCase().split(" ").join("_"),i.push({label:t,value:o,selected:t===n[0]})}),setupMenu("#out_format_area","outopt","Output:","",i),$("#outopt").attr("name","outopt").parent().find("label").css("font-weight","600")}}function setupMapCheckboxListener(){var e,t;$("div.buttonHolder").length>0?$("#outformat_map").on("change",function(){if($("div.buttonHolder").toggle(),$(this).prop("checked"))for(e=$("#element_area div").length;e>1;e-=1)$("#element_area div:nth-child("+e+")").hasClass("element_list")&&$("#element_area div:nth-child("+e+")").remove()}):$("table.acis-multiInputTable").length>0&&$("#outformat_map").on("change",function(){if($(this).prop("checked"))for(t=$("#element_area").multiElementPicker("getter"),e=t.length-1;e>=1;e-=1)$("input[name="+t[e]+"]").prop("checked",!1)})}function setupMoreOptions(e,t){t||(t="More options"),$(e).append('<div class="more_option_header"></div><div id="more_option_select" class="ui-helper-hidden"></div>'),$(".more_option_header").html('<span class="ui-icon ui-icon-triangle-1-e"></span><span class="motext">'+t+"</span>").on("click",function(){$("#more_option_select").slideToggle("slow"),$(".motext").text()===t?$(".more_option_header").html('<span class="ui-icon ui-icon-triangle-1-s"></span><span class="motext">Hide additional options</span>'):$(".more_option_header").html('<span class="ui-icon ui-icon-triangle-1-e"></span><span class="motext">'+t+"</span>")})}function setupDateRangeYY(e,t){t||(t={defaultStart:"por"}),$('<div id="year_area"></div>').appendTo(e).yearRangeSelection(t)}function setupYearRangeStn(e){$('<div id="stn_year_area"></div>').appendTo(e).yearRangeSelection({defaultStart:Date.today().getFullYear(),inputLabel:"Stations active:"}),$("#stn_year_area fieldset").prop("title","Restrict results to only stations active anytime during this range of years"),$("#year_area fieldset").prop("title","Range of years analyzed for each station")}function setupDateRangeMM(e,t){t||(t={}),$('<div id="month_area"></div>').appendTo(e).monthRangeSelection(t)}function setupDateRange(e,t){t||(t={}),$('<div id="date_area"></div>').appendTo(e).dateRangeSelection(t)}function setupSingleDate(e,t){t||(t={}),t.tooltipshow||(t.tooltipShow=$("#tiptoggler").data("tipsOn")),$('<div id="tdate_area"></div>').appendTo(e).singleDateSelection(t)}function setupElements(e,t){t?$('<div id="element_area"></div>').appendTo(e).elementSelection(t):$('<div id="element_area"></div>').appendTo(e)}function setupMultiElementPicker(e){$('<div id="element_area"></div>').appendTo(e).multiElementPicker()}function setupSeasonSelect(e,t){t||(t={}),t.tooltipshow||(t.tooltipShow=$("#tiptoggler").data("tipsOn")),$('<div id="season_area"></div>').appendTo(e).seasonSelection(t)}function checkOneYear(){var e,t=Date.parse($("#sDatepicker").val()),a=Date.parse($("#eDatepicker").val());if(!t||!a)return!1;e=t.addYears(1).addDays(-1),a.isAfter(e)?($(".oneYr").prop("disabled",!0).parent("fieldset").css("color","lightgray"),$("#otherLines").attr("title","Highest, lowest and other years are only available with date range of 1 year or less."),$("#tDatepicker").datepicker("setDate",$("#sDatepicker").val().substr(5)),$("#tdate_area").show()):($(".oneYr").prop("disabled",!1).parent("fieldset").css("color","black"),$("#otherLines").attr("title",""),$("#tdate_area").hide())}function setupResetAccum(e,t){$('<div id="tdate_area"></div>').appendTo(e).singleDateSelection({sdFormat:"md",sdLabel:null,tooltipShow:$("#tiptoggler").data("tipsOn")}).addClass("ui-helper-hidden"),setupCheckbox("#tdate_area label","accumReset","Reset accumulation on","Click to enable resetting acccumulation on this date each year"),$("#tdate_area fieldset:last").tooltip({position:{my:"left top",at:"left bottom"},tooltipClass:"acis-tooltip smallerBox"}),$("#tDatepicker").datepicker("disable"),$("#accumReset").on("click",function(){$("#tDatepicker").datepicker("isDisabled")?($("#tdate_area fieldset:last").tooltip("disable"),$("#tDatepicker").datepicker("enable").select().focus()):($("#tdate_area fieldset:last").tooltip("enable"),$("#tDatepicker").datepicker("disable"))}),$("#accumReset").prop("checked",t||!1)}function setupDatesAccum(e){$('<div id="date_area"></div>').appendTo(e).dateRangeSelection({makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),changeFunction:checkOneYear}),$("#sDatepicker").val($("#sDatepicker").val().substr(0,5)+"01-01"),$("#sDatepicker").bind("keyup",function(){checkOneYear()}),$("#eDatepicker").bind("keyup",function(){checkOneYear()})}function setupMaxmissing(e,t,a){var n;setupCheckbox(e,"maxmissOption","Set maximum missing values","Maximum number of missing days allowed before setting summary value to missing"),setupTextbox(e,"maxMiss","Allowable missing days:","",a),$("#maxMiss").parent().addClass("ui-helper-hidden maxmiss"),$("#maxmissOption").prop("checked",!1).on("change",function(){$(".maxmiss").toggle(),a>=0?$("#maxMiss").val(a).focus().select():(n=$(".acis-fsElem select").val(),$("#maxMiss").val("pcpn"===n||"snow"===n?1:5).focus().select())}),t&&$("#maxmissOption").trigger("click")}function setupRunmissing(e,t,a){setupCheckbox(e,"runmissOption","Set max missing values in run","Maximum number of missing days allowed before ending run"),setupTextbox(e,"runMiss","Allowable missing days:","",a),$("#runMiss").parent().addClass("ui-helper-hidden runmiss"),$("#runmissOption").prop("checked",!1).on("change",function(){$(".runmiss").toggle(),$("#runMiss").val(a>=0?a:1).focus().select()}),t&&$("runmissOption").trigger("click")}function setupMaxmissingOn(e){var t;setupMaxmissing(e,!0),$("#maxmissOption").parent().hide(),$("#maxMiss").parent().removeClass("maxmiss").prop("title",$("#maxmissOption").parent().prop("title")),$("#element_area fieldset.acis-fsElem select").on("change",function(){t=$(this).val(),$("#maxMiss").val($.inArray(t,["maxt","mint","avgt"])>=0?5:1)})}function setupMaxmissingAlmanac(e,t,a){setupCheckbox(e,"maxmissOption","Maximum allowable missing days","Maximum number of missing days allowed before setting summary value to missing"),setupTextbox(e,"maxMissMT","Monthly temperature:","",5),setupTextbox(e,"maxMissMP","Monthly precip/snow:","",1),setupTextbox(e,"maxMissMD","Monthly degree days:","",1),setupTextbox(e,"maxMissAT","Annual temperature:","",5*parseInt(a,10)),setupTextbox(e,"maxMissAP","Annual precip/snow:","",parseInt(a,10)),setupTextbox(e,"maxMissAD","Seasonal degree days:","",parseInt(a,10)),$("#maxMissMT").parent().addClass("ui-helper-hidden maxmiss"),$("#maxMissMP").parent().addClass("ui-helper-hidden maxmiss"),$("#maxMissMD").parent().addClass("ui-helper-hidden maxmiss"),$("#maxMissAT").parent().addClass("ui-helper-hidden maxmiss"),$("#maxMissAP").parent().addClass("ui-helper-hidden maxmiss"),$("#maxMissAD").parent().addClass("ui-helper-hidden maxmiss"),$("#maxmissOption").prop("checked",!1).on("change",function(){$(".maxmiss").toggle().focus().select()}),t&&$("#maxmissOption").trigger("click")}function setupCompareYr(e){var t=Date.today().toString("yyyy");$(e).append("<fieldset class='acis-fsCompare'></fieldset>"),$(".acis-fsCompare").attr("title","Add column for this year to results"),setupCheckbox(".acis-fsCompare","compareYr","Compare to",""),setupTextbox(".acis-fsCompare","cmpyr",":","","Year"),$("#cmpyr").addClass("acis-tyear grayout").attr("maxlength",4).prop("disabled",!0),$("#compareYr").prop("checked",!1).on("change",function(){$(this).prop("checked")?($("#cmpyr").prop("disabled",!1).removeClass("grayout").focus().select(),"Year"===$("#cmpyr").val()&&$("#cmpyr").val(t)):$("#cmpyr").prop("disabled",!0).val("Year").addClass("grayout")})}function setupRestrictRange(e){var t=$("<input />",{type:"text",class:"ui-widget-content ui-corner-all ui-state-default acis-tother",title:"Enter 2-digit month and day in the form mm-dd"});setupCheckbox(e,"restrictRange","Restrict date range","Restrict results to range of dates"),$(e).append('<fieldset id="rangeInputs" class="ui-helper-hidden" style="margin-left:2em; margin-top:3px;">to</fieldset>'),t.clone().val("01-01").prependTo($("#rangeInputs")),t.clone().val("12-31").appendTo($("#rangeInputs")),$("#restrictRange").prop("checked",!1).on("change",function(){$("#rangeInputs").toggle(),$("#rangeInputs").is(":visible")&&$("#rangeInputs input:first").focus().select()}),$("#tiptoggler").data("tipsOn")&&$("#rangeInputs input").tooltip({tooltipClass:"acis-tooltip",position:{my:"left center",at:"right+5 center",of:"#rangeInputs input:last"}})}function setupGrfType(e){$(e).append('<div id="grf_options"></div>'),setupRadio("#grf_options","grf_type","Graph type:",[{label:"Line",value:"line",checked:!0},{label:"Bar",value:"column",checked:!1}],"horizontal"),$("#grf_type_line").prop("checked",!0)}function setupPrecipTypeChoice(e){$(e).append('<div id="precip_type_area"></div>'),setupRadio("#precip_type_area","precip_type","Summary content:",[{label:"Total precipitation",value:"sum",checked:!0},{label:"Departure from normal",value:"dpt",checked:!1}],"vertical")}function setupBeginDate(e){setupMenu(e,"begmmdd","Period beginning:","First occurrence after and last occurrence before this date",[{value:"08-01",label:"Aug 1",selected:!0},{value:"01-01",label:"Jan 1"},{value:"07-01",label:"Jul 1"}])}function setupGroupResults(e){setupMenu(e,"resGroup","Pair results by:","",[{value:"calyr",label:"Calendar year",selected:!0},{value:"season",label:"Season"}])}function setupRecReduce(e){setupMenu(e,"hilo","High/Low:","",[{value:"max",label:"Highest",selected:!0},{value:"min",label:"Lowest"}])}function setupRecLength(e,t){setupMenu(e,"lengthUnits","Length of period:","Length of summarization period",[{value:"dly",label:"Days",selected:!0},{value:"mly",label:"Months"},{value:"yly",label:"Years"}]),$("#lengthUnits").before('<input type="text" id="reclen" class="ui-widget-content ui-corner-all ui-state-default" />').on("change",function(){"yly"===$("#lengthUnits").val()?($("#restrictRange").prop("checked",!1).prop("disabled",!0).parent("fieldset").css("color","lightgray"),$("#rangeInputs").hide()):$("#restrictRange").prop("disabled",!1).parent("fieldset").css("color","black")}),$("#reclen").val(t||3).on("click",function(){$(this).focus().select()})}function setupNumberRecords(e){setupTextbox(e,"numrecs","Number of records:","Number of values to display in results",10),$("#numrecs").on("click",function(){$(this).focus().select()})}function setupMapValueSize(e,t){setupTextbox(e,"mapvalsize","Map value font size:","Font size of values plotted on map",8),$("#mapvalsize").removeClass("ui-widget-content ui-state-default").spinner({max:36,min:4}).val(8).on("click",function(){$(this).focus().select()}).parent().parent().css("margin-top","6px"),"show"!==t&&$("#mapvalsize").parent().parent().hide()}function setupContourLevels(e){setupTextbox(e,"clevels","Contour levels","Contour levels for map; leave blank for auto-select"),$("<span>(comma-separated):</span>").insertAfter($("#clevels").parent().find("label")),$("#clevels").val("auto-select").addClass("grayedinput").on("click",function(){"auto-select"===$(this).val()&&$(this).val("").removeClass("grayedinput").off("click")}),$("#clevels").on("keyup",function(){0===$("#clevels").val().length?$("#clevels").val("auto-select").addClass("grayedinput").focus().select():$("#clevels").removeClass("grayedinput")})}function setupCondaysContent(e){$(e).append('<div id="condays_content_area" title="Select desired type of report"></div>'),setupRadio("#condays_content_area","condays_content","Report content:",[{label:'Top <input type="text" id="numrecs" class="ui-widget-content ui-corner-all ui-state-default" /> longest runs',value:"numrecs",checked:!0},{label:'All runs >= <input type="text" id="runlen" class="ui-widget-content ui-corner-all ui-state-default" /> days',value:"allruns",checked:!1}],"vertical"),$("#numrecs").val(10).on("click",function(){$("[name=condays_content]:first").prop("checked",!0)}),$("#runlen").on("click",function(){$("[name=condays_content]:last").prop("checked",!0)}),$("#condays_content_allruns").on("click",function(){$("#runlen").focus().select()}),$("#condays_content_numrecs").on("click",function(){$("#numrecs").focus().select()})}function setupIncludeStart(e){setupCheckbox(e,"includeStart","Include start date in results","Include both beginning and ending of period in results")}function setupNormalType(e){$(e).append('<div id="normal_type_area"></div>'),setupRadio("#normal_type_area","normal_type","Type:",[{label:"Monthly",value:"mly",checked:!0},{label:"Daily",value:"dly",checked:!1}],"horizontal")}function setupTempRounding(e,t){$(e).append('<div id="tempRoundChoices"><span class="ui-helper-clearfix">Avg Temperature Handling: </span><span class="ui-icon ui-icon-info"></span></div>'),setupRadio("#tempRoundChoices","tempRoundType","",[{label:"Full precision",value:"full",checked:!0},{label:"Intermediate rounding",value:"intermediate"}],"vertical"),$("#tempRoundType_full").parent().find("label:first").after('<p class="choiceExplain ui-helper-hidden">Full precision indicates the '+("dly"===t?"daily avearge  tempertures will retain any half degrees and the daily depatures will be calculated to the nearest tenth of a degree. The ":"")+"monthly average temperature will be the mean of the monthly average maximum and minimum temperatures with full precision retained. This will be the same as the mean of the daily average temperatures (provided there are no missing values). This procedure is recommended by the National Data Stewardship Team and used in NCDC LCDs beginning January 2013.</p>"),$("#tempRoundType_full").parent().find("label:last").after('<p class="choiceExplain ui-helper-hidden">Intermediate rounding indicates the '+("dly"===t?"daily average temperature will be rounded up to the nearest degree and the daily temperature departure will be the difference between the rounded daily average temperature and the rounded daily temperature normal. The ":"")+"monthly average temperature will be the mean of the average maximum and average minimum temperatures, each rounded to the nearest tenth of a degree prior to the averaging. This procedure replicates most pre-2013 NCDC LCDs.</p>"),$("#tempRoundChoices").attr("title","Hover over or click info icon for explanation").find("span.ui-icon-info").on({"mouseenter click":function(){$("#tempRoundChoices p.choiceExplain").show()},mouseleave:function(){$("#tempRoundChoices p.choiceExplain").fadeOut(200,"linear")}}),$("#tempRoundChoices p.choiceExplain").click(function(){this.fadeOut(200,"linear")})}function setupTempRoundingMly(e){var t=function(){"avgt"===$(".acis-fsElem select").val()&&"mean"===$(".acis-fsReduce select").val()?$("#tempRoundChoices").removeClass("ui-helper-hidden"):$("#tempRoundChoices").addClass("ui-helper-hidden")};setupTempRounding(e,"mly"),$("#tempRoundChoices").addClass("ui-helper-hidden"),$(".acis-fsElem select").on("change",t),$(".acis-fsReduce select").on("change",t)}function setupGridSelection(e){$(e).append('<div id="gridChoices"><span class="ui-helper-clearfix">Grid dataset selection '+"(<a href='http://www.rcc-acis.org/docs_gridded.html' target='_blank' title='detailed grid documentation'>?</a>)  </span><span class=\"ui-icon ui-icon-info\"></span></div>"),setupRadio("#gridChoices","gridSet","",[{label:"NRCC station interpolated",value:"1"},{label:"NRCC hi-resolution",value:"3",checked:!0},{label:"PRISM",value:"21"}],"vertical"),$("#gridSet_1").parent().find("label:nth-of-type(1)").after('<p class="choiceExplain ui-helper-hidden">Station interpolated 5 km grid using Natural Neighbor method. Lower 48 states. 1950-present. </p>'),$("#gridSet_3").parent().find("label:nth-of-type(2)").after('<p class="choiceExplain ui-helper-hidden">High resolution radar or RUC/RAP model guided 5 km grid. East of Rockies only. Temp: 1998-present, Pcpn: 2002-present. </p>'),$("#gridSet_21").parent().find("label:nth-of-type(3)").after('<p class="choiceExplain ui-helper-hidden">PRISM (Parameter-elevation Relationships on Independent Slopes Model). Lower 48 states. 1981-present (daily data), 1895-present (monthly data). Data lag by about 3 days.</p>'),$("#gridChoices").attr("title","Hover over or click info icon for explanation").find("span.ui-icon-info").on({"mouseenter click":function(){$("#gridChoices p.choiceExplain").show()},mouseleave:function(){$("#gridChoices p.choiceExplain").fadeOut(200,"linear")}}),$("#gridChoices p.choiceExplain").click(function(){this.fadeOut(200,"linear")})}function setupSeasonCalcs(e){$(e).append('<div id="seasonCalcChoices"><span class="ui-helper-clearfix">Season Calculation Method: </span><span class="ui-icon ui-icon-info"></span></div>'),setupRadio("#seasonCalcChoices","seasonCalcType","",[{label:"Average of months",value:"months",checked:!0},{label:"Average of days",value:"days"}],"vertical"),$("#seasonCalcType_months").parent().find("label:first").after('<p class="choiceExplain ui-helper-hidden">Seasonal/Annual value is the average of the monthly values (recommended by the National Data Stewardship Team)</p>'),$("#seasonCalcType_months").parent().find("label:last").after('<p class="choiceExplain ui-helper-hidden">Seasonal/Annual value is the average of all the daily values for the period</p>'),$("#seasonCalcChoices").attr("title","Hover over or click info icon for explanation").find("span.ui-icon-info").on({"mouseenter click":function(){$("#seasonCalcChoices p.choiceExplain").show()},mouseleave:function(){$("#seasonCalcChoices p.choiceExplain").fadeOut(200,"linear")}}),$("#seasonCalcChoices p.choiceExplain").click(function(){this.fadeOut(200,"linear")})}function setupOccur(e,t,a){setupCheckbox(e,"occur","Include "+(t||"date")+" of occurrence","For extremes, include date in output"),$("#occur").prop("checked",a||!1)}function setupMcnt(e,t){setupCheckbox(e,"mcnter","Include missing days count",""),$("#mcnter").prop("checked",t||!1)}function setupDval(e,t){setupCheckbox(e,"dvaler","Include value","Include value on date of occurrence in results"),$("#dvaler").prop("checked",t||!1)}function setupStationCoors(e,t){setupCheckbox(e,"stacrds","Include station coordinates","Include latitude, longitude, elevation in output"),$("#stacrds").prop("checked",t||!1)}function setupStationType(e,t){setupCheckbox(e,"statype","Include station type","Include station type based on station ids in output"),$("#statype").prop("checked",t||!1)}function setupStationCnty(e,t){setupCheckbox(e,"stacnty","Include county","Include county name in output"),$("#stacnty").prop("checked",t||!1)}function setupStationClimdiv(e,t){setupCheckbox(e,"staclimdiv","Include climate division","Include climate division name in output"),$("#staclimdiv").prop("checked",t||!1)}function setupObsTimeTable(e,t){setupCheckbox(e,"obsTimeTable","Include obs time table","Include a table with the times of observation for each variable"),$("#obsTimeTable").prop("checked",t||!1)}function setupFilterYrs(e){setupCheckbox(e,"yrfilter_box","Select years","Select only specific years for analysis"),$(e).append('<div id="yrfilter_list" class="ui-helper-hidden"></div>'),$("#yrfilter_list").empty().html('<span>Selected:</span> <span id="selectedYrs"></span> <span>(<a href="#" id="yrfilter_change">change</a>)</span>'),$("#yrfilter_box").one("click",function(){$("#yrfilter_list").yearPicker({sYear:$("#year_area").find("input:first").val(),eYear:$("#year_area").find("input:last").val(),listArea:"#selectedYrs",position:{my:"left top",at:"right top",of:"#option_select"},open:function(){$(".ui-dialog button:last").focus(),$("#year_area").find("input:first").on("change",function(){$("#yrfilter_list").yearPicker({sYear:$(this).val()}),$("#yrfilter_list").yearPicker("update")}),$("#year_area").find("input:last").on("change",function(){$("#yrfilter_list").yearPicker({eYear:$(this).val()}),$("#yrfilter_list").yearPicker("update")})},close:function(){$("#year_area").length&&$("#year_area").find("input").off("change")}})}).click(function(){$("#yrfilter_list").toggle()}),$("#yrfilter_change").prop("title","Change selected years").on("click",function(){$("#yrfilter_list").yearPicker({sYear:$("#year_area").find("input:first").val(),eYear:$("#year_area").find("input:last").val()}),$("#yrfilter_list").yearPicker("update")})}function setupOtherLines(e){$(e).append('<div id="otherLines" style="margin-top:8px;"></div>'),$("#otherLines").append("<label>Additional lines:</label>"),$.each([{label:"Normal",id:"normLine",addClass:null,checked:!0},{label:"Highest year",id:"hiYr",addClass:"oneYr",checked:!1},{label:"Lowest year",id:"loYr",addClass:"oneYr",checked:!1},{label:"Other years",id:"pickYr",addClass:"oneYr",checked:!0}],function(e,t){$("#otherLines").append("<br />"),setupCheckbox("#otherLines",t.id,t.label,""),$("#"+t.id).prop("checked",t.checked),t.addClass&&$("#"+t.id).addClass(t.addClass)})}function setupMovavgLine(e,t,a){setupCheckbox(e,"movavgLineOption","Include moving average","Add x-year moving average to graph"),setupTextbox(e,"moveAvgYrs","Years in moving average:","",a),$("#moveAvgYrs").parent().addClass("ui-helper-hidden moveAvgYrs"),$("#movavgLineOption").prop("checked",!1).on("change",function(){$("#moveAvgYrs").parent().toggle(),a>=0?$("#moveAvgYrs").val(a).focus().select():$("#moveAvgYrs").val("5").focus().select()}),t&&$("#movavgLineOption").trigger("click")}function setupRegressLine(e,t){setupCheckbox(e,"regressLineOption","Include regression line","Add least squares regression line to graph"),$("#regressLineOption").prop("checked",t)}function setupLoessLine(e,t){setupCheckbox(e,"loessLineOption","Include LOESS curve","Add LOcal regrESSion curve to graph"),$("#loessLineOption").prop("checked",t)}function setupDegdayLimits(e,t){$('<div id="ddlimits_area"></div>').appendTo(e),setupTextbox("#ddlimits_area","hilimit","Upper limit:","Max temperatures above this value are set to this value",86),setupTextbox("#ddlimits_area","lolimit","Lower limit:","Min temperatures below this value are set to this value",50),$("#hilimit").on("click",function(){$(this).focus().select()}),$("#lolimit").on("click",function(){$(this).focus().select()}),t||$("#ddlimits_area").addClass("ui-helper-hidden")}function setupDegdayChoice(e,t){var a=[{value:"gdd",label:"Growing Degree Days"},{value:"mgdd",label:"Modified GDD"},{value:"begdd",label:"Baskerville Emin GDD"},{value:"cdd",label:"Cooling Degree Days"},{value:"hdd",label:"Heating Degree Days"}];t&&$.each(a,function(e,a){if(a.value===t)return a.selected=!0,!1}),setupMenu(e,"ddtype","Degree day type:","Type of degree days to be accumulated",a),$("#ddtype").parent().attr("id","ddtype-fs"),setupTextbox("#ddtype-fs","baseTemp","Base:","Base temperature for degree day calculations in degrees F",50),$("#baseTemp").parent().addClass("baseTemp-fs"),setupDegdayLimits(e,!1),$("#ddlimits_area").addClass("acis-fsThresh"),$("#ddtype").on("change",function(){"hdd"===this.value||"cdd"===this.value?$("#baseTemp").val(65):$("#baseTemp").val(50),"mgdd"===this.value?$("#ddlimits_area").removeClass("ui-helper-hidden"):$("#ddlimits_area").hasClass("ui-helper-hidden")||$("#ddlimits_area").addClass("ui-helper-hidden")}).trigger("change")}function setupAreaWithinState(e,t){$('<div id="grid_area_select"></div>').appendTo(e).areaWithinState(t)}function setupSpatialSummary(e,t){$('<div id="spatialSummary_area"></div>').appendTo(e).spatialSummarySelection(t)}function setupPlotLine32(e,t){setupCheckbox(e,"plotLine32","Include 32 degree plot line","Add a dotted line at 32 degrees F"),$("#plotLine32").prop("checked",t)}function setupDatasets(e,t){t||(t=3),$(e).append('<div id="source_area"><span>Select source datasets of interest:</span></div>'),$.each([{label:"All",tip:"Select all sources",checked:!1},{label:"ACIS",tip:"Preferred value in ACIS Web Services",checked:!1},{label:"GHCN",tip:"NCDC GHCN-Daily",checked:!0},{label:"TD3210",tip:"NCDC Summary of the Day - First Order",checked:!0},{label:"TD3200",tip:"NCDC Summary of the Day - Cooperative",checked:!0},{label:"TD3206",tip:"NCDC Summary of the Day - CDMP",checked:!1},{label:"TD3205",tip:"NCDC Summary of the Day - MRCC Digitization Project",checked:!1},{label:"TD3298",tip:"NRCC Summary of the Day - Climate Record Books",checked:!1},{label:"TD3299",tip:"NRCC Summary of the Day - Contributed Data (NWS, RCC, SC)",checked:!1},{label:"Shef",tip:"RCC data extracted from shef-encoded reports, such as WxCoder",checked:!1},{label:"CLI",tip:"RCC data extracted from NWS CF6 or CLI messages",checked:!1},{label:"DSM",tip:"RCC data extracted from ASOS Daily Summary Messages",checked:!1}],function(e,a){0!==e&&e%t==0&&$("<br />").appendTo("#source_area"),setupCheckbox("#source_area","source_"+a.label,a.label,a.tip),$("#source_"+a.label).attr("name","sourcelist").prop("checked",a.checked).val(a.label)}),$("#source_All").on("click",function(){$("input[name=sourcelist]").prop("checked",$(this).prop("checked"))})}function setupDateSelection(e){$('<div class="barBox_container ui-widget ui-corner-all"></div>').appendTo(e).buttonBar({barName:"date_select_type",barOrient:"vertical",buttonInfo:[["day_button","Day"],["month_button","Month"],["interval_button","Interval"]],buttonDefault:"month_button",barBox:!0}),$("#day_button").on("click",function(){$(".acis-barBoxArea").empty().append($('<div id="tdate_area"></div>').singleDateSelection({sdFormat:"ymd",tooltipShow:$("#tiptoggler").data("tipsOn")}))}),$("#month_button").on("click",function(){$(".acis-barBoxArea").empty().append($('<div id="tdate_area"></div>').singleDateSelection({sdFormat:"ym",tooltipShow:$("#tiptoggler").data("tipsOn")}))}).trigger("click"),$("#interval_button").on("click",function(){$(".acis-barBoxArea").empty(),$('<div id="date_area" style="padding-left:6px;"></div>').appendTo(".acis-barBoxArea").dateRangeSelection({makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))})})}function setupMultiElementSelection(e){$('<div class="element_list"></div>').appendTo(e).elementSelection({makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$("div.element_list fieldset.acis-fsElem").css("margin-top","8px"),$("div.element_list fieldset.acis-fsReduce").css("margin-top","8px"),$("#element_area").append('<div class="buttonHolder"><button id="anotherVar" class="smallButton">Add another variable</button></div>'),$("#anotherVar").button().on("click",function(){$('<div class="element_list"></div>').insertAfter("div.element_list:last").elementSelection({makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$("div.element_list:last fieldset.acis-fsElem label").remove(),$("div.element_list:last fieldset.acis-fsReduce label").remove()})}function setupNoOptions(e){$(e).html("No options for this product")}function about(){$("#results_area").load("about.html")}function accordionToggler(){var e={heightStyle:"content",collapsible:!0,active:!1,activate:function(){var e=$("#product_select").data("productId");$(this).accordion("option","active")===$("#inputs .ui-accordion-header").index($("#option_acc"))||$(this).accordion("option","active")===$("#inputs .ui-accordion-header").index($("#product_acc"))?hideMap():e&&(e.indexOf("StnProduct")>=0?$("#"+defaults.stn_select_type).trigger("click"):e.indexOf("GridProduct")>=0?$("#"+defaults.gridArea_select_type).trigger("click"):$("#"+defaults.multiStn_select_type).trigger("click"))}};0===$(".ui-accordion").length?($("#inputs").find("h3").hasClass("h3_no_accordion")&&$("#inputs").find("h3").button("destroy").removeClass("h3_no_accordion"),$("#inputs").accordion(e)):$("#inputs").accordion("destroy").find("h3").addClass("h3_no_accordion").button(),defaults.accordion=$(".ui-accordion").length}function tooltipToggler(e){var t={tooltipClass:"acis-tooltip",position:{my:"left center",at:"right+5 center"},open:function(e,t){setTimeout(function(){$(t.tooltip).remove()},5e3)}};1===e||"Enable tooltips"===$("#tiptoggler").button("option","label")?($("#leftbox").tooltip(t),$("#helper_bar").tooltip(t),$("#settings_box").tooltip(t),$("#tiptoggler").button("option","label","Deactivate tooltips").data("tipsOn",!0)):"Activate tooltips"===$("#tiptoggler").button("option","label")?($("#leftbox").tooltip("enable"),$("#helper_bar").tooltip("enable"),$("#settings_box").tooltip("enable"),$("#tiptoggler").button("option","label","Deactivate tooltips").data("tipsOn",!0)):($("#leftbox").tooltip("disable"),$("#helper_bar").tooltip("disable"),$("#settings_box").tooltip("disable"),$("#tiptoggler").button("option","label","Activate tooltips").data("tipsOn",!1)),defaults.tooltips=$("#tiptoggler").data("tipsOn")?1:0}function displayHelp(e){return 0===$("#helpDialog").length?$("<div id='helpDialog'></div>").appendTo(document.body).addClass("ui-widget").load(e.data.file).dialog({width:$("#rightbox").width(),modal:!0,title:"Help",position:{my:"top",at:"top"}}):$("#helpDialog").load(e.data.file).dialog("open"),!1}function setupHelperBar(){$("#rightbox").append('<div id="helper_bar"></div><div id="helper_border_mask"></div><div id="settings_box"></div>'),$("#helper_bar").append('<img src="images/Printer.png" id="printResults" alt="Print" title="Print" width="16" height="16" /><img src="images/Settings.png" id="showSettings" alt="Settings" title="Settings" width="16" height="16" /><img src="images/Help.png" id="showHelp" alt="Help" title="Help" width="16" height="16" />').position({my:"left top",at:"left top",of:$("#rightbox")}),$("#settings_box").append('<img src="images/close_icon.png" alt="close" title="close" height="16" width="16" /><br /><fieldset><label for="inputSize">Base font size for input: </label><input type="text" id="inputSize" size=2 /></fieldset><p><fieldset><label for="resultsSize">Base font size for results: </label><input type="text" id="resultsSize" size=2 /></fieldset></p><p><span id="accordtoggler">Toggle accordion interface</span></p><p><span id="tiptoggler">Deactivate tooltips</span></p>'),$("#printResults").on("click",function(){$("#results_area").printArea()}),$("#showHelp").on("click",{file:"./help/help_main.html"},displayHelp),$("#showSettings").on("click",function(){$("#helper_bar").addClass("helper_bar_open"),$("#helper_border_mask").show().position({my:"left+1 top-1",at:"left bottom",of:$("#helper_bar"),collision:"none none"}),$("#settings_box").slideDown("slow").position({my:"left top-1",at:"left bottom",of:$("#helper_bar"),collision:"none none"}),$("#settings_box img").position({my:"right-1 top",at:"right top",of:$("#settings_box")})}),$("#settings_box img").on("click",function(){$("#settings_box").slideUp("fast",function(){$("#helper_border_mask").hide("fast")}),$("#helper_bar").removeClass("helper_bar_open")}),$("#accordtoggler").button().addClass("acis-smallButton").on("click",accordionToggler),$("#tiptoggler").button({label:1===defaults.tooltips?"Dectivate tooltips":"Enable tooltips"}).addClass("acis-smallButton").on("click",tooltipToggler),$("#inputSize").spinner({max:36,min:6,page:2}).spinner("value",$("#leftbox").elementFontSize()).on("change spinstop",function(){$("#leftbox").elementFontSize($(this).val()),sizeBoxes(),$("#helper_bar").position({my:"left top",at:"left top",of:$("#rightbox")}),$("#helper_border_mask").position({my:"left+1 top-1",at:"left bottom",of:$("#helper_bar"),collision:"none none"}),$("#settings_box").position({my:"left top-1",at:"left bottom",of:$("#helper_bar"),collision:"none none"}),$("#settings_box img").position({my:"right-1 top",at:"right top",of:$("#settings_box")}),$("#map_area").css("left",$("#leftbox").outerWidth()-1),$("#border_mask").css("left",$("#leftbox").outerWidth()-1),defaults.leftboxSize=$(this).val()}),$("#resultsSize").spinner({max:36,min:6,page:2}).spinner("value",$("#results_area").elementFontSize()).on("change spinstop",function(){$("#results_area").elementFontSize($(this).val()),defaults.resultsareaSize=$(this).val()})}function initCommon(){$.datepicker.setDefaults({yearRange:"1850:"+Date.today().getFullYear(),showAnim:"slideDown",showOn:"button",buttonText:"Click for calendar",buttonImage:"/images/calicon.gif",buttonImageOnly:!0,changeMonth:!0,changeYear:!0}),$.tablesorter.addParser({id:"sortmt",is:function(){return!1},format:function(e){return e.replace(/T/,.001).replace(/^[\-M]$/,-99999)},type:"numeric"}),$.tablesorter.addParser({id:"sorttrace",is:function(){return!1},format:function(e){return e.replace(/T/,.001)},type:"numeric"}),$.tablesorter.addParser({id:"sortseadate",is:function(){return!1},format:function(e){var t=e.split("-"),a=t[0];return a?a<input_params.elems[0].season_start.split("-")[0]?parseInt(a,10)+12+"-"+t[1]:e:""},type:"text"}),$.ajaxSetup({timeout:6e4,error:function(e,t){0===e.status?$(document).reportError({errorText:"You are offline - check your network."}):404===e.status?$(document).reportError({errorText:"Requested URL not found."}):500===e.status?$(document).reportError({errorText:"Internal Server Error."}):"parsererror"===t?$(document).reportError({errorText:"Error parsing JSON response."}):"timeout"===t?$(document).reportError({errorText:"Request timed out."}):$(document).reportError({errorText:"Unknown AJAX error.\n"+e.responseText}),$(".loading").parent().loadSpinner("fadeOut")}})}Array.max=function(e){return Math.max.apply(Math,e)},Array.min=function(e){return Math.min.apply(Math,e)},$.fn.elementFontSize=function(e){return e?($(this).css("font-size",e+"px"),!1):$(this).css("font-size").replace("px","")};
/* xmacis2_products
 * Version 1.0.66
 * 
 * Keith Eggleston
 *  Northeast Regional Climate Center
 */
function getMultiTitleEnd(){var e="";return"state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&(e=" for "+$("#multi_stn_select").areaSelection("getSubstateName")),e}function addDisplayTitle(e,t,a,n){"html"===a||"datatable"===a?$("#results_area").append('<table class="'+(n||"tablesorter")+'"><caption>'+e+t+"</caption><thead></thead><tbody></tbody><tfoot></tfoot></table>"):$("#results_area").append("<pre>"+e+"<br/></pre>")}function addDisplayHead(e,t,a){"html"===t||"datatable"===t?$("."+(a||"tablesorter")+" thead").append("<tr>"+e+"</tr>"):$("#results_area pre:last").append("<br/>"+e.replace(/ /g,"").replace(/<th[\d\w\s\/\-=":;]+>/g,"<th>").replace(/<\/th><th>/g,", ").replace(/<[\d\w\s\/\-=":;]+>/g,""))}function addDisplayRow(e,t,a){"html"===t||"datatable"===t?$("."+(a||"tablesorter")+" tbody").append("<tr>"+e+"</tr>"):$("#results_area pre:last").append("<br/>"+e.replace(/<\/tr><tr>/g,"zBRz").replace(/<td[\d\w\s\/\-=":;]+>/g,"<td>").replace(/<\/td><td>/g,", ").replace(/<[\d\w\s\/\-=":;]+>/g,"").replace(/zBRz/g,"<br/>"))}function addDisplayFoot(e,t,a){"html"===t||"datatable"===t?$("."+(a||"tablesorter")+" tfoot").append("<tr>"+e+"</tr>"):$("#results_area pre:last").append("<br/><br/>"+e.replace(/<\/tr><tr>/g,"BR").replace(/<\/td><td>/g,", ").replace(/<[\d\w\s\/\-=":;]+>/g,"").replace(/BR/g,"<br/>"))}function setupDataTable(){}function buildStationName(e){var t,a,n=e.sids,s=e.name+", "+e.state;for(t=0;t<n.length;t+=1){if("10"===(a=n[t].split(" "))[1]){s+=" (CoCoRaHS)";break}if("9"===a[1]){s+=" (ThreadEx)";break}if("17"===a[1]){s+=" (SCAN)";break}if("19"===a[1]){s+=" (TSCAN)";break}if("6"===a[1]&&"USS"===a[0].substr(0,3)){s+=" (Snotel)";break}if("6"===a[1]&&"USR"===a[0].substr(0,3)){s+=" (RAWS)";break}if("16"===a[1]){s+=" (AWDN)";break}}return s}function showTableCntyNames(e,t){var a,n=[],s={},r=$.extend(!0,{},input_params);$.each(e,function(e,t){a=t.hasOwnProperty("meta")?t.meta.state:t.state,-1===$.inArray(a,n)&&n.push(a)}),input_params={state:n,meta:["id","name"]},postResults("/General/county",function(e){e.meta.length>0&&$.each(e.meta,function(e,t){s[t.id]=t.name.replace(" County","")}),input_params=$.extend(!0,{},r),t(s)})}function getDecPlaces(e){var t,a={pcpn:{dec_places:2,dec_places_mean:2},snow:{dec_places:1,dec_places_mean:1},maxt:{dec_places:0,dec_places_mean:1},mint:{dec_places:0,dec_places_mean:1},avgt:{dec_places:1,dec_places_mean:1},snwd:{dec_places:0,dec_places_mean:1},hdd:{dec_places:0,dec_places_mean:1},cdd:{dec_places:0,dec_places_mean:1},gdd:{dec_places:0,dec_places_mean:1},mly_pcpn:{dec_places:2,dec_places_mean:2},mly_maxt:{dec_places:0,dec_places_mean:1},mly_mint:{dec_places:0,dec_places_mean:1},mly_avgt:{dec_places:1,dec_places_mean:1}};return e=e||0,(t=input_params.elems[e].reduce?input_params.elems[e].reduce.reduce:input_params.elems[e].smry.reduce).search("pct")>=0||t.search("cnt")>=0?0:"mean"===t?a[input_params.elems[e].name].dec_places_mean:a[input_params.elems[e].name].dec_places}function showTextTable(){var e,t,a="",n=$(".tablesorter caption").html().replace("Click column heading to sort ascending, click again to sort descending.","").replace("Each column contains","For each month:").replace(/<br>/g,"\n").replace(/<[\d\w\s\/\-=":;]+>/g,"");$(".loading").parent().loadSpinner("fadeOut"),$(".tablesorter tr").each(function(){$(this).find("th,td").each(function(n){e=$(this).html(),t=e.indexOf("<br>"),e=e.substr(0,-1!==t?t:e.length),a+=(0!==n?", ":"")+e}),a+="\n"}),$("#results_area").append("<pre>"+n+"\n"+a+"</pre>")}function getRowMeans(e){var t,a,n,s=[];return $.each($(".tablesorter").find("tr"),function(){a=0,n=0,$(this).find("td").length&&($.each($(this).find("td").not(".seasonCol"),function(s){0!==s&&(s-1)%e==0&&"M"!==(t=$(this).text())&&("T"!==t?(t=parseFloat(t),"T"!==a?a+=t:0!==t&&(a=t)):0===a&&(a="T"),n+=1)}),0===n?s.push("M"):"T"!==a?s.push(a/n):s.push("T"))}),s}function buildColumnArray(e){var t,a=[];return $.each($(".tablesorter").find("tr"),function(){$(this).find("td").length>=e+1&&(t=$(this).find("td").eq(e).text(),$.isNumeric(t)&&(t=parseFloat(t)),a.push(t))}),a}function columnCalcs(e){var t,a,n,s=0,r=0,i=-9999,o=9999;for(a=0;a<e.length;a+=1)"M"!==(t=e[a])&&"-"!==t&&(r+=1,"T"!==t?(s+=t,t>i&&(i=t),t<o&&(o=t)):(i=Math.max(i,1e-4),o=Math.min(o,1e-4)));return 0===r?(i="M",o="M",n="M"):(i=1e-4===i?"T":i,o=1e-4===o?"T":o,n=0===s&&$.inArray("T",e)?"T":s/r),[n,i,o]}function displayMonavgTable(e,t){var a,n,s,r,i,o,l,d,p=!0,m=getDecPlaces(),u=getFilterYrs(),c=input_params.elems[0].reduce.add&&$.inArray("date",input_params.elems[0].reduce.add)>=0,h=input_params.elems[0].reduce.add&&$.inArray("mcnt",input_params.elems[0].reduce.add)>=0,g=1+(c?1:0)+(h?1:0),y={sortAppend:[[0,1]]},_=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b=[$("#element_area").elementSelection("getter","mly")],f=input_params.elems,D=f[0].groupby,x=1===D[1]&&12===D[2]?"Annual":"Season",v=column_headers(b,[]),S="months"===getSeasonCalcs(),C=v[0].search("Mean Avg Temperature")>=0&&"intermediate"===getTempRounding(),M="Monthly "+v[0]+"for "+buildStationName(e.meta),T=(c||h?"<br /><span class='subtitle'>Each column contains monthly value"+(c?", date of occurrence":"")+(h?" and monthly number of missing days":"")+"</span>":"")+"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>";for(C&&(e.data=calcLegacyAvgTempTable(e.data,getMcnt())),u.length>0&&(e.data=filterResults(e.data,0,u)),"por"!==input_params.sDate&&Date.parse(e.data[0][0]+"-"+f[0].groupby[2]+"-01").moveToLastDayOfMonth()<Date.parse(input_params.sDate)&&e.data.shift(),$("#results_area").append('<table class="tablesorter"><caption></caption><thead></thead><tbody></tbody><tfoot></tfoot></table>'),"csv-table"===t&&($(".tablesorter").hide(),$("#results_area").loadSpinner({message:"Processing data ..."})),$(".tablesorter caption").append(M+(T.length?T:"")),a='<tr><th class="sorter-text">Year</th>',n=D[1];p||n!==D[2]+1;)13===n&&(n=1),a+="<th"+(c||h?' style="text-align:right; border-right:0px;"':"")+' class="sorter-sorttrace string-bottom">'+_[n-1]+(c?'</th><th style="border-left:0px;border-right:0px;" class="sorter-digit string-bottom">'+("csv-table"===t?"date":""):"")+(h?'</th><th style="border-left:0px;" class="sorter-digit string-bottom">'+("csv-table"===t?"mcnt":""):"")+"</th>",n+=1,p=!1;if(a+='<th class="sorter-sorttrace string-bottom">'+x+"</th>",$(".tablesorter thead").append(a+"</tr>"),$.each(e.data,function(e,t){a="<tr><td>"+(D[1]<=D[2]?"":t[0]-1+"-")+t[0]+"</td>",$.each(t[1],function(e,t){"M"===t&&(c||h)&&(t=["M"],c&&t.push("    -  -  "),h&&t.push("-")),a+="object"==typeof t?'<td style="border-right:0px;">'+roundFix(t[0],m)+(c?'</td><td style="border-left:0px;border-right:0px;">'+("M"===t[1]?"-":t[1].substr(8,2)):"")+(h?'</td><td style="border-left:0px;">'+t[t.length-1]:"")+"</td>":"<td>"+roundFix(t,m)+"</td>"}),a+='<td class="seasonCol"></td>',$(".tablesorter tbody").append(a+"</tr>")}),S&&(l=columnCalcs(o=getRowMeans(g))),e.smry||u.length>0){if(s='<tr class="rowtopblue"><th>Mean</th>',r="<tr><th>Max</th>",i="<tr><th>Min</th>",e.smry)$.each(e.smry[0],function(e,t){s+='<td style="border-right:0px;">'+roundFix(t[0],m)+(c?'</td><td style="border-left:0px;border-right:0px;">-':"")+(h?'</td><td style="border-left:0px;">':"")+"</td>",r+='<td style="border-right:0px;">'+roundFix(t[1][0],m)+(c?'</td><td style="border-left:0px;border-right:0px;">'+("M"===t[1][0]?"-":t[1][1].substr(0,4)):"<br />"+("M"===t[1][0]?"-":t[1][1].substr(0,4)))+(h?'</td><td style="border-left:0px;">':"")+"</td>",i+='<td style="border-right:0px;">'+roundFix(t[2][0],m)+(c?'</td><td style="border-left:0px;border-right:0px;">'+("M"===t[2][0]?"-":t[2][1].substr(0,4)):"<br />"+("M"===t[2][0]?"-":t[2][1].substr(0,4)))+(h?'</td><td style="border-left:0px;">':"")+"</td>"});else for(n=1;n<=$(".tablesorter thead").find("th").length-2;n+=g)d=columnCalcs(buildColumnArray(n)),s+='<td style="border-right:0px;">'+roundFix(d[0],m)+(c?'</td><td style="border-left:0px;border-right:0px;">':"")+(h?'</td><td style="border-left:0px;">':"")+"</td>",r+='<td style="border-right:0px;">'+roundFix(d[1],m)+(c?'</td><td style="border-left:0px;border-right:0px;">':"")+(h?'</td><td style="border-left:0px;">':"")+"</td>",i+='<td style="border-right:0px;">'+roundFix(d[2],m)+(c?'</td><td style="border-left:0px;border-right:0px;">':"")+(h?'</td><td style="border-left:0px;">':"")+"</td>";s+='<td class="seasonSmry"></td>',r+='<td class="seasonSmry"></td>',i+='<td class="seasonSmry"></td>',$(".tablesorter tfoot").append(s+"</tr>"),$(".tablesorter tfoot").append(r+"</tr>"),$(".tablesorter tfoot").append(i+"</tr>")}S?($.each($("td.seasonCol"),function(e){$(this).html(roundFix(o[e],m))}),l.length&&($("td.seasonSmry:eq(0)").html(roundFix(l[0],m)),$("td.seasonSmry:eq(1)").html(roundFix(l[1],m)),$("td.seasonSmry:eq(2)").html(roundFix(l[2],m))),"table"===t?$(".tablesorter").tablesorter(y):showTextTable()):($(".tablesorter caption").loadSpinner({message:"Processing seasonal data ..."}),$.extend(input_params,{sDate:Date.parse(e.data[0][0]+"-"+f[0].groupby[2]+"-01").moveToLastDayOfMonth().toString("yyyy-MM-dd"),eDate:Date.parse(e.data[e.data.length-1][0]+"-"+f[0].groupby[2]+"-01").moveToLastDayOfMonth().toString("yyyy-MM-dd"),meta:[]}),$.extend(input_params.elems[0],{season_start:numberPad(f[0].groupby[1],2)+"-01",interval:[1,0,0],duration:"std"}),delete input_params.elems[0].groupby,delete input_params.elems[0].reduce.add,C&&(input_params.elems.pop(),$.extend(input_params.elems[0],{name:"avgt"})),postResults("/StnData",function(e){u.length>0&&(e.data=filterResults(e.data,0,u)),$.each($("td.seasonCol"),function(t){$(this).html(roundFix(e.data[t][1],m))}),e.smry?($("td.seasonSmry:eq(0)").html(roundFix(e.smry[0][0],m)),$("td.seasonSmry:eq(1)").html(roundFix(e.smry[0][1][0],m)+"<br />"+e.smry[0][1][1].substr(0,4)),$("td.seasonSmry:eq(2)").html(roundFix(e.smry[0][2][0],m)+"<br />"+e.smry[0][2][1].substr(0,4))):u.length>0&&(d=columnCalcs(buildColumnArray($(".tablesorter thead").find("th").length-1)),$("td.seasonSmry:eq(0)").html(roundFix(d[0],m)),$("td.seasonSmry:eq(1)").html(roundFix(d[1],m)),$("td.seasonSmry:eq(2)").html(roundFix(d[2],m))),"table"===t?$(".tablesorter").tablesorter(y):showTextTable()},!0))}function displayMonavgList(e,t){var a,n,s,r,i,o=[],l=[],d=getFilterYrs(),p=column_headers(input_params.elems,[]),m="Data for "+buildStationName(e.meta);t=t.search("csv")<0?"html":"text",e.data=filterResults(e.data,1,getFilterMonths()),d.length>0&&(e.data=filterResults(e.data,0,d)),a='<th class="sorter-text">Date</th>',$.each(p,function(e,n){o.push(input_params.elems[e].reduce.add&&$.inArray("date",input_params.elems[e].reduce.add)>=0),l.push(input_params.elems[e].reduce.add&&$.inArray("mcnt",input_params.elems[e].reduce.add)>=0),a+="<th"+(o[e]||l[e]?' style="text-align:center; border-right:0px;"':"")+' class="sorter-sorttrace string-bottom">'+n+(o[e]?'</th><th style="border-left:0px;border-right:0px;" class="sorter-digit string-bottom">'+("text"===t?"date":"Date"):"")+(l[e]?'</th><th style="border-left:0px;" class="sorter-digit string-bottom">'+("text"===t?"mcnt":"Miss"):"")+"</th>"}),r=$.inArray(!0,o)>=0,i=$.inArray(!0,l)>=0,addDisplayTitle(m,(r||i?"<br /><span class='subtitle'>Each column contains monthly value for variable"+(r?", date of occurrence (if applicable)":"")+(i?" and monthly number of missing days":"")+".</span>":"")+"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",t),addDisplayHead(a,t),$.each(e.data,function(e,r){for(a='<td style="white-space:nowrap;">'+r[0]+"</td>",n=1;n<r.length;n+=1)"object"==typeof r[n]?(s=r[n],a+='<td style="border-right:0px;">'+roundFix(s[0],getDecPlaces(n-1))+(o[n-1]?'</td><td style="border-left:0px;border-right:0px;">'+("M"===s[1]?"-":s[1].substr(8,2)):"")+(l[n-1]?'</td><td style="border-left:0px;">'+s[s.length-1]:"")+"</td>"):a+="<td>"+roundFix(r[n],getDecPlaces(n-1))+"</td>";addDisplayRow(a,t)}),"html"===t&&$(".tablesorter").tablesorter({sortAppend:[[0,1]]})}function displayMonavg(e){var t=getOutputChoice()||"table";t.search("table")>=0?displayMonavgTable(e,t):displayMonavgList(e,t)}function displayDayavgTable(e,t){var a,n,s,r,i,o,l,d=getDecPlaces(),p=e.meta.valid_daterange[0],m=input_params.elems[0].smry.add&&input_params.elems[0].smry.add.search("date")>=0,u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=[-1,30,59,90,120,151,181,212,243,273,304,334],h=[31,29,31,30,31,30,31,31,30,31,30,31],g=column_headers(input_params.elems,[])[0].replace("of Days","of Years")+"by Day for "+buildStationName(e.meta);for(addDisplayTitle(g,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",t),a='<th class="sorter-digit">Day</th>',n=1;n<=12;n+=1)a+="<th"+(m?' style="text-align:right; border-right:0px;"':"")+' class="sorter-sorttrace string-bottom">'+u[n-1]+(m?'</th><th style="border-left:0px;" class="sorter-digit string-bottom">':"")+"</th>";for(addDisplayHead(a,t),n=1;n<=31;n+=1){for(a="<td>"+n+"</td>",s=1;s<=12;s+=1)a+=n<=h[s-1]?"object"==typeof(r=e.smry[0][n+c[s-1]])?'<td style="border-right:0px;">'+roundFix(r[0],d)+'</td><td style="border-left:0px;">'+r[1].substr(0,4)+"</td>":"<td>"+roundFix(r,d)+"</td>":"<td"+(m?' style="border-right:0px;"':"")+"> -</td>"+(m?'<td style="border-left:0px;"> -</td>':"");addDisplayRow(a,t)}a="<td colspan="+(m?25:13)+">Period of record: "+("por"===input_params.sDate?p[0]:p[0]>input_params.sDate?p[0]:input_params.sDate)+" to "+("por"===input_params.eDate?p[1]:p[1]<input_params.eDate?p[1]:input_params.eDate)+"</td>","html"===t?(addDisplayFoot(a,t),$(".tablesorter").tablesorter({sortAppend:[[0,1]]}),"max"!==input_params.elems[0].smry.reduce&&"min"!==input_params.elems[0].smry.reduce||(i="date"===input_params.elems[0].smry.add,o=input_params.elems[0].smry.reduce,l="max"===o?"red":"blue",$.extend(input_params.elems[0],{reduce:{reduce:o}}),input_params.elems[0].interval="mly",i&&delete input_params.elems[0].smry.add,postResults("/StnData",function(e){var t,a;$(".tablesorter tbody tr").each(function(n,s){$(s).children("td").each(function(n,s){n>0&&(t=$(s).text(),a=i?e.smry[0][(n-1)/2]:e.smry[0][n-1],t===a&&"M"!==t&&$(s).css({color:l,"font-weight":"500"}))})})}))):"datatable"===t&&($("results_area").append("<p>"+a+"</p>"),setupDataTable(".tablesorter",{title:g}))}function displayDayavgList(e){var t,a,n=getDecPlaces(),s=e.meta.valid_daterange[0],r=getOccur(),i=input_params.elems,o=column_headers(i,[])[0]+"by Day for "+buildStationName(e.meta)+"<br/><br/>Day, Value"+(r?", Year":"")+"<br/>";$.each(e.smry[0],function(e,s){"object"==typeof s?o+=s[1].substr(5,5)+", "+s[0]+(r?", "+s[1].substr(0,4):"")+"<br/>":(t=new Date(2012,0),a=new Date(t.setDate(e+1)).toString("MM-dd"),o+=a+", "+roundFix(s,n)+"<br/>")}),o+="<br/>Period of record: "+("por"===input_params.sDate?s[0]:s[0]>input_params.sDate?s[0]:input_params.sDate)+" to "+("por"===input_params.eDate?s[1]:s[1]<input_params.eDate?s[1]:input_params.eDate),$("#results_area").html("<pre>"+o+"</pre>")}function displayDayavg(e){var t=getOutputChoice()||"html";"csv-list"!==t?displayDayavgTable(e,t):displayDayavgList(e)}function displayNormalsHtml(e,t){var a,n,s,r,i,o,l,d,p,m=[],u=[],c=[],h=[],g={pcpn:2,snow:1,maxt:0,mint:0,avgt:0,hdd:0,cdd:0,gdd:0},y=["January","February","March","April","May","June","July","August","September","October","November","December"],_={pcpn:" (inches)",snow:" (inches)",maxt:" (F)",mint:" (F)",avgt:" (F)",hdd:" (base 65)",cdd:" (base 65)",gdd:" (base 50)"},b=$("#month_area").monthRangeSelection("getter"),f=getNormalType(),D=input_params.elems,x=column_headers(D);if(!b)return!1;if(l=b[0],d=b[1],"mly"===f){for(s=l;s<=(l<d?d:d+12);s+=1)u.push(y[s<=12?s-1:s-13]);for(a="",s=1;s<=D.length;s+=1)"M"!==e.data[0][s]&&(a+="<th>"+x[s-1]+_[D[s-1].name]+"</th>");if(0===a.length)return $("#results_area").append("<p>No normals available for this station.</p>"),!1;for($("#results_area").append('<table class="basictable normalsTable"><thead><tr></tr></thead><tbody></tbody></table>'),$(".normalsTable thead tr").append("<th>Month</th>"+a),r=1;r<=D.length;r+=1)c[r]=0,h[r]=0;if($.each(e.data,function(e,t){for(a="<tr><th>"+u[e]+"</th>",r=1;r<=D.length;r+=1)"M"!==t[r]&&("avgt"===D[r-1].name&&(t[r]=roundFix(t[r],1)),a+="<td>"+t[r]+"</td>",c[r]+=parseFloat(t[r]),h[r]+=1);a+="</tr>",$(".normalsTable tbody").append(a)}),12==e.data.length){for(n="<tr><th>Annual</th>",r=1;r<=D.length;r+=1)12==h[r]&&(n+="<td>"+(["maxt","mint","avgt"].includes(D[r-1].name)?roundFix(c[r]/h[r],1):roundFix(c[r],g[D[r-1].name]))+"</td>");$(".normalsTable tbody").append(n)}}else{for(s=0;s<D.length;s+=1)for(m.push([]),r=0;r<12;r+=1)for(m[s].push([]),i=0;i<31;i+=1)m[s][r].push("-");for($.each(e.data,function(t,a){for(o=a[0].split("-"),0===t||"pcpn"!==D[0].name&&"snow"!==D[0].name?m[0][o[1]-1][o[2]-1]=roundStr(a[1],g[D[0].name]):m[0][o[1]-1][o[2]-1]=(a[1]-e.data[t-1][1]).toFixed(g[D[0].name]),r=2;r<a.length;r+=1)p=roundStr(a[r],g[D[r-1].name]),m[r-1][o[1]-1][o[2]-1]=p}),x[0].search("Total")>-1&&(x[0]="pcpn"===D[0].name?"Daily Precipitation Normal":"Daily Snowfall Normal"),$("#results_area").append('<table class="basictable normalsTable"></table>'),i=0;i<D.length;i+=1)if("M"!==m[i][0][0]){for($(".normalsTable").append("<tr><th colspan=13>"+x[i]+_[D[i].name]+"</th></tr>"),a="<tr><th>Day</th>",r=0;r<12;r+=1)a+="<th>"+y[r].substr(0,3)+"</th>";for(a+="</tr>",$(".normalsTable").append(a),s=0;s<31;s+=1){for(a="<tr><th>"+(s+1)+"</th>",r=0;r<12;r+=1)a+="<td>"+m[i][r][s]+"</td>";a+="</tr>",$(".normalsTable").append(a)}}if(0===$(".normalsTable tr").length)return $("#results_area").append("<p>No normals available for this station.</p>"),!1}$.inArray("graph",t)<0&&($(".normalsTable").append("<caption></caption>"),$(".normalsTable caption").append(("mly"===f?"Monthly":"Daily")+" Climate Normals (1991-2020) - "+buildStationName(e.meta)))}function displayNormalsList(e){var t=getNormalType(),a={pcpn:{dly:2,mly:2},snow:{dly:1,mly:1},maxt:{dly:0,mly:1},mint:{dly:0,mly:1},avgt:{dly:0,mly:1},hdd:{dly:0,mly:0},cdd:{dly:0,mly:0},gdd:{dly:0,mly:0}},n=input_params.elems,s="<pre>"+buildStationName(e.meta)+"<br />date";$.each(input_params.elems,function(e,t){s+=","+t.name+(t.reduce?"|"+t.reduce.reduce:"")}),s+="<br />",$.each(e.data,function(e,r){$.each(r,function(e,r){s+=0===e?r.substr(5):", "+roundStr(r,a[n[e-1].name][t])}),s+="<br />"}),s+="</pre>",$("#results_area").append(s)}function displayNormalsGrf(e){var t,a,n,s,r=[],i=$("#month_area").monthRangeSelection("getter"),o=$("#element_area").elementSelection("getter"),l=getNormalType(),d={pcpn:{color:"#41A317",type:"mly"===l?"column":"area",yAxis:0,dec_places:2,units:"inches"},snow:{color:"#41A317",type:"mly"===l?"column":"area",dec_places:1,units:"inches"},maxt:{color:"red",type:"line",yAxis:1,dec_places:1,units:"F"},mint:{color:"blue",type:"line",yAxis:1,dec_places:1,units:"F"},avgt:{color:"#8A4117",type:"line",yAxis:1,dec_places:1,units:"F"},hdd:{color:"blue",type:"mly"===l?"column":"line",dec_places:0,units:""},cdd:{color:"red",type:"mly"===l?"column":"line",dec_places:0,units:""},gdd:{color:"#8A4117",type:"mly"===l?"column":"line",dec_places:0,units:""}},p=input_params.elems,m=defineGraphOptions({yaxisCnt:"tp"===o.name?2:1}),u=column_headers(p);if(!i)return!1;for(t=0;t<p.length;t+=1)r.push([]),"dly"===l&&u[t].search("Total")>-1&&(u[t]="pcpn"===p[t].name?"Accumulated Precipitation Normal":"Accumulated Snowfall Normal");for($.each(e.data,function(e,t){$.each(t,function(e,t){0===e?a=ymdToUTC(t):"M"!==t&&(n="T"!==t?parseFloat(t):1e-4,r[e-1].push([a,n]))})}),t=0;t<p.length;t+=1)r[t].length>0&&m.series.push({name:u[t],data:r[t],color:d[p[t].name].color,type:d[p[t].name].type,yAxis:"tp"===o.name?d[p[t].name].yAxis:0});return 0===m.series.length?($(document).reportError({errorText:"No normals available for this station."}),!1):(m.title.text=("mly"===l?"Monthly":"Daily")+" Climate Normals (1991-2020) - "+buildStationName(e.meta),"tp"===o.name?(m.yAxis[0].title.text="Precipitation (inches)",m.yAxis[1].title.text="Temperature (F)",m.yAxis[1].linkedTo=null):"temp"===o.name?m.yAxis.title.text="Temperature (F)":(m.legend.enabled=!1,s=p[0].name.search("dd")>-1?" (base "+("gdd"===p[0].name?"50":"65")+")":" ("+d[p[0].name].units+")",m.yAxis.title.text=u[0]+s,o.name.search("dd")>0&&(m.yAxis.min=0)),m.xAxis.dateTimeLabelFormats.month="dly"===l?"%b %e":"%b",m.tooltip.formatter=function(){var e="<b>"+("string"==typeof this.x?this.x:Highcharts.dateFormat("dly"===l?"%B %e":"%B",this.x))+"</b>";return $.each(this.points,function(t,a){e+="<br />"+a.series.name+": "+Highcharts.numberFormat(this.y,d[p[t].name].dec_places)+" "+d[p[t].name].units}),e},setupChartArea(),$.extend(m,disableControls()),$("#chart_area").highcharts("StockChart",m,setupChartResizer),!0)}function displayNormals(e){var t=getOutputChoice()||["graph","table"];if($.inArray("graph",t)>=0&&displayNormalsGrf(e),$.inArray("table",t)>=0&&displayNormalsHtml(e,t),$.inArray("datatable",t)>=0){if(displayNormalsHtml(e,t),"dly"===getNormalType()){$(".normalsTable tr:first").remove();var a=$(".normalsTable tr")[0].innerHTML;$(".normalsTable tr:first").remove(),$(".normalsTable").prepend("<thead>"+a+"</thead>")}$(".normalsTable").removeClass("basictable"),setupDataTable(".normalsTable",{}),$(".dataTables_wrapper").css("marginTop","0.5em")}$.inArray("csv-list",t)>=0&&displayNormalsList(e)}function findPeriodStart(e){var t,a=new Date.parse(e),n=input_params.elems[0].duration,s=input_params.elems[0].interval;return"dly"===s?t=a.addDays(-n).addDays(1).toString("yyyy-MM-dd"):"mly"===s?t=a.addMonths(-(n-1)).moveToFirstDayOfMonth().toString("yyyy-MM-dd"):"yly"===s&&(t=a.addYears(-(n-1)).moveToMonth(0,-1).moveToFirstDayOfMonth().toString("yyyy-MM-dd")),t}function trimExtremes(e){var t,a,n,s,r,i,o,l,d,p,m,u=[],c=input_params.elems[0].smry.n,h=getRestrictRange(),g=function(e){var t=e[0];"T"===t&&(t="0.001"),u.push([t,e[1],e[2]])};return!!h&&(o=h[0],i=h[1],t=o<=i,a=new Date.parse("2012-"+i).addDays(1).toString("MM-dd")===o,$.each(e,function(e,u){"M"!==u[1][0]&&(n=u[1][1].substr(5,5),a?g(u[1]):(t&&n<=i&&n>=o||!t&&(n<=i||n>=o))&&(s=findPeriodStart(u[1][1]),r=s.substr(5,5),l=parseInt(s.substr(0,4),10),d=parseInt(u[1][1].substr(0,4),10),t?l===d&&r>=o&&r<=i&&g(u[1]):(r>=o||r<=i)&&(p=(m=r>=o?l:l-1)+1+"-"+i,s>=m+"-"+o&&u[1][1]<=p&&g(u[1]))))}),"max"===input_params.elems[0].smry.reduce?u.sort(hilo2d(1)):u.sort(hilo2d(-1)),$.each(u,function(e,t){"0.001"===t[0]&&(t[0]="T")}),u.length>c?u.slice(0,c):u)}function displayExtremes(e){var t,a,n,s=getOutputChoice()||"html",r=null,i=getDecPlaces(),o=getIncludeStart(),l=1===input_params.elems[0].duration&&"dly"===input_params.elems[0].interval,d=["Rank","Value",o?"Dates":"Ending Date"],p="",m=input_params.elems[0].smry.n,u=e.meta.valid_daterange[0],c=input_params.elems[0].smry.reduce.charAt(0).toUpperCase()+input_params.elems[0].smry.reduce.substr(1)+"imum "+input_params.elems[0].duration+"-"+{dly:"Day",mly:"Month",yly:"Year"}[input_params.elems[0].interval]+" "+column_headers(input_params.elems)[0]+"<br />for "+buildStationName(e.meta);if($("#restrictRange").prop("checked")&&(e.smry=[],e.smry.push(trimExtremes(e.data)),!e.smry[0]))return $(document).reportError({errorText:"Error determining extremes for requested range",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1;n=e.smry[0].length===m&&e.smry[0].pop(),addDisplayTitle(c,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",s),l||d.push("Missing Days"),$.each(d,function(e,t){p+='<th class="sorter-'+(t.search("Date")>=0?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(p,s),$.each(e.smry[0],function(e,n){a=n[0]===r?"-":e+1,t=(o?findPeriodStart(n[1])+" through ":"")+n[1],p="<td>"+a+"</td><td>"+roundFix(n[0],i)+"</td><td>"+t+"</td>"+(l?"":"<td>"+n[2]+"</td>"),r=n[0],addDisplayRow(p,s)}),p=n&&n[0]===e.smry[0][e.smry[0].length-1][0]?"<td colspan="+d.length+">Last value also occurred in one or more previous years.</td></tr><tr>":"",addDisplayFoot(p+="<td colspan="+d.length+">Period of record: "+("por"===input_params.sDate?u[0]:u[0]>input_params.sDate?u[0]:input_params.sDate)+" to "+("por"===input_params.eDate?u[1]:u[1]<input_params.eDate?u[1]:input_params.eDate)+"</td>",s),"html"===s&&$(".tablesorter").tablesorter({sortAppend:[[2,1]]})}function displayCondays(e){var t,a,n,s=getOutputChoice()||"html",r=null,i="",o=getIncludeStart(),l=getCondaysContent(),d=input_params.elems[0].smry.add.indexOf("rmcnt")>=0,p="allruns"===l?getRunlen():null,m="numrecs"===l&&e.smry[0].length>1?e.smry[0].pop():null,u=e.meta.valid_daterange[0];addDisplayTitle(column_headers(input_params.elems)[0]+"<br />for "+buildStationName(e.meta),"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",s),$.each(["Rank","Run Length",d?"Missing Days":"",o?"Dates":"Ending Date"],function(e,t){t.length&&(i+='<th class="sorter-'+(t.search("Date")>=0?"text":"sorttrace string-bottom")+'">'+t+"</th>")}),addDisplayHead(i,s),$.each(e.smry[0],function(e,n){("numrecs"===l||"allruns"===l&&parseInt(n[0],10)>=p)&&(a=n[0]===r?"-":e+1,t=(o?dateStart(n[1],n[0])+" through ":"")+n[1],i="<td>"+a+"</td><td>"+n[0]+"</td>"+(d?"<td>"+n[2]+"</td>":"")+"<td>"+t+"</td>",r=n[0],addDisplayRow(i,s))}),n=$("#results_area .tablesorter").find("th").length,i="numrecs"===l&&m&&m[0]===e.smry[0][e.smry[0].length-1][0]?"<td colspan="+n+">Last value also occurred in one or more previous years.</td></tr><tr>":"",addDisplayFoot(i+="<td colspan="+n+">Period of record: "+("por"===input_params.sDate?u[0]:u[0]>input_params.sDate?u[0]:input_params.sDate)+" to "+("por"===input_params.eDate?u[1]:u[1]<input_params.eDate?u[1]:input_params.eDate)+"</td>",s),"html"===s&&$(".tablesorter").tablesorter({sortAppend:[[2,1]]})}function addTrendLine(e){var t,a,n,s=e.chart,r=e.dataobj||"y",i=s.series[0],o=[];for(t=0;t<i.data.length;t+=1)null===(a=i.data[t][r])&&e.removeNull||o.push([i.data[t].x,a]);(n=e.statFunction(o,e)).length>0&&s.addSeries({name:e.lineLabel||"",data:n,type:"line",color:e.color||"black",showInLegend:e.inLegend,turboThreshold:n.length+1})}function displayFirstLastGrf(e){var t=[],a=[],n=[],s={},r=getMovavgLine(),i=getRegressLine(),o=getLoessLine(),l=column_headers(input_params.elems),d=getGroupResults(),p="01-01"===input_params.elems[0].season_start?"calyr":"season",m=d===p?"firlas":"lasfir",u=parseInt(input_params.elems[0].reduce.reduce.split("_")[2],10),c="mint"===input_params.elems[0].name&&u<=36&&"season"===p&&"calyr"===d,h=defineGraphOptions();if($.each($(".tablesorter tbody tr"),function(){var e,r,i,o=$(this),l=o.children("td").size(),d=parseInt(o.find("td:nth-of-type(1)").text(),10),p=function(e){var t,a=o.find("td:nth-of-type("+e+")").text().split(" ");return a.length<=1?null:(t=2012+parseInt(a[1].replace(/[()]/g,""),10)-d,"02-29"===a[0]&&2012!==t&&(a[0]="02-28",alert("Date for "+d+" changed to Feb 28 for plotting purposes")),ymdToUTC(t+"-"+a[0]))};e=ymdToUTC(d+"-01-01"),r=p(l/2+1),i=p(2),t.push([e,r,i]),null===r&&null!==i&&a.push([e,i]),null===i&&null!==r&&n.push([e,r]),s[d]=o.find("td:nth-of-type("+l+")").text()}),!(t.length>0))return $(document).reportError({errorText:"No data available for selection",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1;h.series.push({name:"First/last dates",data:t,color:"blue",type:"columnrange",turboThreshold:t.length+1}),a.length>0&&h.series.push({name:("firlas"===m?"First ":"Last ")+"date",data:a,color:"blue",type:"line",lineWidth:0,marker:{enabled:!0,symbol:"triangle-down"},turboThreshold:a.length+1}),n.length>0&&h.series.push({name:("firlas"===m?"Last ":"First ")+"date",data:n,color:"blue",type:"line",lineWidth:0,marker:{enabled:!0,symbol:"triangle"},turboThreshold:n.length+1}),$.extend(h.title,{text:(c?"Frost/Freeze":"First/Last")+" Dates for "+buildStationName(e)}),$.extend(h.subtitle,{text:l}),$.extend(h.xAxis,{dateTimeLabelFormats:{hour:"%Y",day:"%Y",week:"%Y",month:"%Y"}}),$.extend(h.yAxis,{reversed:!0,type:"datetime",dateTimeLabelFormats:{hour:"%b %e",day:"%b %e",week:"%b %e",month:"%b %e"}}),$.extend(h.tooltip,{shared:!0,formatter:function(){var e=Highcharts.dateFormat("%Y",this.x),t="<b>"+e+("season"===d?"-"+Highcharts.dateFormat("%Y",this.x+31536e6):"")+": </b>";return $.each(this.points,function(a,n){"First/last dates"===n.series.name?t+="<br /><span>"+("firlas"===m?"First":"Last")+" occurrence: "+Highcharts.dateFormat("%b %e",n.point.high)+"</span><br /><span>"+("firlas"===m?"Last":"First")+" occurrence: "+Highcharts.dateFormat("%b %e",n.point.low)+"</span><br /><span>Days between: "+s[e]+"</span>":t+="<br /><span>"+n.series.name+": "+Highcharts.dateFormat("%b %e",this.y)+"</span>"}),t}}),$.extend(h,disableControls()),$("#results_area").prepend('<div id="resizer"><div id="chart_area"></div></div>'),$("#chart_area").highcharts("StockChart",h,setupChartResizer),r&&(addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"high",lineLabel:r+"-year moving average",inLegend:!0,statFunction:movingAverage,removeNull:!1,color:"black",period:r}),addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"low",lineLabel:r+"-year moving average",inLegend:!1,statFunction:movingAverage,removeNull:!1,color:"black",period:r})),i&&(addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"high",lineLabel:"Regression line",inLegend:!0,statFunction:findLineByLeastSquares,removeNull:!0,color:"brown"}),addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"low",lineLabel:"Regression line",inLegend:!1,statFunction:findLineByLeastSquares,removeNull:!0,color:"brown"})),o&&(addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"high",lineLabel:"LOESS curve",inLegend:!0,statFunction:loess,removeNull:!0,color:"green"}),addTrendLine({chart:$("#chart_area").highcharts(),dataobj:"low",lineLabel:"LOESS curve",inLegend:!1,statFunction:loess,removeNull:!0,color:"green"}))}function flDateDisplay(e){return"M"===e?"-":e.substr(5)+" ("+e.substr(0,4)+")"}function fillRowVals(e,t,a){$(".tablesorter tbody tr:nth-child("+(t+1)+") td:nth-child("+a+")").text(flDateDisplay(e[0])),getDval()&&(a+=1,$(".tablesorter tbody tr:nth-child("+(t+1)+") td:nth-child("+a+")").text("M"===e[1]?"-":e[1])),getMcnt()&&(a+=1,$(".tablesorter tbody tr:nth-child("+(t+1)+") td:nth-child("+a+")").text(e[2]))}function displayFirstLast(e){var t,a,n,s,r,i,o,l,d,p,m,u=getOutputChoice()||["table"],c=getGroupResults(),h="01-01"===input_params.elems[0].season_start?"calyr":"season",g=c===h?"firlas":"lasfir",y=JSON.parse(JSON.stringify(e.smry)),_="calyr"===c?"Year":"Season",b=parseInt(input_params.elems[0].reduce.reduce.split("_")[2],10),f="mint"===input_params.elems[0].name&&b<=36&&"season"===h&&"calyr"===c,D={sortAppend:[[0,1]]},x="<br /><span class='subtitle'>Each "+($.inArray("csv",u)>=0?"group":"section")+" contains date and year of occurrence"+(getDval()?", value on that date":"")+(getMcnt()?" and number of missing values":"")+".</span><br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",v=(f?"Frost/Freeze":"First/Last")+" Summary for "+buildStationName(e.meta);e.data=trimListByMcnt(e.data,1,2),i=parseInt(e.data[0][0].substr(0,4),10),o=parseInt(e.data[e.data.length-1][0].substr(0,4),10),addDisplayTitle($.inArray("graph",u)<0?v:" ",x,"html"),-1===$.inArray("table",u)&&($(".tablesorter").hide(),$("#results_area").loadSpinner({message:"Processing data ..."})),t='<th class="sorter-text">'+_+"</th>",$.each("firlas"===g?["First","Last"]:["Last","First"],function(e,a){t+='<th class="nobr sorter-sortseadate empty-bottom">'+a+"</th>"+(getDval()?'<th class="nobr nobl sorter-digit string-bottom">Value</th>':"")+(getMcnt()?'<th class="nobl sorter-digit string-bottom">Missing</th>':"")}),$(".tablesorter thead").append("<tr>"+t+'<th class="sorter-digit string-bottom" title="Difference between '+("firlas"===g?"first and last":"last and first")+' dates exclusive of both">'+(f?"Season Length":"Difference")+"</th></tr>"),m=($(".tablesorter thead tr th").length-2)/2,l="firlas"===g?m+2:2,$.each(e.data,function(e,a){n="season"===c&&"season"===h?parseInt(a[0].substr(0,4),10)-1+"-"+a[0].substr(0,4):"season"===c&&"season"!==h?a[0].substr(0,4)+"-"+(parseInt(a[0].substr(0,4),10)+1):a[0].substr(0,4),addDisplayRow(t="<td>"+n+'</td><td class="nobr"></td>'+(getDval()?'<td class="nobr nobl"></td>':"")+(getMcnt()?'<td class="nobl"></td>':"")+'<td class="nobr"></td>'+(getDval()?'<td class="nobr nobl"></td>':"")+(getMcnt()?'<td class="nobl"></td>':"")+"<td></td>","html"),fillRowVals(a[1],e,l)}),input_params.elems[0].reduce.reduce=input_params.elems[0].reduce.reduce.replace("last","first"),input_params.sDate=i+(c!==h?1:0)+input_params.sDate.substr(4),input_params.eDate=o+(c!==h?1:0)+input_params.eDate.substr(4),postResults("/StnData",function(e){l="firlas"===g?2:m+2,$.each(e.data,function(e,t){fillRowVals(t[1],e,l),d=$(".tablesorter tbody tr:nth-child("+(e+1)+") td:nth-child(2)").text(),p=$(".tablesorter tbody tr:nth-child("+(e+1)+") td:nth-child("+(m+2)+")").text(),"-"!==d&&"-"!==p?(d=d.substr(7,4)+"-"+d.substr(0,5),p=p.substr(7,4)+"-"+p.substr(0,5),a=d!==p?dateDiff(d,p)-1:0):a="-",$(".tablesorter tbody tr:nth-child("+(e+1)+") td:nth-child("+(2*m+2)+")").text(a)}),r=columnCalcs(buildColumnArray(2*m+1)),s="firlas"===g?[e.smry[0],y[0]]:[y[0],e.smry[0]],t="<td>Minimum</td><td colspan="+m+">"+flDateDisplay(s[0][2])+"</td><td colspan="+m+">"+flDateDisplay(s[1][2])+"</td><td>"+r[2]+"</td>",$.inArray("datatable",u)<0&&addDisplayFoot(t,"html"),addDisplayFoot(t="<td>Mean</td><td colspan="+m+">"+s[0][1]+"</td><td colspan="+m+">"+s[1][1]+"</td><td>"+("M"!==r[0]?Math.round(r[0]):"M")+"</td>","html"),t="<td>Maximum</td><td colspan="+m+">"+flDateDisplay(s[0][0])+"</td><td colspan="+m+">"+flDateDisplay(s[1][0])+"</td><td>"+r[1]+"</td>",$.inArray("datatable",u)<0&&addDisplayFoot(t,"html"),$.inArray("table",u)>=0&&$(".tablesorter").tablesorter(D),$.inArray("datatable",u)>=0&&($(".tablesorter").show(),setupDataTable(".tablesorter",{title:v})),$.inArray("graph",u)>=0&&displayFirstLastGrf(e.meta),$.inArray("csv",u)>=0&&showTextTable()})}function addObsTimeTable(e,t,a,n){var s,r="",i="",o=!1;"html"===n&&$("#results_area").append('<table id="obsTimes" class="basictable"><thead></thead><tbody></tbody></table>'),a>=1982&&($.each(e,function(e,t){if(r=e+": ",t.length>0){for(s=0;s<t.length;s+=1)r+=(a=t[s],l=0!==s?", ":"",a>=1&&a<=11?l+a+"am":12===a?l+"12 noon":a>=13&&a<=23?l+(a-12)+"pm":24===a?l+"midnight":l+"unknown");t.length>1&&(o=!0)}else r+="-";var a,l;"html"===n?$("#obsTimes tbody").append("<tr><td>"+r+"</td></tr>"):i+="<br />"+r}),r.length&&(r="Observations for each day cover the 24 hours ending<br /> at the time given below (Local Standard Time)."+(o?"<br />Observation times may have changed during this period.":""),"html"===n?$("#obsTimes thead").append("<tr><th>"+r+"</th></tr>"):i=r+i)),t<1982&&(r="Reliable observation times are not available prior to 1982.","html"===n?$("#obsTimes tbody").append("<tr><td>"+r+"</td></tr>"):i+="<br />"+r),"csv"===n&&$("#results_area").append(i)}function displayMoncrtText(e){var t="<pre>"+buildStationName(e.meta)+"<br />Daily Data For a Month<br />"+Date.parse(e.data[0][0]).toString("MMMM yyyy")+"<br /><br />Day   MaxT   MinT   AvgT   Dprt    HDD    CDD   Pcpn   Snow   Dpth<br />";$.each(e.data,function(e,a){$.each(a,function(e,a){t+=0===e?a.charAt(8).replace("0"," ")+a.charAt(9)+" ":"  "+numberPad(a[0],5," ")}),t+="<br />"}),t+="</pre>",$("#results_area").append(t)}function process_smry(e,t,a){var n,s,r,i,o,l,d,p,m,u,c=getTempRounding(),h=["Sum","Average","Normal"];for(i=e.data[0][5],o=e.data[0][6],l=e.data[0][19],d=e.data[0][20],p=e.data[0][21],m=e.data[0][22],u=e.data[0][23],"0.00"===p&&(p="T"),"0.0"===m&&(m="T"),"0"===u&&(u="T"),$(".tablesorter tbody tr").each(function(t,a){$(a).children("td").each(function(t,a){if("M"!==$(a).text())switch(r=$(a).text(),t){case 1:r===l&&$(a).css({color:"red","font-weight":"600"});break;case 2:r===d&&$(a).css({color:"blue","font-weight":"600"});break;case 7:r===p&&$(a).css({color:"green","font-weight":"600"}),"0.00"===i&&"T"===r&&(e.data[0][5]="T");break;case 8:r===m&&$(a).css({color:"green","font-weight":"600"}),"0.0"===o&&"T"===r&&(e.data[0][6]="T");break;case 9:r===u&&$(a).css({color:"green","font-weight":"600"})}})}),e.data[0][7]=roundFix(e.data[0][7],1),e.data[0][8]=roundFix(e.data[0][8],1),e.data[0][11]=roundFix(e.data[0][11],1),"intermediate"===c?"M"!==e.data[0][7]&&"M"!==e.data[0][8]&&(e.data[0][9]=roundNum((roundNum(e.data[0][7],1)+roundNum(e.data[0][8],1))/2,1)):e.data[0][9]=roundFix(e.data[0][9],1),"M"!==e.data[0][14]&&(e.data[0][14]=roundStr(e.data[0][14],1)),"M"!==e.data[0][9]&&"M"!==e.data[0][10]?e.data[0][10]=roundStr(e.data[0][9]-roundNum(e.data[0][10],1),1):e.data[0][10]="M",$.each([[1,2,-1,-1,3,4,5,6,-1],[7,8,9,10,-1,-1,-1,-1,11],[12,13,14,-1,15,16,17,18,-1]],function(t,a){s="<th>"+h[t]+"</th>",$.each(a,function(t,a){s+='<td class="col'+(t+1)+'">'+(a>=0?e.data[0][a]:"-")+"</td>"}),$(".tablesorter tfoot").append("<tr>"+s+"</tr>")}),!a||"M"===e.data[0][14]&&"M"===e.data[0][15]&&"M"===e.data[0][16]&&"M"===e.data[0][17]&&"M"===e.data[0][18]||$(".tablesorter tfoot").append('<tr><td colspan="'+t.length+'"><i>Above Normals represent the month through '+input_params.date+".</i></td></tr>"),n=1;n<t.length;n+=1)0===t[n]&&$(".col"+n).hide()}function displayMoncrtSmry(e){var t=input_params.sid,a=input_params.eDate,n=input_params.sDate.substr(0,7),s=(new Date).toString("yyyy-MM"),r={sid:t,date:null,elems:[{name:"maxt",interval:"mly",duration:"mly",reduce:"sum"},{name:"mint",interval:"mly",duration:"mly",reduce:"sum"},{name:"hdd",interval:"mly",duration:"mly",reduce:"sum"},{name:"cdd",interval:"mly",duration:"mly",reduce:"sum"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"sum"},{name:"snow",interval:"mly",duration:"mly",reduce:"sum"},{name:"maxt",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"mint",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"snwd",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"maxt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"mint",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"hdd",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"cdd",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"snow",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"maxt",interval:"mly",duration:"mly",reduce:"max"},{name:"mint",interval:"mly",duration:"mly",reduce:"min"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"max"},{name:"snow",interval:"mly",duration:"mly",reduce:"max"},{name:"snwd",interval:"mly",duration:"mly",reduce:"max"}]};s===n?(input_params={sids:t,meta:"valid_daterange",elems:"43,4,10,11"},postResults("/StnMeta",function(t){var n=[];if(!t.meta.length)return $(document).reportError({errorText:"Requested data not available for selected station.",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1;$.each(t.meta[0].valid_daterange,function(e,t){t.length&&n.push(t[1])}),input_params=r,input_params.date=n.sort()[n.length-1],input_params.date!==a&&$.each(input_params.elems,function(e,t){t.duration="mtd",t.interval=[1,0,0]}),postResults("/StnData",function(t){process_smry(t,e,!0)})})):(input_params=r,input_params.date=a,postResults("/StnData",function(t){process_smry(t,e,!1)}))}function addMoncrtHeader(e,t){var a="";$.each(t,function(e,t){a+='<th class="sorter-'+("Date"===t?"isoDate":"sorttrace string-bottom")+" col"+e+'">'+t+"</th>"}),addDisplayHead(a,e)}function displayMoncrt(e){var t,a,n,s=0,r=[0,0,0,0,0,0,0,0,0,0],i=parseInt(input_params.eDate.substr(0,4),10),o=getOutputChoice()||"html",l="",d={},p=input_params.elems,m=column_headers(p,["Date"]),u="Climatological Data for "+buildStationName(e.meta)+" - "+Date.parse(input_params.sDate.substr(0,7)).toString("MMMM yyyy");if("intermediate"===getTempRounding())for(t=0;t<e.data.length;t+=1)"M"!==e.data[t][3][0]&&(n=parseFloat(e.data[t][3]),e.data[t][3][0]=Math.round(n+.001),"M"!==e.data[t][4][0]&&(e.data[t][4][0]=Math.round(n+.001)-Math.round(n-parseFloat(e.data[t][4][0])+.001)));if("html"===o||"csv"===o){for(addDisplayTitle(u,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",o),$(".tablesorter").hide(),addMoncrtHeader(o,m),$.each(e.data,function(e,t){l="",$.each(t,function(e,t){0===e?l+='<td class="col'+e+'" style="white-space:nowrap;">'+t+"</td>":(l+='<td class="col'+e+'">'+("-0"!==t[0]?t[0]:"0")+"</td>","M"!==t[0]&&(r[e]=1,$.inArray(e,[1,2,7,8,9])>=0&&(d[m[e]]||(d[m[e]]=[]),$.inArray(t[1],d[m[e]])<0&&d[m[e]].push(t[1]))))}),addDisplayRow(l,o)}),a=1;a<r.length;a+=1)s+=r[a],0===r[a]&&$(".col"+a).hide();s>0?($(".tablesorter").show(),"html"===o&&($(".tablesorter").tablesorter(),displayMoncrtSmry(r)),addObsTimeTable(d,i,i,o)):$(document).reportError({errorText:"No data for "+e.meta.name+" for "+Date.parse(input_params.sDate.substr(0,7)).toString("MMMM yyyy")})}else"text"===o&&displayMoncrtText(e)}function displayDlylist(e){var t,a,n=getOutputChoice()||"html",s="Data for "+buildStationName(e.meta),r="",i=input_params.elems,o=column_headers(i,["Date"]),l={};addDisplayTitle(s,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",n),$.each(o,function(e,t){r+='<th class="sorter-'+("Date"===t?"isoDate":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(r,n),$.each(e.data,function(e,t){r="",$.each(t,function(e,t){"object"==typeof t?(r+="<td>"+t[0]+"</td>","M"!==t[0]&&(l[o[e]]||(l[o[e]]=[]),$.inArray(t[1],l[o[e]])<0&&l[o[e]].push(t[1]))):r+="<td>"+t+"</td>"}),addDisplayRow(r,n)}),"html"===n&&$(".tablesorter").tablesorter(),t=parseInt(e.data[0][0].substr(0,4),10),a=parseInt(e.data[e.data.length-1][0].substr(0,4),10),addObsTimeTable(l,t,a,n)}function buildPeriodOfRecord(e,t,a){var n,s=[],r=[];for($.each([0,1,3,4,5],function(e,a){t[a].length&&(s.push(parseInt(t[a][0].substr(0,4),10)),r.push(parseInt(t[a][1].substr(0,4),10)))}),$(e).append("<option value='0'>Compare to another year</option>"),n=Array.max(r);n>=Array.min(s);n-=1)n!==a&&$(e).append("<option value="+n+">"+n+"</option>")}function showAlmanacTextTable(){var e,t="Period of Record:",a="",n=$(".basictable caption").html();$(".basictable td.recHi1").first().text().length>0&&$(".basictable td.recHi2").first().text().length>0&&$(".basictable td.recHi3").first().text().length>0&&$(".basictable td.recHi4").first().text().length>0&&$(".basictable td.recHi5").first().text().length>0&&$(".basictable td.recHi6").first().text().length>0&&$(".basictable td.recHi7").first().text().length>0&&$(".basictable td.recHi8").first().text().length>0?($(".loading").parent().loadSpinner("fadeOut"),e=$(".basictable tr").length,$(".basictable tr").each(function(t){t<e-1&&($(this).find("th,td").each(function(e){$(this).text().length&&("th"===$(this).attr("tag")&&0===e&&(a+="<br/>"),a+=0===e?endPad($(this).text(),30," "):numberPad($(this).text(),16," "))}),a+="<br/>")}),$("#porbox li").each(function(){t+="<br/>"+$(this).text()}),$("#results_area").empty().html("<pre>"+n+"<br/><br/>"+a+"<br/>"+t+"</pre>")):$("#results_area").loadSpinner({message:"Processing records, continuing ..."})}function almanacAddYr(e){input_params.date=e+input_params.date.substr(4),input_params.elems=[{name:"maxt"},{name:"mint"},{name:"avgt"},{name:"pcpn"},{name:"snow"},{name:"snwd"},{name:"hdd"},{name:"cdd"},{name:"cdd"},{name:"maxt",duration:"mtd",reduce:"mean"},{name:"mint",duration:"mtd",reduce:"mean"},{name:"avgt",duration:"mtd",reduce:"mean"},{name:"pcpn",duration:"mtd",reduce:"sum"},{name:"snow",duration:"mtd",reduce:"sum"},{name:"snwd",duration:"mtd",reduce:"max"},{name:"hdd",duration:"mtd",reduce:"sum"},{name:"cdd",duration:"mtd",reduce:"sum"},{name:"cdd",duration:"mtd",reduce:"sum"},{name:"maxt",duration:"ytd",reduce:"mean"},{name:"mint",duration:"ytd",reduce:"mean"},{name:"avgt",duration:"ytd",reduce:"mean"},{name:"pcpn",duration:"ytd",reduce:"sum"},{name:"snow",duration:"std",reduce:"sum",season_start:"07-01"},{name:"snwd",duration:"std",reduce:"max",season_start:"07-01"},{name:"hdd",duration:"std",reduce:"sum",season_start:"07-01"},{name:"cdd",duration:"ytd",reduce:"sum"}],getMaxmissingAlmanac({MT:[9,10,11],MP:[12,13,14],MD:[15,16,17],AT:[18,19,20],AP:[21,22,23],AD:[24,25]}),$("#addYrCol option:first-child").prop("selected","selected").text("Processing ..."),postResults("/StnData",function(t){if(!t)return $(document).reportError({errorText:"No results returned for "+e}),!1;$(".aotherYr").removeClass("ui-helper-hidden"),$.each($(".basictable tbody tr").find("td.aotherYr, th.aotherYr"),function(a){12!==a&&21!==a||(t.data[0][a]=roundFix(t.data[0][a],1)),$(this).text(a%9==0?e:t.data[0][a])}),$("#addYrCol option:first-child").text("Compare to different year")})}function almanacAddNormals(e){input_params.elems=[{name:"maxt",duration:"dly",normal:"91",prec:1},{name:"mint",duration:"dly",normal:"91",prec:1},{name:"avgt",duration:"dly",normal:"91"},{name:"pcpn",duration:"dly",normal:"91"},{name:"snow",duration:"dly",normal:"91"},{name:"hdd",duration:"dly",normal:"91"},{name:"cdd",duration:"dly",normal:"91"},{name:"maxt",duration:"mtd",reduce:"mean",normal:"91"},{name:"mint",duration:"mtd",reduce:"mean",normal:"91"},{name:"avgt",duration:"mtd",reduce:"mean",normal:"91",prec:1},{name:"pcpn",duration:"mtd",reduce:"sum",normal:"91"},{name:"snow",duration:"mtd",reduce:"sum",normal:"91"},{name:"hdd",duration:"mtd",reduce:"sum",normal:"91"},{name:"cdd",duration:"mtd",reduce:"sum",normal:"91"},{name:"maxt",duration:"ytd",reduce:"mean",normal:"91"},{name:"mint",duration:"ytd",reduce:"mean",normal:"91"},{name:"avgt",duration:"ytd",reduce:"mean",normal:"91",prec:1},{name:"pcpn",duration:"ytd",reduce:"sum",normal:"91"},{name:"snow",duration:"std",reduce:"sum",season_start:"07-01",normal:"91"},{name:"hdd",duration:"std",reduce:"sum",season_start:"07-01",normal:"91"},{name:"cdd",duration:"ytd",reduce:"sum",normal:"91"}],input_params.meta=[],postResults("/StnData",function(t){t.data&&($(".normCol").removeClass("ui-helper-hidden"),$(".normColx").removeClass("ui-helper-hidden"),$.each($(".basictable tr td.normCol"),function(e){9===e||16===e?t.data[0][e+1]=roundFix(t.data[0][e+1],1):0!==e&&1!==e||(t.data[0][e+1]=roundFix(t.data[0][e+1],0)),$(this).text(t.data[0][e+1])})),"text"===e&&0===$(".loading").length&&$("#results_area").loadSpinner({message:"Normals processed, continuing ..."})},!0)}function fillRecords(e,t){e=(e/3+1).toString(),postResults("/StnData",function(a){if(!a)return $(document).reportError({errorText:"No record values returned",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1;$.each($(".basictable tr td.recHi"+e),function(t){t<a.smry.length&&("M"!==a.smry[t][0][0]?(t>0&&e>="1"&&e<="3"&&(a.smry[t][0][0]=roundFix(a.smry[t][0][0],1)),$(this).text(a.smry[t][0][0]+" in "+a.smry[t][0][1].substr(0,4))):$(this).text("M"))}),$.each($(".basictable tr td.recLo"+e),function(t){t<a.smry.length&&("M"!==a.smry[t][1][0]?(t>0&&e>="1"&&e<="3"&&(a.smry[t][1][0]=roundFix(a.smry[t][1][0],1)),$(this).text(a.smry[t][1][0]+" in "+a.smry[t][1][1].substr(0,4))):$(this).text("M"))}),"text"===t&&showAlmanacTextTable()},!0)}function almanacAddRecords(e,t){var a,n,s,r,i=input_params.date,o=[{name:"maxt"},{name:"maxt",duration:"mtd",reduce:"mean",prec:3},{name:"maxt",duration:"ytd",reduce:"mean",prec:3},{name:"mint"},{name:"mint",duration:"mtd",reduce:"mean",prec:3},{name:"mint",duration:"ytd",reduce:"mean",prec:3},{name:"avgt"},{name:"avgt",duration:"mtd",reduce:"mean",prec:3},{name:"avgt",duration:"ytd",reduce:"mean",prec:3},{name:"pcpn"},{name:"pcpn",duration:"mtd",reduce:"sum"},{name:"pcpn",duration:"ytd",reduce:"sum"},{name:"snow"},{name:"snow",duration:"mtd",reduce:"sum"},{name:"snow",duration:"std",reduce:"sum",season_start:"07-01"},{name:"snwd"},{name:"snwd",duration:"mtd",reduce:"max"},{name:"snwd",duration:"std",reduce:"max",season_start:"07-01"},{name:"hdd"},{name:"hdd",duration:"mtd",reduce:"sum"},{name:"hdd",duration:"std",reduce:"sum",season_start:"07-01"},{name:"cdd"},{name:"cdd",duration:"mtd",reduce:"sum"},{name:"cdd",duration:"ytd",reduce:"sum"}],l=function(e){return!(e%4||!(e%100)&&e%400)};for(input_params.meta=[],delete input_params.date,$.each(o,function(e,t){l(parseInt(i.substr(0,4),10))&&"02-29"===i.substr(5)?$.extend(t,{interval:[4,0,0],smry:[{reduce:"max",add:"date"},{reduce:"min",add:"date"}],smry_only:1}):$.extend(t,{interval:[1,0,0],smry:[{reduce:"max",add:"date"},{reduce:"min",add:"date"}],smry_only:1})}),getMaxmissingAlmanac({MT:[1,4,7],MP:[10,13,16],MD:[19,22],AT:[2,5,8],AP:[11,14,17],AD:[20,23]},o),$.each($(".basictable tbody tr"),function(e){e<27&&e%9!=0&&$(this).append("<td class='recHi"+e%9+"'><div class='loading2'><span></span></div></td><td class='recLo"+e%9+"'><div class='loading2'><span></span></div></td>")}),a=0;a<24;a+=3)if((n=e[a/3]).length){if(input_params.elems=o.slice(a,a+3),"02-28"===i.substr(5)){for(s=parseInt(n[0].substr(0,4),10);!l(s);)s-=1;input_params.sDate=s+i.substr(4),input_params.eDate=n[1].substr(0,4)+i.substr(4)}else if("02-29"===i.substr(5)){for(s=parseInt(n[0].substr(0,4),10);!l(s);)s-=1;for(r=parseInt(n[1].substr(0,4),10);!l(r);)r+=1;input_params.sDate=s+i.substr(4),input_params.eDate=r+i.substr(4)}else input_params.sDate=n[0].substr(0,4)+i.substr(4),input_params.eDate=n[1].substr(0,4)+i.substr(4);fillRecords(a,t)}else $.each($(".basictable tr td.recHi"+(a/3+1).toString()+",td.recLo"+(a/3+1).toString()),function(){$(this).text("-")}),"text"===t&&showAlmanacTextTable();input_params.date=i,delete input_params.sDate,delete input_params.eDate}function displayAlmanac(e){var t="Almanac for "+buildStationName(e.meta)+"<br/>"+Date.parse(e.data[0][0]).toString("MMMM d, yyyy"),a=getOutputChoice()||"html",n=e.meta.valid_daterange,s=input_params.elems,r=parseInt(input_params.date.substr(0,4),10);$("#results_area").append('<table class="basictable"><caption>'+t+'</caption><thead></thead><tbody><tr><th>Daily Data</th><th>Observed</th><th class="aotherYr">----</th><th class="normCol">Normal</th><th>Record Highest</th><th>Record Lowest</th></tr><tr><td>Max Temperature</td><td align="center">'+e.data[0][1]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Min Temperature</td><td align="center">'+e.data[0][2]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Avg Temperature</td><td align="center">'+e.data[0][3]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Precipitation  </td><td align="center">'+e.data[0][4]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Snowfall       </td><td align="center">'+e.data[0][5]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Snow Depth     </td><td align="center">'+e.data[0][6]+'</td><td class="aotherYr"></td><td class="normColx">-</td></tr><tr><td>HDD (base 65)  </td><td align="center">'+e.data[0][7]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>CDD (base 65)  </td><td align="center">'+e.data[0][8]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><th>Month-to-Date Summary</th><th>Observed</th> <th class="aotherYr">----</th><th class="normCol">Normal</th><th>Record Highest</th><th>Record Lowest</th></tr><tr><td>Avg Max Temperature</td> <td align="center">'+roundFix(e.data[0][9],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></td></tr><tr><td>Avg Min Temperature</td> <td align="center">'+roundFix(e.data[0][10],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Avg Temperature    </td> <td align="center">'+roundFix(e.data[0][11],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total Precipitation</td> <td align="center">'+e.data[0][12]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total Snowfall     </td> <td align="center">'+e.data[0][13]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Max Snow Depth     </td> <td align="center">'+e.data[0][14]+'</td><td class="aotherYr"></td><td class="normColx">-</td></tr><tr><td>Total HDD (base 65)</td> <td align="center">'+e.data[0][15]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total CDD (base 65)</td> <td align="center">'+e.data[0][16]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><th>Year-to-Date Summary</th><th>Observed</th> <th class="aotherYr">----</th><th class="normCol">Normal</th><th>Record Highest</th><th>Record Lowest</th></tr><tr><td>Avg Max Temperature          </td> <td align="center">'+roundFix(e.data[0][17],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Avg Min Temperature          </td> <td align="center">'+roundFix(e.data[0][18],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Avg Temperature              </td> <td align="center">'+roundFix(e.data[0][19],1)+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total Precipitation          </td> <td align="center">'+e.data[0][20]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total Snowfall (since July 1)</td> <td align="center">'+e.data[0][21]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Max Snow Depth (since July 1)</td> <td align="center">'+e.data[0][22]+'</td><td class="aotherYr"></td><td class="normColx">-</td></tr><tr><td>Total HDD (since July 1)     </td> <td align="center">'+e.data[0][23]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr><tr><td>Total CDD (since Jan 1)      </td> <td align="center">'+e.data[0][24]+'</td><td class="aotherYr"></td><td class="normCol"></td></tr></tbody><tfoot><tr><td colspan=2 style="border-width: 0; text-align: left; vertical-align: top;"><select id="addYrCol" class="ui-widget-content ui-corner-all ui-state-default"></select></td><td colspan=4 style="border-width:0;padding-left:0;padding-right:0;"><div id="porbox"><b>Period of Record:</b><ul></ul></div></td></tr></tfoot></table>'),$(".aotherYr, .normCol, .normColx").addClass("ui-helper-hidden"),"datatable"===a&&($(".basictable thead").html("<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>").hide(),$(".basictable").css("margin","0"),$(document).ajaxStop(function(){$(this).unbind("ajaxStop"),setupDataTable(".basictable",{destroy:!0,title:t,nofooter:!0,noheader:!0}),$(".basictable.cell-border tbody tr:first-child th").css("border-top","1px solid #ddd")})),almanacAddRecords(n,a),almanacAddNormals(a),$.each([0,1,3,4,5],function(e,t){n[t].length&&$("#porbox ul").append("<li>"+column_headers([s[t]])+": "+n[t][0]+" to "+n[t][1]+"</li>")}),"html"===a||"datatable"===a?("datatable"===a&&(setupDataTable(".basictable",{clearButtons:!0}),$(".basictable.cell-border tbody tr:first-child th").css("border-top","1px solid #ddd")),buildPeriodOfRecord("#addYrCol",n,r),$("#addYrCol").on("change",function(){"datatable"===a&&$(document).ajaxStop(function(){setupDataTable(".basictable",{title:t,destroy:!0,nofooter:!0,noheader:!0}),$(".basictable.cell-border tbody tr:first-child th").css("border-top","1px solid #ddd")}),almanacAddYr($(this).val())})):($(".basictable").hide(),$("#results_area").append("<br />").loadSpinner({message:"Processing observed data ..."}))}function addOneDaySmryTable(e,t){var a;addDisplayTitle("Summary","",t,"basictable"),$(".basictable caption").css("font-size","1.2em"),$.each([{name:"Maximum Temperature",mdp:1,threshs:[">=100&deg; F",">=90&deg; F",">=50&deg; F","<=32&deg; F"]},{name:"Minimum Temperature",mdp:1,threshs:[">=70&deg; F",">=50&deg; F","<=32&deg; F","<=0&deg; F"]},{name:"Precipitation",mdp:2,threshs:[">=0.01 inch",">=0.10 inch",">=0.50 inch",">=1.00 inch"]},{name:"Snowfall",mdp:1,threshs:[">=0.1 inch",">=1.0 inch",">=3.0 inches",">=6.0 inches"]},{name:"Snow Depth",mdp:1,threshs:[">=1 inch",">=3 inches",">=6 inches",">=12 inches"]}],function(n,s){a="<th colspan=7>"+s.name+"</th></tr><tr><td rowspan=2>Maximum</td><td rowspan=2>Average</td><td rowspan=2>Minimum</td><td colspan=4>Percent of Years</td></tr> <tr>",$.each(s.threshs,function(e,t){a+="<td>"+t+"</td>"}),addDisplayRow(a,t,"basictable"),a="",$.each(e[n],function(e,t){a+="<td>"+(1!==e?t:roundFix(t,s.mdp))+(e>=3&&"0"!==t&&"M"!==t?"%":"")+"</td>"}),addDisplayRow(a,t,"basictable")})}function displayOneDay(e){var t=getOutputChoice()||"html",a="",n=input_params.elems,s="Data for "+new Date.parse(input_params.sDate).toString("MMMM d")+" - "+buildStationName(e.meta);if(e.data=trimResults(e.data),0===e.data.length)return $(document).reportError({errorText:"No data available for selection",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1;addDisplayTitle(s,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",t),$.each(column_headers(n,["Date"]),function(e,t){a+='<th class="sorter-'+("Date"===t?"isoDate":"sorttrace string-bottom")+'">'+t.replace("Highest ","")+"</th>"}),addDisplayHead(a,t),$.each(e.data,function(e,n){a="",$.each(n,function(e,t){a+="<td>"+t+"</td>"}),addDisplayRow(a,t)}),addOneDaySmryTable(e.smry,t),"html"===t&&$(".tablesorter").tablesorter({sortAppend:[[0,1]]})}function calcRowMean(e,t){var a=0,n=0,s=0;return $.each(e,function(e,r){"M"!==r[0]&&(a+="T"!==r[0]?roundNum(r[0],t):0,n+=1),"M"!==r[1]&&(s+=parseFloat(r[1]))}),[0===n||input_params.elems[0].maxmissing&&s>parseInt(input_params.elems[0].maxmissing,10)?"M":a/n,s]}function getDateForTitle(){var e,t,a,n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return"std"!==input_params.elems[0].duration&&"mly"!==input_params.elems[0].interval?(e=parseInt(input_params.sDate.substr(5,2),10),1===input_params.elems[0].duration?a=" - Month of "+n[e-1]:((t=e-input_params.elems[0].duration+1)<=0&&(t+=12),a=" - "+n[t-1]+" through "+n[e-1])):a="",a}function displaySeatsHtml(e,t){var a,n,s,r,i,o=["Rank"],l="months"===getSeasonCalcs(),d=getDecPlaces(),p=$.inArray("table",t)>=0?"html":"csv",m=input_params.elems,u=getDateForTitle();addDisplayTitle($.inArray("graph",t)<0?"Time Series Summary for "+buildStationName(e.meta)+u:" ","<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",p),"tall"===$("input[name=seasonChoices]:checked").val()?o.push("Year-Month"):"tother"===$("input[name=seasonChoices]:checked").val()?o.push("Ending Date"):l&&input_params.elems[0].groupby[1]>input_params.elems[0].groupby[2]||input_params.elems[0].duration>parseInt(input_params.eDate.substr(5,2),10)?o.push("Season"):o.push("Year"),o=column_headers(m,o),a="",$.each(o,function(e,t){a+="Rank"===t?'<th class="rankCol">'+t+"</th>":'<th class="sorter-'+(1===e?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(a+='<th class="sorter-digit">Missing Count</th>',p),$.each(e.data,function(e,t){n="Year-Month"===o[1]||"Ending Date"===o[1]?t[0]:"Season"===o[1]?parseInt(t[0].substr(0,4),10)-1+"-"+t[0].substr(0,4):t[0].substr(0,4),a='<td class="rankCol">-</td><td>'+n+"</td>",l&&(t[1]=calcRowMean(t[1],d)),$.each(t[1],function(e,t){0===e&&(t=roundFix(t,d)),a+="<td>"+t+"</td>"}),addDisplayRow(a,p)}),"html"===p&&($(".rankCol").hide(),$(".tablesorter").tablesorter({sortAppend:[[1,1]]}).on("sortEnd",function(){s="M",i=0,$.each($(".rankCol").filter("td"),function(e){r=$(this).next().next().html(),i+="M"===r,$(this).html("M"===r?"":r===s?"-":e+1-i),s=r})}),$(".tablesorter-header").on("click",function(e){$.inArray(e.target.innerHTML,["Year","Year-Month","Season","Ending Date","Missing Count"])>-1?$(".rankCol").hide():$(".rankCol").show()}))}function displaySeatsGrf(e){var t,a,n=[],s="months"===getSeasonCalcs(),r=getDecPlaces(),i=getDateForTitle(),o=parseInt(e.data[e.data.length-1][0].substr(0,4),10)-parseInt(e.data[0][0].substr(0,4),10)+1,l=getGrfType(),d="mly"===input_params.elems[0].interval&&!input_params.elems[0].hasOwnProperty("groupby"),p=!d&&getMovavgLine(),m=!d&&getRegressLine(),u=!d&&getLoessLine(),c={maxt:{axis:"Temperature (degrees F)"},mint:{axis:"Temperature (degrees F)"},avgt:{axis:"Temperature (degrees F)"},pcpn:{axis:"Precipitation (inches)",minval:!0},snow:{axis:"Snowfall (inches)",minval:!0},snwd:{axis:"Snow Depth (inches)",minval:!0},hdd:{axis:"Degree Days (base 65)",minval:!0},cdd:{axis:"Degree Days (base 65)",minval:!0},gdd:{axis:"Degree Days (base 50)",minval:!0}},h={dataobj:"y",inLegend:!1},g=input_params.elems,y="mly"!==g[0].interval?"%Y":"%Y-%m",_=column_headers(g),b=_[0].search("of Days"),f=defineGraphOptions();if($.each(e.data,function(e,i){t=d?ymdToUTC(i[0]):ymdToUTC(i[0].substr(0,4)),"M"===(a=s?calcRowMean(i[1],r)[0]:i[1][0])?n.push([t,null]):"S"!==a&&(a="T"===a?0:roundNum(a,r),n.push([t,a]))}),!(n.length>0))return $(document).reportError({errorText:"No data available for selection",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),!1;f.series.push({name:_[0],data:n,color:"blue",type:l,marker:{enabled:!0},turboThreshold:n.length+1,lineWidth:p?1:2}),f.title.text=_[0]+i+" - "+buildStationName(e.meta),f.subtitle.text="Use navigation tools above and below chart to change displayed range",f.legend.enabled=!1,f.yAxis.title.text=-1===b?c[g[0].name].axis:_[0].substr(0,b+7),(b>-1||c[g[0].name].minval)&&(f.yAxis.floor=0),$.extend(f.xAxis,{minRange:31536e6,dateTimeLabelFormats:{hour:y,day:y,week:y,month:y}}),d||(f.xAxis.tickInterval=31536e6),$.extend(f.rangeSelector,{buttons:addRangeButtons(o),inputDateFormat:y,inputEditDateFormat:y,buttonTheme:$.extend(f.rangeSelector.buttonTheme,{width:50})}),f.rangeSelector.selected=f.rangeSelector.buttons.length-1,f.tooltip.formatter=function(){var e="<b>"+Highcharts.dateFormat(y,this.x)+"</b>";return $.each(this.points,function(t,a){e+='<br/><span style="color:'+a.series.color+';">'+a.series.name+": "+Highcharts.numberFormat(this.y,r)+"</span>"}),e},setupChartArea(),$("#chart_area").highcharts("StockChart",f,setupChartResizer),h.chart=$("#chart_area").highcharts(),p&&addTrendLine($.extend(h,{lineLabel:p+"-year moving average",statFunction:movingAverage,removeNull:!1,color:"black",period:p})),m&&addTrendLine($.extend(h,{lineLabel:"Regression line",statFunction:findLineByLeastSquares,removeNull:!0,color:"brown"})),u&&addTrendLine($.extend(h,{lineLabel:"LOESS curve",statFunction:loess,removeNull:!0,color:"green"}))}function displaySeats(e){var t=getOutputChoice()||["graph","table"];e.data=trimListResults(e.data,1),e.data.length>0?($.inArray("graph",t)>=0&&displaySeatsGrf(e),($.inArray("table",t)>=0||$.inArray("csv",t)>=0)&&displaySeatsHtml(e,t)):$(document).reportError({errorText:"No data available for selection",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))})}function plotTempChart(e,t,a,n){var s=getPlotLine32();$.extend(e.title,{text:"Daily Temperature Data - "+buildStationName(t)}),$.extend(e.subtitle,{text:"Period of Record - "+(JSON.stringify(t.valid_daterange[0])!==JSON.stringify(t.valid_daterange[1])?"Max temperature: "+t.valid_daterange[0][0]+" to "+t.valid_daterange[0][1]+"; Min temperature: ":"")+t.valid_daterange[1][0]+" to "+t.valid_daterange[1][1]+".  Normals period: 1991-2020.  Click and drag to zoom chart."}),s&&$.extend(e.yAxis[0],{plotLines:[{value:32,color:"blue",dashStyle:"shortdash",width:1,zIndex:1}]}),$.extend(e.yAxis[0].title,{text:"Temperature (F)"}),$.extend(e.yAxis[1].labels,{formatter:function(){return Math.round((this.value-32)/1.8*10)/10}}),$.extend(e.xAxis.dateTimeLabelFormats,{month:"%b %e"}),$.extend(e.tooltip,{shared:!0,formatter:function(){var e="<b>"+Highcharts.dateFormat("%A, %B %e, %Y",this.x)+"</b>",t=Highcharts.dateFormat("%m-%d",this.x);return $.each(this.points,function(s,r){r.series.tooltipOptions.pointFormat.length&&(e+='<br /><span style="color:'+r.series.color+';">'+r.series.name+": "+roundStr(r.point.y,0)+"F"+(r.point.high||r.point.low?" to "+roundStr(r.point.high,0)+"F":" in "+("Record Max"===r.series.name?a[t][1]:n[t][1]))+"</span>")}),e}}),$.extend(e,disableControls()),1===e.series[0].data.length&&($.extend(e.plotOptions.columnrange,{grouping:!1}),$.extend(e.series[0],{pointPadding:.25})),setupChartArea(),$("#chart_area").highcharts("StockChart",e,setupChartResizer)}function addExtsToChart(e){var t=input_params.sDate.substr(5),a=input_params.eDate.substr(5),n=(new Date).getFullYear(),s="1840-"+t,r=n+"-"+a;if("02-29"===t&&(t="02-28"),"02-29"===a){for(;!Date.isLeapYear(n);)n+=1;r=n+"-"+a}input_params=$.extend({},input_params,{sDate:s,eDate:r,meta:["name","state","valid_daterange","sids"],elems:[{name:"maxt",interval:"dly",duration:"dly",smry:{reduce:"max",add:"date"},smry_only:1,groupby:["year",t,a]},{name:"mint",interval:"dly",duration:"dly",smry:{reduce:"min",add:"date"},smry_only:1,groupby:["year",t,a]}]}),postResults("/StnData",function(t){var a,n,s,r,i={},o={},l=[[],[],[],[]];for(a=0;a<t.smry[0].length;a+=1)i[t.smry[0][a][1].substr(5,5)]=[t.smry[0][a][0],t.smry[0][a][1].substr(0,4)],o[t.smry[1][a][1].substr(5,5)]=[t.smry[1][a][0],t.smry[1][a][1].substr(0,4)];$.each(e.series[1].data,function(e,t){n=t[0],r=new Date(n),s=numberPad(r.getUTCMonth()+1,2)+"-"+numberPad(r.getUTCDate(),2),i[s][0]&&"M"!==i[s][0]?(l[0].push([n,parseInt(i[s][0],10)]),l[2].push([n,t[2],parseInt(i[s][0],10)])):l[0].push([n,null]),o[s]&&"M"!==o[s]?(l[1].push([n,parseInt(o[s],10)]),l[3].push([n,t[1],parseInt(o[s],10)])):l[1].push([n,null])}),e.series.push({name:"Record Max",data:l[0],color:"red",type:"line",showInLegend:!0,lineWidth:1},{name:"Record Min",data:l[1],color:"#0099FF",type:"line",showInLegend:!0,lineWidth:1},{data:l[2],tooltip:{pointFormat:""},color:"#FA8072",lineColor:"red",type:l[2].length>1?"arearange":"columnrange",showInLegend:!1,turboThreshold:l[2].length+1},{data:l[3],tooltip:{pointFormat:""},color:"#CCFFFF",lineColor:"#0099FF",type:l[3].length>1?"arearange":"columnrange",showInLegend:!1,turboThreshold:l[3].length+1}),plotTempChart(e,t.meta,i,o)})}function displayTempGrf(e){var t,a,n=e.data[0][0].substr(0,4),s=e.data[e.data.length-1][0].substr(0,4),r="("+n+(n!==s?"-"+s:"")+")",i=[[],[]],o=defineGraphOptions({yaxisCnt:2});$.each(e.data,function(e,n){for(t=ymdToUTC(n[0]),a=1;a<n.length;a+=2)"M"!==n[a]&&"M"!==n[a+1]?i[(a-1)/2].push([t,parseFloat(n[a+1]),parseFloat(n[a])]):i[(a-1)/2].push([t,null,null])}),o.series.push({data:i[0],color:"blue",name:"Observed temperature range "+r,type:"columnrange",zIndex:2,lineWidth:1,turboThreshold:i[0].length+1},{data:i[1],color:"#B8860B",name:"Normal temperature range",type:i[1].length>1?"arearange":"columnrange",zIndex:1,lineWidth:1,turboThreshold:i[1].length+1}),addExtsToChart(o)}function removeLineFromChart(e){var t,a=$("#chart_area").highcharts(),n=a.series;for(t=0;t<n.length;t+=1)if(n[t].name===e||n[t].name==="Highest ("+e+")"||n[t].name==="Lowest ("+e+")"){a.series[t].remove();break}}function addLineToChart(e,t,a,n,s,r){input_params.sDate=e.substr(0,4)+"-"+a,input_params.eDate=(e.search("-")<0?e:parseInt(e.substr(0,4),10)+1)+"-"+n,input_params.elems=[{interval:"dly",duration:"dly",name:input_params.elems[0].name}],$("#results_area").loadSpinner(),postResults("/StnData",function(a){var n,i=$("#chart_area").highcharts(),o=0,l=[],d=t-e.substr(0,4);$.each(a.data,function(e,t){$.each(t,function(e,t){0===e?n=ymdToUTC(parseInt(t.substr(0,4),10)+d+t.substr(4)):("T"===t&&(t="0.0"),"M"===t||"S"===t?l.push({x:n,y:o,marker:{enabled:!0,fillColor:"M"===t?"black":"green"}}):(t=t.replace("A",""),o+=parseFloat(t),l.push([n,o])))})}),i.addSeries({name:r?r+" ("+e+")":e,data:l,color:s,turboThreshold:l.length+1})})}function displayAccumTable(e,t,a,n,s,r,i,o){var l,d,p,m,u,c,h=e.length%8==0?8:9,g=Math.ceil(e.length/h),y=function(){var t,s="<tbody>";for(l=0;l<g;l+=1){for(s+="<tr>",d=l;d<h*g;d+=g)p=d>=e.length?"accumTableUnselected":$.inArray(e[d][1],o)>=0?"accumTableSelected":"accumTableUnselected",m=d<e.length?-999===e[d][0]?e[d][1]+": -"+(e[d][2]>0?" ("+e[d][2]+")":""):e[d][1]+": "+e[d][0].toFixed(a)+(e[d][2]>0?" ("+e[d][2]+")":""):"&nbsp;",s+="<td class="+p+">"+m+"</td>";s+="</tr>"}s+="</tbody>",$("#accumTable").append(s),$("#accumTable tbody tr").on("click","td",function(){c=$(this).hasClass("accumTableSelected"),t=$(this).text().split(": "),$(this).toggleClass("accumTableUnselected accumTableSelected"),c?(removeLineFromChart(t[0]),u=o.indexOf(t[0]),o.splice(u,1)):(addLineToChart(t[0],n,r,i),o.push(t[0]))})};$(t).append('<table id="accumTable"><thead><tr><th colspan="3" style="text-align: left">Click to Plot/Remove Years of Interest</th><th colspan="3" style="text-align: center">(number of missing days in parentheses)</th><th colspan="'+(h-6)+'" style="text-align: right"><button id="resortTable" class="smallerButton">Resort table by year</button></th></tr></thead></table>'),o.push(s),y(),$("#resortTable").button().click(function(){$("#accumTable tbody").remove(),$("#resortTable .ui-button-text").text().indexOf("year")>=0?(e.sort(arrSort(1)),$("#resortTable").button({label:"Resort table by value"})):(e.sort(arrSort(0)),$("#resortTable").button({label:"Resort table by year"})),y()})}function moreLines(e,t,a){var n,s,r=[],i=input_params.sDate.substr(5,5),o=input_params.eDate.substr(5,5),l=i.split("-"),d=o.split("-"),p=l[0]>d[0]||l[0]===d[0]&&l[1]>d[1],m=p?parseInt(input_params.eDate.substr(0,4),10)-1+"-"+input_params.eDate.substr(2,2):input_params.eDate.substr(0,4),u=getOtherLines();if(u.length>0){if($("#results_area").append("<br />").loadSpinner({message:"Processing other years ..."}),input_params.meta=[],input_params.sDate=a[0].substr(0,5)+o,input_params.eDate=a[1].substr(0,5)+o,input_params.elems=[{interval:[1,0,0],duration:"std",reduce:{reduce:"sum",add:"mcnt"},season_start:i,name:input_params.elems[0].name}],!getMaxmissing())return!1;postResults("/StnData",function(a){var l,d=[];if($.each(a.data,function(e,t){"M"===t[1][0]&&(t[1][0]=-999),l=p?parseInt(t[0].substr(0,4),10)-1+"-"+t[0].substr(2,2):t[0].substr(0,4),d.push(["T"!==t[1][0]&&"S"!==t[1][0]?parseFloat(t[1][0]):0,l,parseInt(t[1][1],10)])}),$.inArray("hiYr",u)>-1){for(s=[-999,9999],n=1;n<=d.length;n+=1)-999!==d[d.length-n][0]&&d[d.length-n][0]>s[0]&&(s[0]=d[d.length-n][0],s[1]=d[d.length-n][1]);-999!==s[0]&&(r.push(s[1]),addLineToChart(s[1],t,i,o,"blue","Highest"))}if($.inArray("loYr",u)>-1){for(s=[9999,9999],n=1;n<=d.length;n+=1)-999!==d[d.length-n][0]&&d[d.length-n][0]<s[0]&&(s[0]=d[d.length-n][0],s[1]=d[d.length-n][1]);9999!==s[0]&&(r.push(s[1]),addLineToChart(s[1],t,i,o,"red","Lowest"))}$.inArray("pickYr",u)>-1&&(d.sort(arrSort(0)),displayAccumTable(d,"#results_area",e,t,m,i,o,r))})}}function displayAccumGrf(e){var t,a,n,s=999,r=[[],[],[]],i=[0,0],o={},l={pcpn:{title:"Accumulated Precipitation",axis:"Precipitation (inches)",dec_places:2},snow:{title:"Accumulated Snowfall",axis:"Snowfall (inches)",dec_places:1},hdd:{title:"Accumulated Heating Degree Days",axis:"Degree Days (base 65)",dec_places:0},cdd:{title:"Accumulated Cooling Degree Days",axis:"Degree Days (base 65)",dec_places:0},gdd:{title:"Accumulated Growing Degree Days",axis:"Degree Days (base 50)",dec_places:0}},d=input_params.elems,p=getResetAccum(),m=defineGraphOptions(),u=input_params.sDate.split("-"),c=parseInt(u[1],10),h=input_params.eDate.split("-"),g=parseInt(h[1],10),y=e.data.length>366?"":input_params.sDate.substr(0,4)+(c>g?"-"+input_params.eDate.substr(2,2):""),_=c>g&&g>=2?2011:2012,b=_-input_params.sDate.substr(0,4);for(a=0;a<d.length;a+=1)if(d[a].normal&&"91"===d[a].normal){s=a+1;break}for($.each(e.data,function(a,n){$.each(n,function(n,l){0===n?(e.data.length<=366&&(l=parseInt(l.substr(0,4),10)+b+l.substr(4)),t=ymdToUTC(l)):n===s&&"M"===l||(e.data.length<=366||!p?(1===n&&(o[t]=l.replace("T","trace").replace("M","missing").replace("S","subsequent").replace("A"," (multi-day)")),"M"===l||"S"===l?r[n-1].push({x:t,y:i[n-1],marker:{enabled:!0,fillColor:"M"===l?"black":"green"}}):(l=l.replace("A","").replace("T","0.0"),i[n-1]+=parseFloat(l),r[n-1].push([t,i[n-1]]))):2!==n?("T"===l&&(l="0.0"),1!==n||"M"!==e.data[a][2]&&"S"!==e.data[a][2]?r[n-1].push([t,"M"!==l?parseFloat(l):0]):r[n-1].push({x:t,y:"M"!==l?parseFloat(l):0,marker:{enabled:!0,fillColor:"M"===l?"black":"green"}})):o[t]=l.replace("T","trace").replace("M","missing").replace("S","subsequent").replace("A"," (multi-day)"))})}),a=0;a<d.length;a+=1)r[a].length>0&&m.series.push({name:d[a].normal&&"91"===d[a].normal?"Normal":y?y+" accumulation":"Accumulation",data:r[a],color:d[a].normal&&"91"===d[a].normal?"#8A4117":"#41A317",type:d[a].normal&&"91"===d[a].normal?"line":"area",turboThreshold:r[a].length+1});$.extend(m.title,{text:l[d[0].name].title+" - "+buildStationName(e.meta)}),$.extend(m.yAxis,{min:0,title:$.extend(m.yAxis.title,{text:l[d[0].name].axis})}),$.extend(m.tooltip,{formatter:function(){return n="<b>"+Highcharts.dateFormat(r[0].length>366?"%a, %B %e, %Y":"%B %e",this.x)+"</b>",n+="<br />"+(y?y+" daily":"Daily value")+": "+o[this.x],$.each(this.points,function(e,t){n+="<br />"+("Missing values"===t.series.name?"<i>Missing daily value</i>":t.series.name+": "+Highcharts.numberFormat(this.y,l[d[0].name].dec_places))}),n}}),setupChartArea(),r[0].length>366?($.extend(m.rangeSelector,{inputDateFormat:"%Y-%m-%d"}),$.extend(m.legend,{enabled:!1}),$.extend(m.subtitle,{text:"Use navigation tools above and below chart to change displayed range; green/black diamonds represent subsequent/missing values"}),$("#chart_area").highcharts("StockChart",m,setupChartResizer)):($.extend(m.xAxis.dateTimeLabelFormats,{month:"%b %e"}),$.extend(m,disableControls()),m.subtitle.text+="; green/black diamonds represent subsequent/missing values",$("#chart_area").highcharts("StockChart",m,setupChartResizer),moreLines(l[d[0].name].dec_places,_,e.meta.valid_daterange[0])),"pcpn"!==d[0].name&&"snow"!==d[0].name||setTimeout(function(){$("#results_area").append("<div style='margin-top:5px; text-align:center;'><button id='help1' class='smallerButton'>Note regarding subsequent/missing values</button></div>"),$("#help1").button().on("click",{file:"/help/multiPcpnExplain.html"},displayHelp)},2e3)}function displayMultiGrf(e){var t,a,n=$("#chart_area").highcharts(),s=[],r=0,i=0,o=input_params.elems[0].normal?input_params.elems[0].name.substr(0,1)+"dpt":input_params.elems[0].name,l=["hdd","hdpt","cdd","cdpt","gdd","gdpt"],d={pcpn:{title:"Accumulated Precipitation",axisLabel:"Precipitation (inches)",dec_places:2,legendAbbr:"Precip"},pdpt:{title:"Accumulated Precipitation Departure from Normal",axisLabel:"Precipitation Departure (inches)",dec_places:2,legendAbbr:"Precip Dprt"},snow:{title:"Accumulated Snowfall",axisLabel:"Snowfall (inches)",dec_places:1,legendAbbr:"Snow"},sdpt:{title:"Accumulated Snowfall Departure from Normal",axisLabel:"Snowfall Departure (inches)",dec_places:1,legendAbbr:"Snow Dprt"},snwd:{title:"Daily Snow Depth",axisLabel:"Snow Depth (inches)",dec_places:0,legendAbbr:"Snow Depth"},hdd:{title:"Accumulated Heating Degree Days",axisLabel:"Degree Days (base 65)",dec_places:0,legendAbbr:"HDD"},hdpt:{title:"Accumulated HDD Departure",axisLabel:"Degree Day Departure (base 65)",dec_places:0,legendAbbr:"HDD Dprt"},cdd:{title:"Accumulated Cooling Degree Days",axisLabel:"Degree Days (base 65)",dec_places:0,legendAbbr:"CDD"},cdpt:{title:"Accumulated CDD Departure",axisLabel:"Degree Day Departure (base 65)",dec_places:0,legendAbbr:"CDD Dprt"},gdd:{title:"Accumulated Growing Degree Days",axisLabel:"Degree Days (base 50)",dec_places:0,legendAbbr:"GDD"},gdpt:{title:"Accumulated GDD Departure",axisLabel:"Degree Day Departure (base 50)",dec_places:0,legendAbbr:"GDD Dprt"}};$.each(e.data,function(e,t){var a;$.each(t,function(e,t){0===e?a=ymdToUTC(t):"M"===t||"S"===t?s.push({x:a,y:"snwd"===o?i:r,marker:{enabled:!0,fillColor:"M"===t?"black":"green"}}):(t=parseFloat(t.replace("A","").replace("T","0.0")),r+=t,i=t,s.push([a,"snwd"===o?t:r]))})}),a={name:buildStationName(e.meta)+":"+d[o].legendAbbr,data:s,type:"line",turboThreshold:s.length+1,tooltip:{valueDecimals:d[o].dec_places}},n?(n.options.title.text!==d[o].title&&(n.setTitle({text:""}),n.yAxis[0].update({title:{text:$.inArray(o,l)>=0?"Degree Days":"Inches"}})),n.addSeries(a)):(delete(t=defineGraphOptions()).colors,$.extend(t.title,{text:d[o].title}),$.extend(t.chart,{height:$(40).toPx().replace("px","")}),$.extend(t.subtitle,{text:"Green/black diamonds represent subsequent/missing values"}),$.extend(t.yAxis.title,{text:d[o].axisLabel}),$.extend(t.legend,{title:{text:"(Click to hide/show lines)",style:{fontStyle:"italic",color:"darkblue",fontSize:"90%",fontWeight:"normal"}}}),"dpt"===o.substr(1)&&$.extend(t.yAxis,{plotLines:[{value:0,color:"#aed0ea",width:3}]}),t.series.push(a),$("#results_area").empty(),setupChartArea(),$("#chart_area").highcharts(t,setupChartResizer),$("#results_area").append('<div style="text-align:center;margin-top:0.25em;"><button id="clear" class="smallerButton">Clear graph</button></div>'),$("#clear").button().on("click",function(){$("#results_area").empty(),$("div.station_msg").remove(),$("fieldset.acis-fsElem select option").prop("disabled",!1),$("#go span.ui-button-text").text("Go"),$(".acis-idContainer input").focus().select()}),$("#go span.ui-button-text").text($("#product_select").data("gotext")),$("div.station_msg").length||$("#single_stn_select").append("<div class='ui-state-default ui-corner-all station_msg' style='text-align:center;margin:1em 2em;padding:5px;font-size:85%;'>Add more stations to the graph by selecting additional stations here and clicking the 'Add to graph' button below.</div>"),$.each($.inArray(o,l)>=0?["pcpn","pdpt","snow","sdpt","snwd"]:l,function(e,t){$("fieldset.acis-fsElem select option[value="+t+"]").prop("disabled",!0)})),$("div.acis-idContainer input").focus().select()}function getPreferredId(e){var t,a,n,s=null,r=null,i=[],o=[],l={2:"COOP",1:"WBAN",5:"ICAO",6:"GHCN",7:"NWS LI",4:"WMO",3:"FAA",9:"ThreadEx",10:"CoCoRaHS",16:"AWDN",17:"SCAN",19:"TSCAN",26:"NEWA",8:"RCC"},d=[1,2,5,7,3,10,26,16,8,4,6,9,19,17];for($.each(e,function(e,t){a=t.split(" "),i.push(a[0]),o.push(parseInt(a[1],10))}),t=0;t<d.length;t+=1)if((n=$.inArray(d[t],o))>=0){s=i[n],"GHCN"===(r=l[o[n]])&&"USS"===s.substr(0,3)?r="Snotel":"GHCN"===r&&"USR"===s.substr(0,3)&&(r="RAWS");break}return[s,r]}function plotPointMap(e){var t=function(){var t,a,n,s=[],r=[],i=getMapValueSize(),o={mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},streetViewControl:!1,scaleControl:!0},l={boxClass:"infoBox",boxStyle:{fontSize:i||"8pt"},alignBottom:!0,pixelOffset:new google.maps.Size(-12,0),disableAutoPan:!0,closeBoxURL:"",pane:"mapPane",enableEventPropagation:!0};$("#results_area").prepend('<div id="valmap_area"></div>'),t=new google.maps.Map(document.getElementById("valmap_area"),o),$.each(e.data,function(e,a){var n=a.data[0];a.meta.hasOwnProperty("ll")&&"M"!==n&&(input_params.elems[0].hasOwnProperty("reduce")?l.content="object"==typeof n?roundFix(n[0],getDecPlaces(0)):roundFix(n,getDecPlaces(0)):l.content=n,l.position=new google.maps.LatLng(a.meta.ll[1],a.meta.ll[0]),new InfoBox(l).open(t),s.push(a.meta.ll[1]),r.push(a.meta.ll[0]))}),a=new google.maps.LatLng(Array.min(s),Array.min(r)),n=new google.maps.LatLng(Array.max(s),Array.max(r)),t.fitBounds(new google.maps.LatLngBounds(a,n))};if(map)try{InfoBox&&t()}catch(e){loadInfobox(t)}else setupMaps(function(){loadInfobox(t)})}function displayMultiDlyTable(e,t){var a,n,s=$.inArray("csv",t)<0?"html":"text",r="Daily Data for "+new Date.parse(input_params.date).toString("MMMM d, yyyy")+getMultiTitleEnd(),i="",o=$("#multi_stn_select").areaSelection("getStateType"),l="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==o&&"basin"!==o?1:2,d={sortList:2===l?[[0,0],[1,0]]:[[0,0]]},p=getStationCoors(),m=getStationType(),u=getStationCnty(),c=getStationClimdiv(),h=2===l?["State","Name"]:["Name"],g=input_params.elems,y=function(t){$.each(e.data,function(e,n){i=(2===l?"<td>"+n.meta.state+"</td>":"")+"<td>"+n.meta.name+"</td>",m&&(a=getPreferredId(n.meta.sids),i+="<td>"+a[1]+"</td></td>"),u&&(i+="<td>"+(n.meta.hasOwnProperty("county")?t[n.meta.county]:"-")+"</td>"),c&&(i+="<td>"+(n.meta.hasOwnProperty("climdiv")?n.meta.climdiv:"-")+"</td>"),p&&(i+="<td>"+(n.meta.hasOwnProperty("ll")?roundFix(n.meta.ll[0],3):"-")+"</td><td>"+(n.meta.hasOwnProperty("ll")?roundFix(n.meta.ll[1],3):"-")+"</td><td>"+(n.meta.hasOwnProperty("elev")?roundNum(n.meta.elev,0):"-")+"</td>"),$.each(n.data,function(e,t){i+="<td>"+t+"</td>"}),addDisplayRow(i,s)}),"html"===s&&((n=(n=$.inArray("County",h))>=0?n:$.inArray("Climate Division",h))>0&&(d={sortList:2===l?[[0,0],[n,0],[1,0]]:[[n,0],[0,0]]}),$(".tablesorter").tablesorter(d))};addDisplayTitle(r,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",s),m&&h.push("Station Type"),u&&h.push("County"),c&&h.push("Climate Division"),p&&$.merge(h,["Longitude","Latitude","Elevation"]),h=column_headers(g,h),$.each(h,function(e,t){i+='<th class="sorter-'+("State"===t||"Name"===t||"County"===t||"Climate Division"===t||t.search("Station")>=0?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(i,s),u?showTableCntyNames(e.data,y):y(null)}function displayMultiDlylist(e){var t=getOutputChoice()||["html"];"object"!=typeof t&&(t=[t]),$.inArray("map",t)>=0&&plotPointMap(e),($.inArray("html",t)>=0||$.inArray("csv",t)>=0)&&displayMultiDlyTable(e,t)}function displayMultiList(e,t,a,n){var s,r,i,o,l,d=[],p=[],m=$.inArray("csv",a)<0?"html":"text",u="mmdd"===n?[5,5]:[8,2],c=$("#multi_stn_select").areaSelection("getStateType"),h="state_button"!==$("input[name=multiStn_select_type]:checked").attr("id")||"cwa"===c||"basin"===c,g=getStationCoors(),y=getStationType(),_=getStationCnty(),b=getStationClimdiv(),f="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==c&&"basin"!==c?1:2,D={sortList:2===f?[[0,0],[1,0]]:[[0,0]]},x=column_headers(input_params.elems,[]),v=function(t){var a=[];$.each(e.data,function(e,a){r=(h?"<td>"+a.meta.state+"</td>":"")+"<td>"+a.meta.name+"</td>",y&&(s=getPreferredId(a.meta.sids),r+="<td>"+s[1]+"</td>"),_&&(r+="<td>"+(a.meta.hasOwnProperty("county")?t[a.meta.county]:"-")+"</td>"),b&&(r+="<td>"+(a.meta.hasOwnProperty("climdiv")?a.meta.climdiv:"-")+"</td>"),g&&(r+="<td>"+(a.meta.hasOwnProperty("ll")?roundFix(a.meta.ll[0],3):"-")+"</td><td>"+(a.meta.hasOwnProperty("ll")?roundFix(a.meta.ll[1],3):"-")+"</td><td>"+(a.meta.hasOwnProperty("elev")?roundNum(a.meta.elev,0):"-")+"</td>"),$.each(a.data,function(e,t){r+="object"==typeof t?'<td style="border-right:0px;">'+roundFix(t[0],getDecPlaces(e))+(d[e]?'</td><td style="border-left:0px;border-right:0px;">'+("M"===t[1]?"-":t[1].substr(u[0],u[1])):"")+(p[e]?'</td><td style="border-left:0px;">'+t[t.length-1]:"")+"</td>":"<td>"+roundFix(t,getDecPlaces(e))+"</td>"}),addDisplayRow(r,m)}),"html"===m&&($("table.tablesorter thead tr th").each(function(e,t){a.push($(t).text())}),(l=(l=$.inArray("County",a))>=0?l:$.inArray("Climate Division",a))>0&&(D={sortList:2===f?[[0,0],[l,0],[1,0]]:[[l,0],[0,0]]}),$(".tablesorter").tablesorter(D))};r=(h?'<th class="sorter-text">State</th>':"")+'<th class="sorter-text">Name</th>',y&&(r+='<th class="sorter-text">Station Type</th>'),_&&(r+='<th class="sorter-text">County</th>'),b&&(r+='<th class="sorter-text">Climate Division</th>'),g&&$.each(["Longitude","Latitude","Elevation"],function(e,t){r+='<th class="sorter-digit">'+t+"</th>"}),$.each(x,function(e,t){d.push(input_params.elems[e].reduce.add&&$.inArray("date",input_params.elems[e].reduce.add)>=0),p.push(input_params.elems[e].reduce.add&&$.inArray("mcnt",input_params.elems[e].reduce.add)>=0),r+="<th"+(d[e]||p[e]?' style="text-align:center; border-right:0px;"':"")+' class="sorter-sorttrace string-bottom">'+t+(d[e]?'</th><th style="border-left:0px;border-right:0px;" class="sorter-text string-bottom">'+("text"===m?"date":"Date"):"")+(p[e]?'</th><th style="border-left:0px;" class="sorter-digit string-bottom">'+("text"===m?"mcnt":"Miss"):"")+"</th>"}),i=$.inArray(!0,d)>=0,o=$.inArray(!0,p)>=0,addDisplayTitle(t,(i||o?"<br /><span class='subtitle'>Each variable column contains summary value"+(i?", date of occurrence (if applicable)":"")+(o?" and number of missing days":"")+".</span>":"")+"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",m),addDisplayHead(r,m),_?showTableCntyNames(e.data,v):v(null)}function displayMultiMlylist(e){var t=getOutputChoice()||["html"];$.inArray("map",t)>=0&&plotPointMap(e),($.inArray("html",t)>=0||$.inArray("csv",t)>=0)&&displayMultiList(e,"Monthly Data for "+new Date.parse(input_params.date).toString("MMMM yyyy")+getMultiTitleEnd(),t,"dd")}function displayMultiDatRang(e){var t=getOutputChoice()||["html"];"object"!=typeof t&&(t=[t]),$.inArray("map",t)>=0&&plotPointMap(e),($.inArray("html",t)>=0||$.inArray("csv",t)>=0)&&displayMultiList(e,"Data for "+new Date.parse(dateStart(input_params.eDate,input_params.elems[0].duration)).toString("MMMM d, yyyy")+" through "+new Date.parse(input_params.eDate).toString("MMMM d, yyyy"),t,"mmdd")}function displayPptSmry(e){var t,a,n,s,r=getOutputChoice()||"html",i="",o=getStationCoors(),l=getStationType(),d=getStationCnty(),p=getStationClimdiv(),m=$("#multi_stn_select").areaSelection("getStateType"),u="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==m&&"basin"!==m?5:6,c={sortList:6===u?[[3,1],[2,0],[0,0]]:[[2,1],[0,0]]},h=["Name","ID","Last 30 Days","Last 60 Days","Last 90 Days","Last 180 Days","Since Jan 1","Since Oct 1"],g=function(m){$.each(e.data,function(e,s){n=0,t="",$.each(s.data,function(e,a){t+="<td>"+a+"</td>","M"===a&&(n+=1)}),n<6&&(a=getPreferredId(s.meta.sids))[0]&&addDisplayRow(i="<td>"+s.meta.name+"</td><td>"+a[0]+"</td>"+(6===u?"<td>"+s.meta.state+"</td>":"")+(l?"<td>"+a[1]+"</td>":"")+(d?"<td>"+(s.meta.hasOwnProperty("county")?m[s.meta.county]:"-")+"</td>":"")+(p?"<td>"+(s.meta.hasOwnProperty("climdiv")?s.meta.climdiv:"-")+"</td>":"")+(o?"<td>"+(s.meta.ll?s.meta.ll[1].toFixed(2):"-")+"</td><td>"+(s.meta.ll?s.meta.ll[0].toFixed(2):"-")+"</td>":"")+t,r)}),("html"===r?$(".tablesorter tbody tr").length:$("#results_area br").length>2)?"html"===r&&((s=(s=$.inArray("County",h))>=0?s:$.inArray("Climate Division",h))>0&&(c={sortList:6===u?[[2,0],[s,0],[0,0]]:[[s,0],[0,0]]}),$(".tablesorter").tablesorter(c)):($("#results_area").empty(),$(document).reportError({errorText:"No data available meeting criteria",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}))};addDisplayTitle("Precipitation Summary for Period Ending "+new Date.parse(input_params.date).toString("MMMM d, yyyy")+getMultiTitleEnd(),"",r),o&&(h.splice(2,0,"Latitude"),h.splice(3,0,"Longitude")),p&&h.splice(2,0,"Climate Division"),d&&h.splice(2,0,"County"),l&&h.splice(2,0,"Station Type"),6===u&&h.splice(2,0,"State"),$.each(h,function(e,t){i+='<th class="sorter-'+("State"===t||"Station Type"===t||"County"===t||"Climate Division"===t||"Name"===t?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(i,r),d?showTableCntyNames(e.data,g):g(null)}function startPostRecs(e,t,a,n,s,r,i,o,l,d,p,m,u){var c,h,g=!1,y=getStationCoors(),_=getStationType(),b=getStationCnty(),f=getStationClimdiv(),D=["valid_daterange","name","state"],x=function(){var c=e.length,h=Math.round($("#progress").progressbar("value")/100*c)+1;$("#progress").progressbar("value",h/c*100),!g&&t+1<c?startPostRecs(e,t+1,a,n,s,r,i,o,l,d,p,m,u):100!==$("#progress").progressbar("value")&&$("#progress").progressbar("value",100)};_&&D.push("sids"),b&&D.push("county"),f&&D.push("climdiv"),(y||i)&&D.push("ll","elev"),$("#cancelPost").off("click").on("click",function(){g=!0,$(this).remove()}),$.extend(input_params,{sid:e[t].sids[0],sDate:a[0],eDate:a[1],meta:D}),$.extend(input_params.elems[0],{smry:n,smry_only:1}),postResults("/StnData",function(e){var t,a,g,D,v=n.reduce,S=n.n,C=getCompareYr();e&&e.smry&&e.smry[0].length&&e.smry[0][0].length?(g="T"===e.smry[0][0][0]?"T":parseFloat(e.smry[0][0][0]),r&&(t=e.meta.valid_daterange[0],D=(a=e.smry[0].length===S&&e.smry[0].pop())&&a[0]===g?"+":"",addDisplayRow((2===m?"<td>"+e.meta.state+"</td>":"")+"<td>"+e.meta.name+"</td>"+(_?"<td>"+getPreferredId(e.meta.sids)[1]+"</td>":"")+(b?"<td>"+(e.meta.hasOwnProperty("county")?u[e.meta.county]:"-")+"</td>":"")+(f?"<td>"+(e.meta.hasOwnProperty("climdiv")?e.meta.climdiv:"-")+"</td>":"")+(y?"<td>"+(e.meta.hasOwnProperty("ll")?roundFix(e.meta.ll[0],3):"-")+"</td><td>"+(e.meta.hasOwnProperty("ll")?roundFix(e.meta.ll[1],3):"-")+"</td><td>"+(e.meta.hasOwnProperty("elev")?roundNum(e.meta.elev,0):"-")+"</td>":"")+(C?'<td class="cycol"></td>':"")+"<td>"+roundFix(g,s)+"</td><td>"+e.smry[0][0][1].substr(0,4)+D+"</td><td>"+("por"===input_params.sDate?t[0]:t[0]>input_params.sDate?t[0]:input_params.sDate)+" to "+("por"===input_params.eDate?t[1]:t[1]<input_params.eDate?t[1]:input_params.eDate)+"</td>",r)),i&&e.meta.hasOwnProperty("ll")&&(p.content=roundFix(g,s),p.position=new google.maps.LatLng(e.meta.ll[1],e.meta.ll[0]),new InfoBox(p).open(o),l.push(e.meta.ll[1]),d.push(e.meta.ll[0]),c=new google.maps.LatLng(Array.min(l),Array.min(d)),h=new google.maps.LatLng(Array.max(l),Array.max(d)),o.fitBounds(new google.maps.LatLngBounds(c,h))),C&&r?($.extend(input_params,{sDate:C+input_params.sDate.substr(4),eDate:C+input_params.sDate.substr(4),meta:[]}),delete input_params.elems[0].smry_only,delete input_params.elems[0].smry,postResults("/StnData",function(e){var t;e&&e.data&&e.data[0].length?(t=$.isNumeric(e.data[0][1])?parseFloat(e.data[0][1]):e.data[0][1],$(".tablesorter td.cycol").last().text(roundFix(t,s).replace("M","-")),("max"===v&&t>=g||"min"===v&&t<=g)&&$(".tablesorter td.cycol").last().css({color:"red","font-weight":"600"})):$(".tablesorter td.cycol").last().text("-"),x()},!0)):x()):x()},!0)}function displayMultiDlyRecs(e){var t,a,n,s,r,i,o=[],l=[],d=getOutputChoice()||["html"],p=getDecPlaces(),m=[],u="",c=$.extend(!0,{},input_params.elems[0].smry),h=$("#tdate_area").singleDateSelection("getter"),g=getStationCoors(),y=getStationType(),_=getStationCnty(),b=getStationClimdiv(),f=getCompareYr(),D=$("#multi_stn_select").areaSelection("getStateType"),x="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==D&&"basin"!==D?1:2,v={sortList:2===x?[[0,0],[1,0]]:[[0,0]]},S=(2===x?["State","Name"]:["Name"]).concat(y?["Station Type"]:[],_?["County"]:[],b?["Climate Division"]:[],g?["Longitude","Latitude","Elevation"]:[],f?[f]:[],["Record","Year","Valid Date Range"]),C=function(){var t=getMapValueSize(),a={mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},streetViewControl:!1,scaleControl:!0};r={boxClass:"infoBox",boxStyle:{fontSize:t||"8pt"},alignBottom:!0,pixelOffset:new google.maps.Size(-12,0),disableAutoPan:!0,closeBoxURL:"",pane:"mapPane",enableEventPropagation:!0},$("#results_area").prepend('<div id="valmap_area"></div>'),s=new google.maps.Map(document.getElementById("valmap_area"),a),_?showTableCntyNames(e.meta,M):M(null)},M=function(t){startPostRecs(e.meta,0,m,c,p,a,n,s,o,l,r,x,t)};if("object"!=typeof d&&(d=[d]),a=$.inArray("html",d)>=0?"html":$.inArray("csv",d)>=0?"csv":null,n=$.inArray("map_record",d)>=0,getDateRangeYY("year_area"),m=[input_params.sDate.substr(0,4).replace("por","1850")+"-"+h,input_params.eDate.substr(0,4).replace("por",(new Date).toString("yyyy"))+"-"+h],delete input_params.bbox,t=column_headers(input_params.elems)[0]+" - "+new Date.parse(m[0]).toString("MMMM d")+getMultiTitleEnd(),a?(addDisplayTitle(t,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",a),$.each(S,function(e,t){u+='<th class="sorter-'+("State"===t||"Station Type"===t||"County"===t||"Climate Division"===t||"Name"===t||"Valid Date Range"===t?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(u,a)):addDisplayTitle(t,"","html"),"html"===a||!a&&n?($(".tablesorter thead").append('<tr class="progressRow"><td colspan='+S.length+'><div id="progress"></div><button id="cancelPost" class="smallerButton">Cancel</button></td></tr>'),$("#cancelPost").button()):$("#results_area").prepend('<div id="progress" style="width:41em;"></div>'),$("#progress").progressbar({complete:function(){$("#progress").progressbar("destroy").remove(),setTimeout(function(){$("#results_area pre:contains('+'),td:contains('+')").length&&addDisplayFoot(u="<td colspan="+(x+3+(f?1:0))+">+ indicates value also occurred in one or more previous years.</td>",a)},100),("html"===a||!a&&n)&&($("tr.progressRow").remove(),(i=(i=$.inArray("County",S))>=0?i:$.inArray("Climate Division",S))>0&&(v={sortList:2===x?[[0,0],[i,0],[1,0]]:[[i,0],[0,0]]}),$(".tablesorter").tablesorter(v))}}),n)if(map)try{InfoBox&&C()}catch(e){loadInfobox(C)}else setupMaps(function(){loadInfobox(C)});else _?showTableCntyNames(e.meta,M):M(null)}function startPost(e,t,a,n,s,r,i,o,l,d,p,m){var u,c,h,g,y,_,b,f,D,x=!1,v=0,S=[],C=["valid_daterange","name","state"],M=e.length,T=$("#restrictRange").prop("checked"),A=input_params.elems[0].smry.n,w=getStationCoors(),R=getStationType(),L=getStationCnty(),F=getStationClimdiv(),k=$("#multi_stn_select").areaSelection("getStateType"),I="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==k&&"basin"!==k?1:2,O=getIncludeStart(),P=Math.min(M-t,a),N=M===t+P;for(R&&C.push("sids"),L&&C.push("county"),F&&C.push("climdiv"),(w||r)&&C.push("ll","elev"),input_params.meta=C,$("#cancelPost").off("click").on("click",function(){x=!0,N=!0,$(this).remove()}),u=t;u<t+P;u+=1)(_=e[u]).sids?S.push(_.sids[0]):e.splice(u,1);$.each(S,function(u,_){input_params.sid=_,postResults("/StnData",function(u){x||u.error||(T&&(u.smry=[],u.smry.push(trimExtremes(u.data))),u&&u.smry&&u.smry[0].length&&u.smry[0][0].length&&(s&&(c=u.meta.valid_daterange[0],h=(O?findPeriodStart(u.smry[0][0][1])+" through ":"")+u.smry[0][0][1],g=u.smry[0].length===A&&u.smry[0].pop(),y=g&&g[0]===u.smry[0][0][0]?"+":" ",addDisplayRow((2===I?"<td>"+u.meta.state+"</td>":"")+"<td>"+u.meta.name+"</td>"+(R?"<td>"+getPreferredId(u.meta.sids)[1]+"</td>":"")+(L?"<td>"+(u.meta.hasOwnProperty("county")?m[u.meta.county]:"")+"</td>":"")+(F?"<td>"+(u.meta.hasOwnProperty("climdiv")?u.meta.climdiv:"")+"</td>":"")+(w?"<td>"+(u.meta.hasOwnProperty("ll")?roundFix(u.meta.ll[0],3):"-")+"</td><td>"+(u.meta.hasOwnProperty("ll")?roundFix(u.meta.ll[1],3):"-")+"</td><td>"+(u.meta.hasOwnProperty("elev")?roundNum(u.meta.elev,0):"-")+"</td>":"")+"<td>"+roundFix(u.smry[0][0][0],n)+"</td><td>"+h+y+"</td>"+(p?"":"<td>"+u.smry[0][0][2]+"</td>")+"<td>"+("por"===input_params.sDate?c[0]:c[0]>input_params.sDate?c[0]:input_params.sDate)+" to "+("por"===input_params.eDate?c[1]:c[1]<input_params.eDate?c[1]:input_params.eDate)+"</td>",s)),r&&u.meta.hasOwnProperty("ll")&&(d.content=roundFix(u.smry[0][0][0],n),d.position=new google.maps.LatLng(u.meta.ll[1],u.meta.ll[0]),new InfoBox(d).open(i),o.push(u.meta.ll[1]),l.push(u.meta.ll[0]),f=new google.maps.LatLng(Array.min(o),Array.min(l)),D=new google.maps.LatLng(Array.max(o),Array.max(l)),i.fitBounds(new google.maps.LatLngBounds(f,D))))),b=Math.round($("#progress").progressbar("value")/100*M)+1,$("#progress").progressbar("value",b/M*100),v+=1,N||v!==S.length-2?(x||$("#progress").progressbar("value")>=99.9)&&$("#progress").progressbar("value",100):startPost(e,t+a,a,n,s,r,i,o,l,d,p,m)},!0)})}function displayMultiExtremes(e){var t,a,n,s,r,i,o=[],l=[],d="",p=getOutputChoice()||["html"],m=getDecPlaces(),u=getStationCoors(),c=getStationType(),h=getStationCnty(),g=getStationClimdiv(),y=$("#multi_stn_select").areaSelection("getStateType"),_=getIncludeStart(),b="state_button"===$("input[name=multiStn_select_type]:checked").attr("id")&&"cwa"!==y&&"basin"!==y?1:2,f={sortList:2===b?[[0,0],[1,0]]:[[0,0]]},D=(2===b?["State","Name"]:["Name"]).concat(c?["Station Type"]:[],h?["County"]:[],g?["Climate Division"]:[],u?["Longitude","Latitude","Elevation"]:[],["Value"],_?["Dates"]:["Ending Date"],["Missing Days","Valid Date Range"]),x=column_headers(input_params.elems)[0]+getMultiTitleEnd(),v=function(){var t=getMapValueSize(),a={mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},streetViewControl:!1,scaleControl:!0};r={boxClass:"infoBox",boxStyle:{fontSize:t||"8pt"},alignBottom:!0,pixelOffset:new google.maps.Size(-12,0),disableAutoPan:!0,closeBoxURL:"",pane:"mapPane",enableEventPropagation:!0},$("#results_area").prepend('<div id="valmap_area"></div>'),s=new google.maps.Map(document.getElementById("valmap_area"),a),h?showTableCntyNames(e.meta,S):S(null)},S=function(i){startPost(e.meta,0,4,m,a,n,s,o,l,r,t,i)};if("object"!=typeof p&&(p=[p]),a=$.inArray("html",p)>=0?"html":$.inArray("csv",p)>=0?"csv":null,n=$.inArray("map",p)>=0,getDateRangeYY("year_area"),!getRecLength())return!1;if(t=1===input_params.elems[0].duration&&"dly"===input_params.elems[0].interval,input_params.meta=["valid_daterange","name","state"],x=input_params.elems[0].smry.reduce.charAt(0).toUpperCase()+input_params.elems[0].smry.reduce.substr(1)+"imum "+input_params.elems[0].duration+"-"+{dly:"Day",mly:"Month",yly:"Year"}[input_params.elems[0].interval]+" "+x,a?(addDisplayTitle(x,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",a),t&&D.splice(-2,1),$.each(D,function(e,t){d+='<th class="sorter-'+("State"===t||"Station Type"===t||"County"===t||"Climate Division"===t||"Name"===t||t.search("Date")>=0?"text":"sorttrace string-bottom")+'">'+t+"</th>"}),addDisplayHead(d,a)):addDisplayTitle(x,"","html"),"html"===a||!a&&n?($(".tablesorter thead").append('<tr class="progressRow"><td colspan='+D.length+'><div id="progress"></div><button id="cancelPost" class="smallerButton">Cancel</button></td></tr>'),$("#cancelPost").button()):$("#results_area").prepend('<div id="progress" style="width:41em;"></div>'),$("#progress").progressbar({complete:function(){$("#progress").progressbar("destroy").remove(),setTimeout(function(){$("#results_area pre:contains('+'),td:contains('+')").length&&addDisplayFoot(d="<td colspan="+D.length+">+ indicates value also occurred in one or more previous years.</td>",a),("html"===a||!a&&n)&&($("tr.progressRow").remove(),(i=(i=$.inArray("County",D))>=0?i:$.inArray("Climate Division",D))>0&&(f={sortList:2===b?[[0,0],[i,0],[1,0]]:[[i,0],[0,0]]}),$(".tablesorter").tablesorter(f))},1e3)}}),n)if(map)try{InfoBox&&v()}catch(e){loadInfobox(v)}else setupMaps(function(){loadInfobox(v)});else h?showTableCntyNames(e.meta,S):S(null)}function buildCompareTable(){var e={1:{ACIS:0,TD3200:1,GHCN:2,Shef:4,AWDN:6,NRCC:8,DSM:9,TD3206:10,SRCC:11,CLI:13,TD3210:14,TD3205:15,TD3299:16,ThreadEx:17,TD3298:18},2:{ACIS:0,TD3200:1,GHCN:2,Shef:4,AWDN:6,NRCC:8,DSM:9,TD3206:10,SRCC:11,CLI:13,TD3210:14,TD3205:15,TD3299:16,ThreadEx:17,TD3298:18},4:{ACIS:0,TD3200:1,GHCN:2,Shef:4,AWDN:6,NRCC:7,DSM:8,TD3206:9,SRCC:10,CLI:12,TD3210:13,TD3205:14,TD3299:15,ThreadEx:16,TD3298:17},10:{ACIS:0,TD3200:1,GHCN:2,Shef:4,AWDN:6,NRCC:7,DSM:8,TD3206:9,SRCC:10,CLI:11,TD3210:12,TD3205:13,TD3299:14,ThreadEx:15,TD3298:16},11:{ACIS:0,TD3200:1,GHCN:2,Shef:4,NRCC:6,DSM:7,TD3206:8,SRCC:9,CLI:10,TD3210:11,TD3205:12,TD3299:13,ThreadEx:14}},t=$.extend(!0,{},input_params.elems[0]),a=[],n=$("input[name=decade_selection]:checked").attr("id"),s=n.substr(1,4)+"-01-01",r=n.substr(5,4)+"-12-31";$.extend(input_params,{sdate:s,edate:r,meta:"",elems:[]}),delete input_params.sids,$.each($("input[name=sourcelist]:checked"),function(n,s){"All"!==$(s).val()&&e[t.vX].hasOwnProperty($(s).val())&&(a.push($(s).val()),input_params.elems.push($.extend(!0,{},t,{vN:e[t.vX][a[a.length-1]]})))}),checkboxBar("#meta_area",a[0]),$("#data_area").empty().loadSpinner(),postResults("/StnData",function(e){var t,n,s="<th>Date</th>";$("#data_area").empty().append("<table id='compareTable'><thead></thead><tbody></tbody></table>"),$.each(a,function(e,t){s+="<th>"+t+("GHCN"===t?" : Source":"")+"</th>"}),$("#compareTable thead").append("<tr>"+s+"</tr>"),$.each(e.data,function(e,a){s="",t="-0"!==a[1][0]?a[1][0]:"0",n=!0,$.each(a,function(e,a){"-0"===a[0]&&(a[0]="0"),0===e?s+="<td>"+a+"</td>":a[0]===t?s+="<td>"+a[0]+(" "===a[1]?"":" : "+a[1])+"</td>":"M"===t?(s+="<td class='compare_baseMiss'>"+a[0]+(" "===a[1]?"":" : "+a[1])+"</td>",n=!1):"M"===a[0]?(s+="<td class='compare_itemMiss'>"+a[0]+(" "===a[1]?"":" : "+a[1])+"</td>",n=!1):(s+="<td class='compare_different'>"+a[0]+(" "===a[1]?"":" : "+a[1])+"</td>",n=!1)}),n&&(s=s.replace("<td>","<td class='compare_match'>")),$("#compareTable tbody").append("<tr>"+s+"</tr>")})})}function displayCompare(e){var t=e.meta[0],a=t.valid_daterange[0][0],n=t.valid_daterange[0][1],s=parseInt(a.substr(0,4),10),r=parseInt(n.substr(0,4),10),i=s,o=Math.min(r,parseInt(a.substr(0,3)+"9",10)),l=[];for($("#results_area").append("<div id='meta_area'></div><div id='data_area'></div>"),$("#meta_area").append("<p>"+buildStationName(t)+"; Valid date range: "+a+" to "+n+"</p>");i<=r;)l.push(["d"+i+o+"_button",i+"-"+o]),i=o+1,o=Math.min(r,i+9);$('<span class="compare_barTitle">Click decade of interest:</span>').appendTo("#meta_area"),$('<div id="decade_area"></div>').appendTo("#meta_area").buttonBar({barName:"decade_selection",barOrient:"horizontal",buttonInfo:l,buttonDefault:"no_button"}),$("#decade_selection").on("change",function(){buildCompareTable()})}function calculateDegDay(e,t,a){var n,s,r,i,o,l;if("M"===e||"M"===t)i="M";else switch(n="mgdd"!==a.ddtype?parseInt(e,10):Math.min(parseInt(e,10),a.upperLimit),s="mgdd"!==a.ddtype?parseInt(t,10):Math.max(parseInt(t,10),a.lowerLimit),r=roundNum((n+s)/2,0),a.ddtype){case"gdd":case"cdd":case"mgdd":i=Math.max(r-a.baseTemp,0);break;case"begdd":s>=a.baseTemp?i=Math.max(r-a.baseTemp,0):n<=a.baseTemp?i=0:(o=(n-s)/2,l=Math.asin((a.baseTemp-r)/o),i=roundNum(Math.max((o*Math.cos(l)-(a.baseTemp-r)*(1.57-l))/3.14,0),0));break;case"hdd":i=Math.max(a.baseTemp-r,0);break;default:i="M"}return i}function displayDdlist(e){var t,a,n=[],s=0,r=0,i="",o=defineGraphOptions(),l=dateDiff($("#sDatepicker").val(),input_params.eDate),d=getOutputChoice()||["graph","table"],p=$.inArray("table",d)>=0?"html":$.inArray("csv",d)>=0?"csv":null,m=Date.parse($("#sDatepicker").val()),u=getDegDayChoice(),c=$.inArray("graph",d)<0?"Degree Day Data for "+buildStationName(e.meta):"",h=column_headers(input_params.elems,["Date"]);$.inArray("graph",d)>=0&&setupChartArea(),p&&(addDisplayTitle(c,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",p),h.push($("#ddtype").find("option:selected").text()+" (Base "+u.baseTemp+")"),$.each(h,function(e,t){i+='<th rowspan="2" class="sorter-'+("Date"===t?"isoDate":"sorttrace string-bottom")+'">'+t+"</th>"}),"html"===p&&(i+="<th colspan=2>Since "+input_params.sDate+"</th></tr><tr>"),addDisplayHead(i+='<th class="sorter-sorttrace string-bottom">Accumulation</th><th class="sorter-sorttrace string-bottom">Missing Days</th>',p)),$.each(e.data,function(e,o){a=ymdToUTC(o[0]),"M"===(t=calculateDegDay(o[1],o[2],u))?(r+=1,n.push({x:a,y:s,marker:{enabled:!0,symbol:"diamond",radius:3,fillColor:"black"}})):(s+=t,n.push([a,s])),p&&Date.compare(Date.parse(o[0]),m)>=0&&addDisplayRow(i="<td>"+o[0]+"</td><td>"+o[1]+"</td><td>"+o[2]+"</td><td>"+t+"</td><td>"+s+"</td><td>"+r+"</td>",p)}),$.inArray("table",d)>=0&&$(".tablesorter").tablesorter(),$.inArray("graph",d)>=0&&(o.series.push({name:"Degree Day Accumulation",data:n,color:"#41A317",type:"line",turboThreshold:n.length+1}),$.extend(o.title,{text:$("#ddtype").find("option:selected").text()+" (Base "+u.baseTemp+") - "+buildStationName(e.meta)}),$.extend(o.yAxis,{min:0,title:$.extend(o.yAxis.title,{text:"Degree Day Accumulation"})}),$.extend(o.xAxis,{minRange:6048e5}),$.extend(o.tooltip,{formatter:function(){var e="<b>"+Highcharts.dateFormat("%a, %B %e, %Y",this.x)+"</b>";return $.each(this.points,function(t,a){e+="<br />"+a.series.name+": "+Highcharts.numberFormat(this.y,0)}),e}}),$.extend(o.rangeSelector,{inputDateFormat:"%Y-%m-%d",inputEditDateFormat:"%Y-%m-%d",selected:0,buttons:[{type:"day",count:l+1,text:l+1+"d"},{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"all",text:"All"}]}),$.extend(o.rangeSelector.buttonTheme,{width:50}),$.extend(o.legend,{enabled:!1}),$.extend(o.subtitle,{text:"Use navigation tools above and below chart to change displayed range; black diamonds represent missing values"}),$("#chart_area").highcharts("StockChart",o,setupChartResizer))}function addLevelsToInput(e){var t=$("#clevels");t.length&&t.is(":visible")&&t.val(e).removeClass("grayedinput").off("click")}function displayGridMap(e){var t=[],a="";"dly"===input_params.elems[0].interval&&input_params.date?a=new Date.parse(input_params.date).toString("MMMM d, yyyy"):"dly"===input_params.elems[0].interval&&input_params.sDate?a=new Date.parse(dateStart(input_params.eDate,input_params.elems[0].duration)).toString("MMMM d, yyyy")+" through "+new Date.parse(input_params.eDate).toString("MMMM d, yyyy"):"mly"===input_params.elems[0].interval&&(a=new Date.parse(input_params.date).toString("MMMM yyyy")),$("#results_area").append("<div id='resizer'></div>"),$("#resizer").css("text-align","center").append("<h2 class='cmapTitle'>"+column_headers(input_params.elems)[0]+" - "+a+"</h2><img src='"+e.data+"' width='"+e.size[0]+"' height='"+e.size[1]+"' alt='Map' /><br /><div id='legendBox'></div>"),$.each(e.cmap,function(e,t){$("#legendBox").append("<div class='colorBox' style='background-color:"+t+";'></div>")}),$("#legendBox").append("<br style='clear:both;' /><div class='labelContainer'></div>"),$.each(e.levels,function(e,a){t.push("pcpn"===input_params.elems[0].name?roundNum(a,2):roundNum(a,1)),$(".labelContainer").append("<span class='labelBox'>"+t[t.length-1]+"</span>")}),$(".labelContainer").append("<br style='clear:both;' />"),$(".colorBox").css("width",Math.min(40,Math.floor(e.size[0]/(e.levels.length+1))-2)+"px"),$(".labelBox").css("width",parseInt($(".colorBox").css("width"),10)+2+"px"),$(".labelContainer").css("margin-left",parseInt($(".labelBox").css("width"),10)/2+"px"),$("#resizer").resizable({aspectRatio:!0,alsoResize:"#resizer img",minWidth:$("#legendBox").outerWidth()}).css({width:e.size[0]}),addLevelsToInput(t)}function displayGridReduce(e){var t,a=getOutputChoice()||"html",n=column_headers(input_params.elems)[0],s=input_params.elems[0].hasOwnProperty("season_start"),r=$("input[name=gridArea_select_type]:checked").attr("id"),i=input_params.elems[0].area_reduce.split("_"),o=i[0],l=i[1],d="climdiv"===o?"Climate Division":o.charAt(0).toUpperCase()+o.slice(1),p={county:"Counties in",climdiv:"Climate Divisions in",basin:"Drainage Basins in",state:"gstate_button"===r?"the State of":"States in"},m=l.charAt(0).toUpperCase()+l.slice(1)+("mean"!==l?"imum":""),u="gstate_button"===r?$("#tstate option:selected").html():"Bounding Box",c=m+(s?" ":" Monthly ")+n+" for "+p[o]+" "+u,h='<th class="sorter-text">'+d+"</th>",g=getDecPlaces(),y=$("input[name=seasonChoices]:checked").val(),_="water"!==y?y.charAt(0).toUpperCase()+y.slice(1):"Water Year",b={},f={},D={},x=$.extend(!0,{},input_params),v=function(e){var t,a="",n=0,s=0,r=x.elems[0].reduce.reduce.split("_")[0];if(e.length>1){if("mean"===l){if("sum"===r||"cnt"===r)for(a=0,t=0;t<e.length;t+=1)a+=e[t];else if("mean"===r||"pct"===r){for(t=0;t<e.length;t+=1)s+=e[t],n+=1;a=s/n}}else"max"===l&&"max"===r?a=Math.max.apply(null,e):"min"===l&&"min"===r&&(a=Math.min.apply(null,e));return""===a?"":'<td class="smryCell">'+roundFix(a,g)+"</td>"}},S=function(){$(".tablesorter td.smryCell").length>0&&($(".tablesorter thead tr").append("<th>"+_+"</th>"),t=$(".tablesorter thead th").length,$(".tablesorter tfoot").html('<tr><td colspan="'+t+'" style="font-style:italic;font-size:90%;">Seasonal summary is based on monthly values.</td></tr>'))};$.each(e.data,function(e,t){var a=t[0],n=t[1];$.isEmptyObject(n)||(s&&(a=a.substr(0,4)),h+="<th>"+a+"</th>",$.each(n,function(t,a){0!==e?b[t]+="<td>"+roundFix(a,g)+"</td>":(b[t]='<td class="areaHead">'+t+"</td><td>"+roundFix(a,g)+"</td>",f[t]=[]),f[t].push(parseFloat(a))}))}),$.isEmptyObject(b)?$(document).reportError({errorText:"No results for request"}):(addDisplayTitle(c,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",a),addDisplayHead(h,a),"gstate_button"===r?(input_params={state:input_params.state,meta:["id","name"]},postResults("/General/"+o,function(e){e.meta.length>0&&$.each(e.meta,function(e,t){D[t.id]=("climdiv"===o?t.id+" - ":"")+t.name.replace(" County","")}),input_params=$.extend(!0,{},x),$.each(b,function(e,t){D[e]&&addDisplayRow((t+=v(f[e])).replace(e,D[e]),a)}),S(),"html"===a&&$(".tablesorter").tablesorter({sortList:[[0,0]]})})):(input_params={meta:["id","name"]},"county"===o&&input_params.meta.push("state"),$.each(b,function(e,t){addDisplayRow(t+=v(f[e]),a),input_params.id=e,postResults("/General/"+o,function(t){var a;t.meta.length>0&&(a="climdiv"===o?e+" - "+t.meta[0].name:"county"===o?t.meta[0].state+" "+t.meta[0].name.replace(" County",""):t.meta[0].name,$("td.areaHead").filter(function(){return $(this).text()===e}).text(a))})}),S(),"html"===a&&$(".tablesorter").tablesorter({sortList:[[0,0]]})))}function displayResults(e){if(!e.error){if(!(e.data&&0!==e.data.length||e.smry&&0!==e.smry.length||e.meta&&0!==e.meta.length))return $(document).reportError({errorText:"No data returned for this request"}),!1;$("#product_select").data("display")(e)}}function setInput_monavg(){setupOutputChoice("#option_select",["Table","List","CSV-Table","CSV-List"],"menu"),setupElements("#option_select"),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupSeasonCalcs("#option_select"),setupMoreOptions("#option_select"),setupDateRangeMM("#more_option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupMaxmissing("#more_option_select"),setupOccur("#more_option_select","date"),setupMcnt("#more_option_select"),setupFilterYrs("#more_option_select"),setupTempRoundingMly("#more_option_select"),setupStations("#station_select","single"),$("select[name=outopt]").on("change",function(){$(this).val().search("list")>=0?($("#seasonCalcChoices").addClass("ui-helper-hidden"),3===$("#element_area>fieldset").length&&($("#element_area").elementSelection("destroy").empty(),setupMultiElementSelection("#element_area"))):3!==$("#element_area>fieldset").length&&($(".element_list").length&&$(".element_list").elementSelection("destroy"),$("#element_area").empty().elementSelection({makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$("#element_area fieldset.acis-fsReduce select").on("change",function(){"mean"===$(this).val()&&$("select[name=outopt] :selected").val().search("list")<0?$("#seasonCalcChoices").removeClass("ui-helper-hidden"):$("#seasonCalcChoices").addClass("ui-helper-hidden")}).trigger("change"))}).trigger("change")}function setInput_dayavg(){setupOutputChoice("#option_select",["HTML","CSV-Table","CSV-List"],"radio"),setupElements("#option_select",{reduces:[["mean","Mean"],["max","Maximum"],["min","Minimum"],["pct","Percent of years"],["cnt","Number of years"]],makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupMoreOptions("#option_select"),setupOccur("#more_option_select","year"),setupStations("#station_select","single")}function setInput_normals(){setupOutputChoice("#option_select",["Graph","Table","CSV-List"],"checkbox",["Graph","Table"]),setupNormalType("#option_select"),setupDateRangeMM("#option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupElements("#option_select",{elements:[["tp","Temperature/Precipitation"],["temp","All temps (max/min/avg)"],["avgt","Avg Temperature"],["pcpn","Precipitation"],["snow","Snowfall"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"tp",mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupStations("#station_select","single"),$(".acis-fsElem select").on("change",function(){"snow"===$(".acis-fsElem select").val()||"hdd"===$(".acis-fsElem select").val()?($("#month_area").find("fieldset input:first").val(7),$("#month_area").find("fieldset input:last").val(6)):($("#month_area").find("fieldset input:first").val(1),$("#month_area").find("fieldset input:last").val(12))})}function setInput_extremes(){setupOutputChoice("#option_select",["HTML","CSV"]),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupElements("#option_select",{elements:[["maxt","Avg Max Temperature"],["mint","Avg Min Temperature"],["avgt","Avg Temperature"],["pcpn","Total Precipitation"],["snow","Total Snowfall"],["snwd","Avg Snow depth"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"maxt",mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupRecLength("#option_select",3),setupNumberRecords("#option_select"),setupRecReduce("#option_select"),setupMoreOptions("#option_select"),setupRestrictRange("#more_option_select"),setupMaxmissing("#more_option_select"),setupIncludeStart("#more_option_select"),setupStations("#station_select","single")}function setInput_condays(){setupOutputChoice("#option_select",["HTML","CSV"]),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupElements("#option_select",{mode:"numberDaysOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupCondaysContent("#option_select"),setupMoreOptions("#option_select"),setupIncludeStart("#more_option_select"),setupRunmissing("#more_option_select"),setupStations("#station_select","single"),setTimeout(function(){$(".acis-fsThresh input").focus().select()},200)}function setInput_fldates(){setupOutputChoice("#option_select",["Graph","Table","CSV"],"checkbox",["Table"]),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupElements("#option_select",{mode:"numberDaysOnly",defElement:"mint",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$(".acis-fsThresh input").val(32),setupBeginDate("#option_select"),setupGroupResults("#option_select"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select",!0,5),setupDval("#more_option_select",!0),setupMcnt("#more_option_select"),$("#more_option_select").append('<div class="acis-uaLabel">Graph options:</div>'),setupMovavgLine("#more_option_select",!1,5),setupRegressLine("#more_option_select",!1),setupLoessLine("#more_option_select",!1),setupStations("#station_select","single"),setTimeout(function(){$(".acis-fsThresh input").focus().select()},200)}function setInput_moncrt(){setupOutputChoice("#option_select",["HTML","Text","CSV"]),setupSingleDate("#option_select",{sdFormat:"ym"}),setupStations("#station_select","single"),setupTempRounding("#option_select","dly")}function setInput_dlylist(){setupOutputChoice("#option_select",["HTML","CSV"]),setupDateRange("#option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupMultiElementPicker("#option_select"),setupStations("#station_select","single")}function setInput_almanac(){setupOutputChoice("#option_select"),setupSingleDate("#option_select",{sdFormat:"ymd"}),setupStations("#station_select","single"),setupMoreOptions("#option_select"),setupMaxmissingAlmanac("#more_option_select",!1,$("#tdate_area").singleDateSelection("getter").split("-")[1])}function setInput_oneday(){var e;setupOutputChoice("#option_select",["HTML","CSV"]),setupSingleDate("#option_select",{sdFormat:"md"}),setupDateRangeYY("#option_select",{defaultStart:"por"}),setupStations("#station_select","single"),$(".acis-mdRange").on("keyup change",function(){(e=$(".acis-mdRange").val()).search("2-28")>=0||e.search("2-29")>=0?$(this).tooltip({content:"If date is 2/28 and start year is a non-leap year, summary will be for last day of February. If date is 2/28 and start year is a leap year, summary will be through Feb 28. If date is 2/29, both start and end year must be leap years and summary will be for the last day of February.",position:{my:"left top",at:"right+5 top",of:"#tdate_area fieldset"},tooltipClass:"acis-tooltip smallerBox"}).tooltip("open"):$(this).tooltip()&&$(this).tooltip("destroy")})}function setInput_seats(){var e=function(){"mean"===$(".acis-fsReduce select").val()&&$.inArray($("input[name=seasonChoices]:checked").val(),["annual","spring","summer","fall","winter","water"])>=0?$("#seasonCalcChoices").removeClass("ui-helper-hidden"):$("#seasonCalcChoices").addClass("ui-helper-hidden")};setupOutputChoice("#option_select",["Graph","Table","CSV"],"checkbox",["Graph","Table"]),setupElements("#option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupDateRangeYY("#option_select",{defaultStart:"por"}),$("#theyear").remove(),setupSeasonSelect("#option_select",{addSeason:["tall","Each month in series","",""],addSeasonIndex:6,makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupSeasonCalcs("#option_select"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select"),$("#more_option_select").append('<div class="acis-uaLabel">Graph options:</div>'),setupMovavgLine("#more_option_select",!1,5),setupRegressLine("#more_option_select",!1),setupLoessLine("#more_option_select",!1),setupGrfType("#more_option_select"),setupStations("#station_select","single"),$(".acis-fsReduce select").on("change",e).trigger("change"),$("input[name=seasonChoices]").on("change",e),$(".acis-fsSeason input[type=radio]:last").on("change",function(){$(this).prop("checked")&&$("input.acis-tother:last").tooltip({content:"If end date of range is 2/28 and start year is a non-leap year, summary will be through the end of February. If end date is 2/28 and start year is a leap year, summary will be through Feb 28. If end date is 2/29, both start and end year must be leap years and summary will be through the end of February.",tooltipClass:"acis-tooltip smallerBox"}).on("keyup",function(e){9!==e.keyCode&&($(".acis-tother:input:last").tooltip("destroy"),$(this).off("keyup"))}),$(this).off("change")})}function setInput_dlytmpgrf(){setupSeasonSelect("#option_select",{oneYear:!0,makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupStations("#station_select","single"),$("#theyear").select().focus()}function setInput_dlyaccgrf(){setupDatesAccum("#option_select"),setupElements("#option_select",{elements:[["pcpn","Precipitation"],["snow","Snowfall"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"pcpn",mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupOtherLines("#option_select"),setupResetAccum("#option_select"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select"),setupStations("#station_select","single")}function setInput_multiGrf(){setupElements("#option_select",{elements:[["pcpn","Precipitation"],["snow","Snowfall"],["snwd","Snow Depth"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"],["pdpt","Precipitation Departure"],["sdpt","Snowfall Departure"],["hdpt","HDD Departure"],["cdpt","CDD Departure"],["gdpt","GDD Departure"]],defElement:"pcpn",mode:"elementOnly"}),setupDatesAccum("#option_select"),setupStations("#station_select","single"),$("fieldset.acis-fsElem select").on("change",function(){var e,t=Date.today(),a=t.getMonth()+1,n=$(this).val();"snow"===n||"sdpt"===n||"snwd"===n?(e=a>=10?t.getFullYear():t.getFullYear()-1,$("#sDatepicker").val(e+"-10-01")):"hdd"!==n&&"hdpt"!==n||(e=a>=7?t.getFullYear():t.getFullYear()-1,$("#sDatepicker").val(e+"-07-01"))}),$("#chart_area").length&&($("#chart_area").highcharts().destroy(),$("#results_area").empty())}function setInput_stainfo(){setupNoOptions("#option_select"),setupStations("#station_select","single"),setTimeout(function(){$("#inputs").hasClass("ui-accordion")&&$("#inputs").accordion("option","active",$("#inputs .ui-accordion-header").index($("#station_acc")))},500)}function setInput_mdlylist(){setupOutputChoice("#option_select",["HTML","CSV","Map"],"checkbox",["HTML"]),setupSingleDate("#option_select",{sdFormat:"ymd"}),setupMultiElementPicker("#option_select"),setupMoreOptions("#option_select"),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select"),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select"),setupMapValueSize("#more_option_select","hide"),setupStations("#station_select","multi"),setupMapCheckboxListener()}function setInput_mmlylist(){setupOutputChoice("#option_select",["HTML","CSV","Map"],"checkbox",["HTML"]),setupSingleDate("#option_select",{sdFormat:"ym"}),setupElements("#option_select"),setupMultiElementSelection("#element_area"),setupStations("#station_select","multi"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select"),setupOccur("#more_option_select","date"),setupMcnt("#more_option_select"),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select"),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select"),setupMapValueSize("#more_option_select","hide"),setupMapCheckboxListener()}function setInput_mdatrang(){setupOutputChoice("#option_select",["HTML","CSV","Map"],"checkbox",["HTML"]),setupDateRange("#option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupElements("#option_select"),setupMultiElementSelection("#element_area"),setupStations("#station_select","multi"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select"),setupOccur("#more_option_select","date"),setupMcnt("#more_option_select"),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select"),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select"),setupMapValueSize("#more_option_select","hide"),setTimeout(function(){$(".ui-daterangepicker-PeriodofRecord").remove()},500),setupMapCheckboxListener()}function setInput_mpptsmry(){setupOutputChoice("#option_select",["HTML","CSV"]),setupSingleDate("#option_select",{sdFormat:"ymd",sdLabel:"End date:"}),setupStations("#station_select","multi"),setupPrecipTypeChoice("#option_select"),setupMoreOptions("#option_select"),setupMaxmissing("#more_option_select",!0,0),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select",!0),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select")}function setInput_mdlyrecs(){setupOutputChoice("#option_select",["HTML","CSV","Map record"],"checkbox",["HTML"]),setupYearRangeStn("#option_select"),setupDateRangeYY("#option_select",{defaultStart:"por",inputLabel:"Analysis period:"}),setupSingleDate("#option_select",{sdFormat:"md"}),setupElements("#option_select",{defElement:"maxt",mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupRecReduce("#option_select"),setupStations("#station_select","multi"),setupCompareYr("#option_select"),setupMoreOptions("#option_select"),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select"),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select"),setupMapValueSize("#more_option_select","hide"),$("[name=outopt]").on("change",function(){"text"===$("[name=outopt]:checked").val()?($("#compareYr").prop("disabled",!0).prop("checked",!1).parent().addClass("grayout").parent().prop("title","Option not available for text output"),$("#cmpyr").prop("disabled",!0).addClass("grayout")):($("#compareYr").prop("disabled",!1).parent().removeClass("grayout").parent().prop("title","Add column for this year to results"),$("#cmpyr").prop("disabled",!1).removeClass("grayout"))})}function setInput_mextremes(){setupOutputChoice("#option_select",["HTML","CSV","Map"],"checkbox",["HTML"]),setupYearRangeStn("#option_select"),setupDateRangeYY("#option_select",{defaultStart:"por",inputLabel:"Analysis period:"}),setupElements("#option_select",{elements:[["maxt","Avg Max Temperature"],["mint","Avg Min Temperature"],["avgt","Avg Temperature"],["pcpn","Total Precipitation"],["snow","Total Snowfall"],["snwd","Avg Snow depth"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"maxt",mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupRecLength("#option_select",1),setupRecReduce("#option_select"),setupMoreOptions("#option_select"),setupRestrictRange("#more_option_select"),setupMaxmissing("#more_option_select"),setupIncludeStart("#more_option_select"),setupStationType("#more_option_select",!0),setupStationCoors("#more_option_select"),setupStationCnty("#more_option_select"),setupStationClimdiv("#more_option_select"),setupMapValueSize("#more_option_select","hide"),setupStations("#station_select","multi")}function setInput_compare(){setupElements("#option_select",{elements:[[1,"Max Temp"],[2,"Min Temp"],[4,"Precipitation"],[10,"Snowfall"],[11,"Snow Depth"]],defElement:1,mode:"elementOnly",makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$('<span class="ui-icon ui-icon-info" title="Click for help" style="float:left;"></span>').appendTo("#option_select").position({my:"left center",at:"right-16 center",of:$("#element_area")}).on("click",{file:"./help/datasetCompare_help.html"},displayHelp),setupDatasets("#option_select"),setupStations("#station_select","single")}function setInput_ddlist(){var e=function(){if($("#sDatepicker").prop("allowChange"))try{$("#tDatepicker").val($.datepicker.parseDate("yy-mm-dd",$("#sDatepicker").val()).toString("MM-dd"))}catch(e){return!1}};setupOutputChoice("#option_select",["Graph","Table","CSV"],"checkbox",["Graph","Table"]),setupDateRange("#option_select",{makeActive:$("#inputs .ui-accordion-header").index($("#option_acc")),changeFunction:e}),setupDegdayChoice("#option_select","gdd"),setupSingleDate("#option_select",{sdFormat:"md",sdLabel:"Accumulation start date:"}),setupStations("#station_select","single"),$("#sDatepicker").val(Date.today().add(-6).days().toString("yyyy-MM-dd")).on("keyup change",e).prop("allowChange",!0).trigger("change"),$("#tDatepicker").on("keyup",function(){$("#sDatepicker").prop("allowChange",!1)})}function setInput_gridmap(){setupDateSelection("#option_select"),setupElements("#option_select",{elements:[["maxt","Max Temp"],["mint","Min Temp"],["pcpn","Precipitation"]],makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),$("#element_area").css("clear","both"),setupGridSelection("#option_select"),setupMoreOptions("#option_select"),setupContourLevels("#more_option_select"),setupStations("#station_select","grid"),$(".acis-fsElem").find("select").on("change",function(){$("#clevels").val("").trigger("keyup")})}function setInput_gridreduce(){setupElements("#option_select",{elements:[["maxt","Max Temp"],["mint","Min Temp"],["avgt","Avg Temp"],["pcpn","Precipitation"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"pcpn",mode:"full"}),setupSeasonSelect("#option_select",{oneYear:!0,makeActive:$("#inputs .ui-accordion-header").index($("#option_acc"))}),setupGridSelection("#option_select"),setupAreaWithinState("#option_select",{areas:[["county","County"],["climdiv","Climate Division"],["basin","Basin"],["state","State"]],slabel:"Summarization area"}),setupSpatialSummary("#option_select",{smrys:[["mean","Mean"],["max","Maximum"],["min","Minimum"]]}),setupStations("#station_select","grid"),$("input.acis-tyear").parent().css("margin-top","8px")}function getInput_monavg(){var e,t,a=getTempRounding(),n=getOutputChoice()||"table";if(n.search("list")<0){if(!getElementSelection("mly","element_area"))return!1}else if(!getMultiElementSelection("mly","element_list"))return!1;if(!getDateRangeYY())return!1;if(!getDateRangeMM())return!1;if(!getMaxmissing())return!1;for(e=0;e<input_params.elems.length;e+=1)!getOccur()||"max"!==input_params.elems[e].reduce.reduce&&"min"!==input_params.elems[e].reduce.reduce||$.extend(input_params.elems[e].reduce,{add:["date"]}),getMcnt()&&(input_params.elems[e].reduce.add?input_params.elems[e].reduce.add.push("mcnt"):$.extend(input_params.elems[e].reduce,{add:["mcnt"]})),$.extend(input_params.elems[e],{prec:3});if(n.search("table")>=0){if(!(t=$("#month_area").monthRangeSelection("getter")))return!1;input_params.elems[0].groupby=["year",t[0],t[1]],0===getFilterYrs().length&&$.extend(input_params.elems[0],{smry:[{reduce:"mean"},{reduce:"max",add:"date"},{reduce:"min",add:"date"}]}),"avgt"===input_params.elems[0].name&&"mean"===input_params.elems[0].reduce.reduce&&"intermediate"===a&&(input_params.elems[0].name="maxt",input_params.elems[0].smry&&delete input_params.elems[0].smry,input_params.elems.push($.extend(!0,{},input_params.elems[0])),input_params.elems[1].name="mint")}return $.extend(input_params,{meta:["name","state","sids"]}),!0}function getInput_dayavg(){return!!getElementSelection("dly","element_area")&&(!!getDateRangeYY()&&($.extend(input_params.elems[0],{smry:input_params.elems[0].reduce}),getOccur()&&$.extend(input_params.elems[0].smry,{add:"date"}),delete input_params.elems[0].reduce,$.extend(input_params.elems[0],{groupby:["year","1-1","12-31"],smry_only:1}),$.extend(input_params,{meta:["name","state","valid_daterange","sids"]}),!0))}function getInput_normals(){var e,t,a=[],n=getNormalType(),s=$("#month_area").monthRangeSelection("getter");if(!s)return!1;if(t=s[0],!getDatesNormals(n))return!1;switch((e=$("#element_area").elementSelection("getter")).name){case"tp":a=["pcpn","maxt","mint","avgt"];break;case"temp":a=["maxt","mint","avgt"];break;default:a.push(e.name)}return $.each(a,function(e,a){"dly"===n?"pcpn"===a||"snow"===a?input_params.elems.push({name:a,interval:n,duration:"std",season_start:numberPad(t,2)+"-01",reduce:{reduce:"sum"},normal:"91",prec:2}):input_params.elems.push({name:a,interval:n,duration:n,normal:"91",prec:2}):"pcpn"===a||"snow"===a||"hdd"===a||"cdd"===a||"gdd"===a?input_params.elems.push({name:a,interval:n,duration:n,reduce:{reduce:"sum"},normal:"91"}):input_params.elems.push({name:a,interval:n,duration:n,reduce:{reduce:"mean"},normal:"91"})}),!0}function getInput_extremes(){var e=$("#element_area").elementSelection("getter");return input_params.elems.push({name:e.name}),$.extend(input_params.elems[0],{prec:3,reduce:{reduce:{maxt:"mean",mint:"mean",avgt:"mean",pcpn:"sum",snow:"sum",snwd:"mean",hdd:"sum",cdd:"sum",gdd:"sum"}[input_params.elems[0].name]}}),$.extend(input_params.elems[0].reduce,{add:["date","mcnt"]}),!!getDateRangeYY()&&(!!getRecLength()&&($.extend(input_params.elems[0],{smry:{add:["date","mcnt"]}}),$("#restrictRange").prop("checked")||$.extend(input_params.elems[0],{smry_only:1}),!!getNumberRecords(1)&&(!!getRecReduce()&&(!!getMaxmissing()&&(!!getRestrictRange()&&(input_params.meta=["valid_daterange","name","state","sids"],!0))))))}function getInput_condays(){return!!getDateRangeYY()&&(!!getElementSelection("dly","element_area")&&(input_params.elems[0].smry={reduce:"run"+input_params.elems[0].reduce.reduce.substr(3),add:"date"},!!getCondaysContent(1)&&(!!getRunmissing()&&(input_params.elems[0].smry_only=1,delete input_params.elems[0].reduce,input_params.meta=["valid_daterange","name","state","sids"],!0))))}function fixpor(e){var t=[],a=[],n={start:input_params.sDate,end:input_params.eDate};delete input_params.sDate,delete input_params.eDate,input_params.meta=["valid_daterange"],input_params.sids=input_params.sid,postResults("/StnMeta",function(s){if(delete input_params.meta,delete input_params.sids,!s.meta.length)return $(document).reportError({errorText:"Requested data not available for selected station.",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1;$.each(s.meta[0].valid_daterange,function(e,n){t.push(n[0]),a.push(n[1])}),input_params.sDate=n.start.search("por")>=0?t.sort()[0]:n.start,input_params.eDate=n.end.search("por")>=0?a.sort()[a.length-1]:n.end,e(n)&&postResults("/StnData",displayResults)})}function getInput_fldates(){var e=function(e){var t=input_params.elems[0].season_start.split("-"),a=new Date(+new Date(2012,t[0]-1,t[1])-864e5).toString("MM-dd"),n=numberPad(input_params.sDate.substr(5,5)),s=numberPad(input_params.eDate.substr(5,5));return e.start.search("por")<0||n<=a?input_params.sDate=input_params.sDate.substr(0,5)+a:input_params.sDate=parseInt(input_params.sDate.substr(0,4),10)-1+"-"+a,e.end.search("por")<0||s>=a?input_params.eDate=input_params.eDate.substr(0,5)+a:input_params.eDate=parseInt(input_params.eDate.substr(0,4),10)+1+"-"+a,!0};return!!getElementSelection("dly","element_area")&&(!!getDateRangeYY()&&(!!getMaxmissing()&&(!!getBeginDate()&&($.extend(input_params.elems[0],{interval:[1,0,0],duration:"std",smry:["max","mean","min"]}),input_params.elems[0].reduce={reduce:input_params.elems[0].reduce.reduce.replace("cnt","last"),add:"value,mcnt"},input_params.sid&&(input_params.sDate.search("por")>=0||input_params.eDate.search("por")>=0)?(fixpor(e),!1):e({start:input_params.sDate,end:input_params.eDate})))))}function getInput_moncrt(){var e=$("#tdate_area").singleDateSelection("getter");return!!e&&(input_params.sDate=e+"-01",input_params.eDate=$.datepicker.formatDate("yy-mm-dd",$.datepicker.parseDate("yy-mm-dd",input_params.sDate).moveToLastDayOfMonth()),input_params.elems=[{name:"maxt"},{name:"mint"},{name:"avgt"},{name:"avgt",normal:"departure91"},{name:"hdd"},{name:"cdd"},{name:"pcpn"},{name:"snow"},{name:"snwd"}],$.each(input_params.elems,function(e,t){$.extend(t,{add:"t"})}),!0)}function getInput_dlylist(){var e,t,a=getObsTimeTable(),n=getOutputChoice();if(!getOptionsDaily())return!1;if(a&&$.each(input_params.elems,function(e,t){t.normal||$.extend(t,{add:"t"})}),!(e=$("#date_area").dateRangeSelection("getter")))return!1;if($.extend(input_params,e),(t="por"!==input_params.sDate&&"por"!==input_params.eDate?dateDiff(input_params.sDate,input_params.eDate):11e3)>10959&&"html"===n)alert("Request of this length is only available as CSV."),$("#outopt_csv").prop("checked",!0);else if(t>3654&&"html"===n)return 0===$("#infoDialog").length?$("<div id='infoDialog'></div>").appendTo(document.body).addClass("ui-widget").html("<p>HTML rendering of a request of this length can be quite slow.</p>").dialog({width:400,modal:!0,title:"Warning",buttons:[{text:"Change to CSV",click:function(){$("#outopt_csv").prop("checked",!0),$("#results_area").empty().show().loadSpinner(),postResults("/StnData",displayResults),$(this).dialog("close")}},{text:"Continue with HTML",click:function(){$("#results_area").empty().show().loadSpinner(),postResults("/StnData",displayResults),$(this).dialog("close")}}]}):$("#infoDialog").dialog("open"),!1;return!0}function getInput_almanac(){return input_params.date=$("#tdate_area").singleDateSelection("getter"),!!input_params.date&&(input_params.elems=[{name:"maxt"},{name:"mint"},{name:"avgt"},{name:"pcpn"},{name:"snow"},{name:"snwd"},{name:"hdd"},{name:"cdd"},{name:"maxt",duration:"mtd",reduce:{reduce:"mean"},prec:3},{name:"mint",duration:"mtd",reduce:{reduce:"mean"},prec:3},{name:"avgt",duration:"mtd",reduce:{reduce:"mean"},prec:3},{name:"pcpn",duration:"mtd",reduce:{reduce:"sum"}},{name:"snow",duration:"mtd",reduce:{reduce:"sum"}},{name:"snwd",duration:"mtd",reduce:{reduce:"max"}},{name:"hdd",duration:"mtd",reduce:{reduce:"sum"}},{name:"cdd",duration:"mtd",reduce:{reduce:"sum"}},{name:"maxt",duration:"ytd",reduce:{reduce:"mean"},prec:3},{name:"mint",duration:"ytd",reduce:{reduce:"mean"},prec:3},{name:"avgt",duration:"ytd",reduce:{reduce:"mean"},prec:3},{name:"pcpn",duration:"ytd",reduce:{reduce:"sum"}},{name:"snow",duration:"std",reduce:{reduce:"sum"},season_start:"07-01"},{name:"snwd",duration:"std",reduce:{reduce:"max"},season_start:"07-01"},{name:"hdd",duration:"std",reduce:{reduce:"sum"},season_start:"07-01"},{name:"cdd",duration:"ytd",reduce:{reduce:"sum"}}],getMaxmissingAlmanac({MT:[8,9,10],MP:[11,12,13],MD:[14,15],AT:[16,17,18],AP:[19,20,21],AD:[22,23]}),input_params.meta=["valid_daterange","name","state","sids"],!0)}function getInput_oneday(){var e=function(e){var t,a,n=$("#tdate_area").singleDateSelection("getter");return!!n&&("02-29"!==n||Date.isLeapYear(input_params.sDate.substr(0,4))&&Date.isLeapYear(input_params.eDate.substr(0,4))?(t=numberPad(input_params.sDate.substr(5,2))+"-"+numberPad(input_params.sDate.substr(8,2)),input_params.sDate=(t<=n?input_params.sDate.substr(0,4):parseInt(input_params.sDate.substr(0,4),10)+1)+"-"+n,a=numberPad(input_params.eDate.substr(5,2))+"-"+numberPad(input_params.eDate.substr(8,2)),input_params.eDate=(a>=n?input_params.eDate.substr(0,4):parseInt(input_params.eDate.substr(0,4),10)-1)+"-"+n,!0):($(document).reportError({errorText:"When specifying Feb 29, start and end years must be leap years."}),!1))};return input_params.elems=[{name:"maxt"},{name:"mint"},{name:"pcpn"},{name:"snow"},{name:"snwd"}],$.each(input_params.elems,function(e,t){$.extend(t,{interval:[1,0,0],duration:1,smry:[{reduce:"max"},{reduce:"mean"},{reduce:"min"}]})}),$.merge(input_params.elems[0].smry,[{reduce:"pct_ge_100"},{reduce:"pct_ge_90"},{reduce:"pct_ge_50"},{reduce:"pct_le_32"}]),$.merge(input_params.elems[1].smry,[{reduce:"pct_ge_70"},{reduce:"pct_ge_50"},{reduce:"pct_le_32"},{reduce:"pct_le_0"}]),$.merge(input_params.elems[2].smry,[{reduce:"pct_ge_0.01"},{reduce:"pct_ge_0.10"},{reduce:"pct_ge_0.50"},{reduce:"pct_ge_1.0"}]),$.merge(input_params.elems[3].smry,[{reduce:"pct_ge_0.1"},{reduce:"pct_ge_1.0"},{reduce:"pct_ge_3.0"},{reduce:"pct_ge_6.0"}]),$.merge(input_params.elems[4].smry,[{reduce:"pct_ge_1"},{reduce:"pct_ge_3"},{reduce:"pct_ge_6"},{reduce:"pct_ge_12"}]),!!getDateRangeYY()&&(input_params.sid&&(input_params.sDate.search("por")>=0||input_params.eDate.search("por")>=0)?(fixpor(e),!1):e((input_params.sDate,input_params.eDate)))}function getInput_seats(){var e,t,a=$("input[name=seasonChoices]:checked").val(),n="months"===getSeasonCalcs();return!!getElementSelection("mly","element_area")&&(!!getSeasons("months")&&(!!getMaxmissing()&&($.extend(input_params.elems[0].reduce,{add:"mcnt"}),$.extend(input_params.elems[0],{prec:3}),"tall"!==a&&"tother"!==a?(e=input_params.sDate.split("-"),t=input_params.eDate.split("-"),n?($.extend(input_params.elems[0],{interval:"mly",duration:1,groupby:["year",e[1],t[1]]}),e[1]>t[1]&&(input_params.sDate=parseInt(input_params.sDate.substr(0,5),10)-1+input_params.sDate.substr(5))):($.extend(input_params.elems[0],{interval:[1,0],duration:t[1]>=e[1]?t[1]-e[1]+1:t[1]-e[1]+13}),input_params.sDate=input_params.sDate.substr(0,5)+input_params.eDate.substr(5))):"tother"===a?($.extend(input_params.elems[0],{interval:[1,0,0],duration:"std",season_start:input_params.sDate.substr(5)}),input_params.sDate=input_params.sDate.substr(0,5)+input_params.eDate.substr(5)):"tall"===a&&$.extend(input_params.elems[0],{interval:"mly",duration:1}),!0)))}function getInput_dlytmpgrf(){return!!getSeasons("days")&&(input_params.elems=[{name:"maxt"},{name:"mint"},{name:"maxt",duration:"dly",normal:"91",prec:1},{name:"mint",duration:"dly",normal:"91",prec:1}],!0)}function getInput_dlyaccgrf(){var e,t,a,n=getResetAccum();if(!getElementSelection("dly","element_area"))return!1;if(!(e=$("#date_area").dateRangeSelection("getter")))return!1;if($.extend(input_params,e),t=("por"!==input_params.sDate?Date.parse(input_params.sDate):Date.parse("1850-01-01")).addYears(1).addDays(-1),("por"!==input_params.eDate?Date.parse(input_params.eDate):Date.today()).isAfter(t)&&n){if(input_params.elems[0].reduce={reduce:"sum"},input_params.elems[0].duration="std",input_params.elems[0].season_start=$("#tdate_area").singleDateSelection("getter"),!input_params.elems[0].season_start)return!1;(a=$.extend(!0,{},input_params.elems[0])).duration=1,delete a.reduce,delete a.season_start,delete a.summary,input_params.elems.push(a)}return $("#normLine").prop("checked")&&((a=$.extend(!0,{},input_params.elems[0])).normal="91",input_params.elems.push(a)),input_params.meta=["valid_daterange","name","state","sids"],!0}function getInput_multiGrf(){var e=$("#date_area").dateRangeSelection("getter");return!!e&&($.extend(input_params,e),!!getElementSelection("dly","element_area")&&("pdpt"===input_params.elems[0].name?$.extend(input_params.elems[0],{name:"pcpn",normal:"departure91"}):"sdpt"===input_params.elems[0].name?$.extend(input_params.elems[0],{name:"snow",normal:"departure91"}):"hdpt"===input_params.elems[0].name?$.extend(input_params.elems[0],{name:"hdd",normal:"departure91"}):"cdpt"===input_params.elems[0].name?$.extend(input_params.elems[0],{name:"cdd",normal:"departure91"}):"gdpt"===input_params.elems[0].name&&$.extend(input_params.elems[0],{name:"gdd",normal:"departure91"}),$.extend(input_params,{meta:["name","state","sids"]}),!0))}function getInput_stainfo(){return $.extend(input_params,{elems:[1,2,4,10,11]}),!0}function getInput_mdlylist(){var e,t,a=getOutputChoice()||["html"];if("object"!=typeof a&&(a=[a]),$.inArray("map",a)>=0)for(t=(e=$("#element_area").multiElementPicker("getter")).length-1;t>=1;t-=1)$("input[name="+e[t]+"]").prop("checked",!1);return!!getOptionsDaily()&&(input_params.date=$("#tdate_area").singleDateSelection("getter"),!!input_params.date&&($.extend(input_params,{meta:["name","state","ll"]}),getStationType()&&input_params.meta.push("sids"),getStationCoors()&&(input_params.meta.push("ll"),input_params.meta.push("elev")),getStationCnty()&&input_params.meta.push("county"),getStationClimdiv()&&input_params.meta.push("climdiv"),!0))}function getInput_mmlylist(){var e;if($("#element_area div.element_list").length>0){if(!getMultiElementSelection("mly","element_list"))return!1}else if(!getElementSelection("mly","element_area"))return!1;if(input_params.date=$("#tdate_area").singleDateSelection("getter"),!input_params.date)return!1;if(!getMaxmissing())return!1;for(e=0;e<input_params.elems.length;e+=1)!getOccur()||"max"!==input_params.elems[e].reduce.reduce&&"min"!==input_params.elems[e].reduce.reduce||$.extend(input_params.elems[e].reduce,{add:["date"]}),getMcnt()&&(input_params.elems[e].reduce.add?input_params.elems[e].reduce.add.push("mcnt"):$.extend(input_params.elems[e].reduce,{add:["mcnt"]})),"mean"===input_params.elems[e].reduce.reduce&&$.extend(input_params.elems[e],{prec:3});return $.extend(input_params,{meta:["name","state","ll"]}),getStationType()&&input_params.meta.push("sids"),getStationCoors()&&input_params.meta.push("elev"),getStationCnty()&&input_params.meta.push("county"),getStationClimdiv()&&input_params.meta.push("climdiv"),!0}function getInput_mdatrang(){var e,t=$("#date_area").dateRangeSelection("getter"),a=Math.round(dateDiff(t.sDate,t.eDate))+1;if(!t)return!1;if($("#element_area div.element_list").length>0){if(!getMultiElementSelection("dly","element_list"))return!1}else if(!getElementSelection("dly","element_area"))return!1;for(e=0;e<input_params.elems.length;e+=1)!getOccur()||"max"!==input_params.elems[e].reduce.reduce&&"min"!==input_params.elems[e].reduce.reduce||$.extend(input_params.elems[e].reduce,{add:["date"]}),getMcnt()&&(input_params.elems[e].reduce.add?input_params.elems[e].reduce.add.push("mcnt"):$.extend(input_params.elems[e].reduce,{add:["mcnt"]})),$.extend(input_params.elems[e],{interval:"dly",duration:a}),"mean"===input_params.elems[e].reduce.reduce&&$.extend(input_params.elems[e],{prec:3});return $.extend(input_params,{sDate:t.eDate,eDate:t.eDate}),!!getMaxmissing()&&($.extend(input_params,{meta:["name","state","ll"]}),getStationType()&&input_params.meta.push("sids"),getStationCoors()&&input_params.meta.push("elev"),getStationCnty()&&input_params.meta.push("county"),getStationClimdiv()&&input_params.meta.push("climdiv"),!0)}function getInput_mpptsmry(){var e=getPrecipTypeChoice();return input_params.date=$("#tdate_area").singleDateSelection("getter"),!!input_params.date&&(input_params.elems=[{name:"pcpn",interval:"dly",duration:30,reduce:{reduce:"sum"}},{name:"pcpn",interval:"dly",duration:60,reduce:{reduce:"sum"}},{name:"pcpn",interval:"dly",duration:90,reduce:{reduce:"sum"}},{name:"pcpn",interval:"dly",duration:180,reduce:{reduce:"sum"}},{name:"pcpn",interval:"dly",duration:"ytd",reduce:{reduce:"sum"}},{name:"pcpn",interval:"dly",duration:"std",season_start:"10-01",reduce:{reduce:"sum"}}],!!getMaxmissing()&&("dpt"===e&&$.each(input_params.elems,function(e,t){$.extend(t,{normal:"departure91"})}),$.extend(input_params,{meta:["name","state","ll","sids"]}),getStationCoors()&&input_params.meta.push("elev"),getStationCnty()&&input_params.meta.push("county"),getStationClimdiv()&&input_params.meta.push("climdiv"),!0))}function getInput_mdlyrecs(){var e=$("#element_area").elementSelection("getter");return input_params.elems.push({name:e.name}),$.extend(input_params.elems[0],{interval:[1,0,0],duration:1,smry:{reduce:null,add:"date",n:2},smry_only:1}),!!getDateRangeYY("stn_year_area")&&(!!getRecReduce()&&(input_params.meta=["sids"],input_params.sDate&&input_params.sDate.search("por")>=0&&(input_params.sDate="1850-01-01"),input_params.eDate&&input_params.eDate.search("por")>=0&&(input_params.eDate=(new Date).toString("yyyy-MM-dd")),$.extend(input_params,{meta:["name","state","sids"]}),!0))}function getInput_mextremes(){var e=$("#element_area").elementSelection("getter");return input_params.elems.push({name:e.name}),$.extend(input_params.elems[0],{reduce:{reduce:{maxt:"mean",mint:"mean",avgt:"mean",pcpn:"sum",snow:"sum",snwd:"mean",hdd:"sum",cdd:"sum",gdd:"sum"}[input_params.elems[0].name]}}),$.extend(input_params.elems[0].reduce,{add:["date","mcnt"]}),!!getDateRangeYY("stn_year_area")&&($.extend(input_params.elems[0],{interval:"dly",duration:1,smry:{add:["date","mcnt"],n:2}}),$("#restrictRange").prop("checked")||$.extend(input_params.elems[0],{smry_only:1}),!!getRecReduce()&&(!!getMaxmissing()&&(!!getRestrictRange()&&(input_params.meta=["sids"],"mean"===input_params.elems[0].reduce.reduce&&$.extend(input_params.elems[0],{prec:3}),input_params.sDate&&input_params.sDate.search("por")>=0&&(input_params.sDate="1850-01-01"),input_params.eDate&&input_params.eDate.search("por")>=0&&(input_params.eDate=(new Date).toString("yyyy-MM-dd")),$.extend(input_params,{meta:["name","state","ll"]}),getStationType()&&input_params.meta.push("sids"),getStationCoors()&&input_params.meta.push("elev"),getStationCnty()&&input_params.meta.push("county"),getStationClimdiv()&&input_params.meta.push("climdiv"),!0))))}function getInput_compare(){return $.extend(input_params,{meta:"name,state,sids,valid_daterange",elems:[$("#element_area").elementSelection("getter")],sids:input_params.sid}),$.extend(input_params.elems[0],{vX:parseInt(input_params.elems[0].name,10),add:"s"}),delete input_params.elems[0].name,!0}function getInput_ddlist(){var e=$("#date_area").dateRangeSelection("getter"),t=Date.parse($("#sDatepicker").val()),a=$("#tdate_area").singleDateSelection("getter").split("-"),n=parseInt(a[0],10)-1,s=parseInt(a[1],10);return!!e&&($.extend(input_params,e),n!==t.getMonth()&&(t=t.moveToMonth(n,-1)),input_params.sDate=t.set({day:s}).toString("yyyy-MM-dd"),input_params.elems=[{name:"maxt"},{name:"mint"}],!0)}function getInput_gridmap(){var e=getGridSelection(),t=$("input[name=date_select_type]:checked").attr("id");return!!getElementSelection("month_button"===t?"mly":"dly","element_area")&&(!!getDateSelection()&&($.extend(input_params,{grid:e,output:"json",image:{proj:"lcc",overlays:["state","county"],interp:"cspline",cmap:"pcpn"===input_params.elems[0].name?"RdYlGn":"jet",width:Math.min(500,$("#results_area").innerWidth()-20)}}),!!getContourLevels()&&("21"===e&&"mly"===input_params.elems[0].interval&&("pcpn"===input_params.elems[0].name&&"sum"===input_params.elems[0].reduce.reduce||$.inArray(input_params.elems[0].name,["maxt","mint","avgt"])>=0&&"mean"===input_params.elems[0].reduce.reduce)&&(input_params.elems[0].name="mly_"+input_params.elems[0].name),!0)))}function getInput_gridreduce(){var e=$("input[name=seasonChoices]:checked").val();return $.extend(input_params,{grid:getGridSelection(),state:$("#state").val()}),!!getSeasons("months")&&(!!getElementSelection("mly","element_area")&&(!!getSpatialSummary()&&("tother"===e?($.extend(input_params.elems[0],{interval:[1,0,0],duration:"std",season_start:input_params.sDate.substr(5)}),input_params.sDate=input_params.sDate.substr(0,5)+input_params.eDate.substr(5)):"21"===input_params.grid&&("pcpn"===input_params.elems[0].name&&"sum"===input_params.elems[0].reduce.reduce||$.inArray(input_params.elems[0].name,["maxt","mint","avgt"])>=0&&"mean"===input_params.elems[0].reduce.reduce)&&(input_params.elems[0].name="mly_"+input_params.elems[0].name),$.extend(input_params.elems[0],{maxmissing:0}),!0)))}function obtainResults(e){var t,a=$("#product_select").data("productId"),n=$("#product_select").data("noempty")||!1,s=a.indexOf("MultiProduct")>=0;if(t="MultiProduct_extremes"===a||"MultiProduct_dlyrecs"===a||"StnProduct_comparison"===a?"/StnMeta":a.indexOf("StnProduct")>=0?"/StnData":s?"/MultiStnData":"/GridData",hideMap(),$("#restoreMap").is(":hidden")&&(s||"srch_button"===defaults.stn_select_type)&&$("#restoreMap").show(),n||$("#results_area").empty(),$("#results_area").show().loadSpinner(),!a||!e())return $("#results_area").loadSpinner("fadeOut"),!1;"StnProduct_stainfo"!==a?postResults(t,displayResults):($("#results_area").loadSpinner("fadeOut").empty(),obtainStinfo(input_params.sid,"results_area"))}function collectInput(e,t){var a=$("#product_select").data("productId"),n=$("#product_select").data("getinput");if(input_params={elems:[]},!a)return!1;if(a.search("MultiProduct")>=0){if(!getStationsMultiInput())return!1}else if(a.search("GridProduct")>=0){if(!getStationsGridInput())return!1}else if(e===obtainResults&&!getStationsSingleInput())return!1;e(n,t)}